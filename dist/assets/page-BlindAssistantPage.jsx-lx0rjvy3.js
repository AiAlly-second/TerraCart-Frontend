import{u as T,r,j as e}from"./vendor-react-D1Ov3a92.js";import"./vendor-CB8mghnX.js";const V="/assets/disabled-sign-DmuCn7Xp.png",N={hi:{recognition:"hi-IN",speech:"hi-IN"},mr:{recognition:"hi-IN",speech:"hi-IN"},gu:{recognition:"gu-IN",speech:"hi-IN"},en:{recognition:"en-IN",speech:"en-IN"}},B={minHeight:"100vh",background:"#f1f5f9",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",paddingTop:"80px"},M={width:"min(720px, 100%)",background:"#ffffff",borderRadius:"18px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",display:"flex",flexDirection:"column",padding:"24px",border:"1px solid #e2e8f0"},D={display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},W={height:"300px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"16px",background:"#f8fafc",marginBottom:"16px"},z={display:"flex",flexWrap:"wrap",gap:"12px",marginTop:"16px",justifyContent:"center"},C={display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",borderRadius:"9999px",background:"#e0f2fe",color:"#0c4a6e",fontWeight:600,fontSize:"0.875rem",marginBottom:"12px"},m=(d="secondary")=>{const n="px-6 py-3 rounded-xl font-bold focus:outline-none focus:ring transition transform active:scale-95 shadow-sm";switch(d){case"primary":return`${n} bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-200`;case"danger":return`${n} bg-red-500 text-white hover:bg-red-600 focus:ring-red-200`;default:return`${n} bg-slate-200 text-slate-700 hover:bg-slate-300 focus:ring-slate-200`}},l=(d,n="en-IN")=>{if(typeof window>"u"||!("speechSynthesis"in window))return;const a=new SpeechSynthesisUtterance(d);a.lang=n,a.rate=.95,a.pitch=1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(a)};function Y(){const d=T(),[n,a]=r.useState([]),[g,p]=r.useState(!1),[w,u]=r.useState(""),b=r.useRef(null),c=r.useRef(null),j=r.useRef(!1),I=r.useMemo(()=>localStorage.getItem("language")||"en",[]),{recognition:v,speech:o}=N[I]||N.en,S=r.useMemo(()=>{try{const t=localStorage.getItem("terra_selectedTable")||localStorage.getItem("tableSelection"),s=t?JSON.parse(t):null;if(s)return s;const i=localStorage.getItem("terra_scanToken");return i?{qrSlug:i}:null}catch{return null}},[]),h=r.useCallback(()=>{if(j.current=!1,c.current){try{c.current.onresult=null,c.current.onend=null,c.current.stop()}catch(t){console.warn("Voice assistant stop error",t)}c.current=null}p(!1)},[]),k=r.useCallback(()=>{if(typeof window>"u")return;const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){u("Voice recognition is not supported on this device."),l("Voice recognition is not available on this device.",o);return}u("");const s=new t;s.lang=v,s.continuous=!0,s.interimResults=!1,s.maxAlternatives=3,j.current=!0,s.onresult=i=>{let y="";for(let x=i.resultIndex;x<i.results.length;x++){const f=i.results[x];f.isFinal&&(y=f[0].transcript.trim())}if(y){const x=new Date().toLocaleTimeString();a(f=>[...f,{id:Date.now(),text:y,timestamp:x}]),l("Noted.",o)}},s.onerror=i=>{console.error("Voice assistant error",i.error),u(i.error==="not-allowed"?"Microphone permission denied. Please allow microphone access.":"We couldn't capture your voice. Please try again."),p(!1)},s.onend=()=>{p(!1)};try{s.start(),p(!0),u(""),c.current=s}catch(i){console.error("Voice assistant start error",i),u("Unable to start listening. Please try again."),p(!1)}},[v,o]);r.useEffect(()=>(l("Voice assistant activated. Press the start listening button and speak slowly. Your words will appear on the screen for staff to read.",o),()=>{h()}),[o,h]),r.useEffect(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},[n]);const R=()=>{h(),d(-1)},L=async()=>{try{const t=n.map(s=>s.text).join(`
`);if(!t)return;await navigator.clipboard.writeText(t),l("Copied to clipboard.",o),alert("Copied to clipboard.")}catch{alert("Unable to copy. Please copy manually.")}},E=()=>{a([]),l("Cleared notes.",o)},P=()=>{g?(h(),l("Listening paused.",o)):(k(),l("Listening resumed.",o))};return e.jsxs("div",{style:B,children:[e.jsxs("div",{style:M,children:[e.jsxs("div",{style:D,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("img",{src:V,alt:"Blind Support",style:{width:"32px",height:"32px",objectFit:"contain"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Voice Assistant"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Blind Support Mode"})]})]}),e.jsx("button",{className:m("danger"),onClick:R,"aria-label":"Close voice assistant",style:{padding:"8px 16px",fontSize:"0.9rem"},children:"Close / Exit"})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"16px"},children:[e.jsxs("div",{style:C,children:[e.jsx("span",{style:{width:12,height:12,borderRadius:"50%",background:g?"#22c55e":"#f97316",display:"inline-block"}}),g?"Listening...":"Paused"]}),S?.number&&e.jsxs("div",{style:{...C,background:"#ecfeff",color:"#0e7490"},children:["Table ",S.number]})]}),w&&e.jsx("div",{className:"mb-4 px-4 py-3 rounded-lg bg-red-50 text-red-600 text-sm border border-red-100",children:w}),e.jsxs("div",{style:W,"aria-live":"polite","aria-label":"Voice to text transcripts",children:[n.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 text-center p-4",children:[e.jsx("p",{className:"mb-2 text-3xl",children:"ðŸŽ™ï¸"}),e.jsx("p",{children:'Tap "Start Listening" and speak.'}),e.jsx("p",{className:"text-sm mt-2",children:"Your voice will be converted to text."})]}),n.map(t=>e.jsxs("div",{className:"mb-3 rounded-lg bg-white shadow-sm border border-slate-200 p-3 text-slate-800",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:t.timestamp}),e.jsx("div",{className:"text-lg leading-relaxed",children:t.text})]},t.id)),e.jsx("div",{ref:b})]}),e.jsxs("div",{style:z,children:[e.jsx("button",{className:m("primary"),onClick:P,style:{minWidth:"160px"},children:g?"Pause Listening":"Start Listening"}),e.jsx("button",{className:m(),onClick:L,disabled:!n.length,children:"Copy Notes"}),e.jsx("button",{className:m(),onClick:E,disabled:!n.length,children:"Clear Notes"})]})]}),e.jsx("p",{className:"text-slate-500 text-sm mt-8 text-center max-w-md",children:"This tool converts speech to text to assist with communication."})]})}export{Y as default};
