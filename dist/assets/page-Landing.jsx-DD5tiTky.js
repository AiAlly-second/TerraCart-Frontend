import{u as q,r as I,j as i}from"./vendor-react-D1Ov3a92.js";import{H as Y}from"./page-Billing.jsx-CvG5gaYx.js";import{g as K}from"./page-CartPage.jsx-BFJaz61i.js";import{m as x}from"./vendor-motion-DMcOTFRV.js";const J="/assets/blind-eye-sign-DEm7V_Vu.png",M=[{code:"en",label:"English"},{code:"hi",label:"हिन्दी"},{code:"mr",label:"मराठी"},{code:"gu",label:"ગુજરાતી"}],k="https://api.terracart.in".replace(/\/$/,"");k.includes("localhost")&&console.error("[Landing] ⚠️ WARNING: VITE_NODE_API_URL is not set correctly in production!","Current value:","https://api.terracart.in");function m(){console.log("[Landing] Clearing old DINE_IN order data due to session change (preserving takeaway data)"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")}function E(S,b){S&&S!==b&&m(),S&&localStorage.setItem("terra_sessionToken",S)}function te(){const S=q(),[b,H]=I.useState(localStorage.getItem("accessibilityMode")==="true");localStorage.getItem("language");const j=o=>{localStorage.setItem("language",o),S("/secondpage")};I.useEffect(()=>{const o=new URLSearchParams(window.location.search),t=o.get("table"),l=o.get("takeaway");if(t||l){localStorage.getItem("language")||localStorage.setItem("language","en"),console.log("[Landing] QR scan detected, auto-setting default language");return}console.log("[Landing] Normal link - showing language selection")},[S]);const[O,R]=I.useState(!0);I.useEffect(()=>{window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()}},[]),I.useEffect(()=>{const o=new URLSearchParams(window.location.search),t=o.get("takeaway"),l=o.get("cart");l&&localStorage.setItem("terra_takeaway_cartId",l),t?localStorage.setItem("terra_takeaway_only","true"):(localStorage.removeItem("terra_takeaway_only"),l||localStorage.removeItem("terra_takeaway_cartId"))},[]),I.useEffect(()=>{const o=new URLSearchParams(window.location.search);let t=o.get("table");if(!t){const s=sessionStorage.getItem("terra_table_param");if(s){console.log("[Landing] Using persisted table parameter from sessionStorage:",s),t=s;const c=`${window.location.pathname}?table=${s}`;window.history.replaceState({},"",c)}}if(!t||t.trim().length<5){t&&t.trim().length<5&&console.warn("[Landing] Invalid slug detected (too short):",t),m(),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),localStorage.removeItem("terra_orderType"),console.log("[Landing] No table parameter - cleared all dine-in order data"),R(!1);return}const l=localStorage.getItem("terra_scanToken"),g=localStorage.getItem("terra_selectedTable");if(l&&l!==t)console.warn("[Landing] URL table slug doesn't match stored slug - clearing old table data:",{urlSlug:t,storedSlug:l}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),m();else if(g)try{const s=JSON.parse(g),c=s.qrSlug||l;c&&c!==t&&(console.warn("[Landing] Stored table qrSlug doesn't match URL slug - clearing:",{urlSlug:t,storedTableSlug:c,tableNumber:s.number}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),m())}catch(s){console.warn("[Landing] Failed to validate stored table data:",s),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken")}const d=async()=>{try{localStorage.getItem("terra_paymentCompleted")==="true"&&(console.log("[Landing] Payment was completed - clearing all previous session data for fresh start"),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),m(),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),localStorage.removeItem("terra_takeaway_sessionToken"),localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_paymentCompleted"),console.log("[Landing] All session data cleared after payment completion"));const c=localStorage.getItem("terra_scanToken"),p=localStorage.getItem("terra_sessionToken"),v=localStorage.getItem("terra_waitToken"),P=c&&c!==t;P?(console.log("[Landing] New table QR scan detected - clearing old table data:",{previousSlug:c,newSlug:t}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),m(),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId")):c||(console.log("[Landing] First table QR scan - ensuring clean state"),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId")),P?(localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),localStorage.removeItem("terra_takeaway_sessionToken"),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_takeaway_only"),console.log("[Landing] Different table QR scan detected, cleared takeaway data, cartId, and flags")):c?console.log("[Landing] Same table QR or first scan - preserving takeaway order data"):(localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_orderId_TAKEAWAY"),console.log("[Landing] First table QR scan - cleared takeaway cartId, flags, and order IDs for clean state"));const T=new URLSearchParams;p&&T.set("sessionToken",p),v&&T.set("waitToken",v);const L=t.trim();if(L.length<5){console.error("[Landing] Invalid slug (too short):",L),alert("Invalid table QR code. Please scan the table QR code again.");return}const N=`${k}/api/tables/lookup/${encodeURIComponent(L)}${T.toString()?`?${T.toString()}`:""}`;console.log("[Landing] Table lookup URL:",N),console.log("[Landing] Table lookup with waitToken:",v||"No"),console.log("[Landing] Backend API URL:",k),console.log("[Landing] Slug from URL:",t),console.log("[Landing] Environment:",{mode:"production",dev:!1,prod:!0,viteNodeApiUrl:"https://api.terracart.in"});const n=await K(N,{headers:{"Content-Type":"application/json"}},{maxRetries:3,retryDelay:1e3,timeout:2e4,shouldRetry:(a,u)=>a.message?.includes("timeout")||a.message?.includes("Network error")||a.message?.includes("Failed to fetch")||a.message?.includes("CORS")?(console.log(`[Landing] Retrying table lookup (attempt ${u+1}/3)...`),!0):a.status>=400&&a.status<500?!1:a.status>=500?!0:u<2}).catch(a=>{throw console.error("[Landing] Fetch error after retries:",a),a.message?.includes("timeout")?new Error("Connection timeout: The server took too long to respond. This might be due to slow network or server issues. Please try again."):a.message?.includes("CORS")||a.message?.includes("Failed to fetch")?new Error("Network error: Cannot connect to server. Please check your internet connection. If the problem persists, the server might be temporarily unavailable."):new Error(`Network error: ${a.message||"Unknown error"}. Please try again or contact support if the problem persists.`)});let r={};const C=n.headers.get("content-type"),Q=C&&C.includes("application/json");try{if(Q)r=await n.json();else{const a=await n.text();a&&(r=JSON.parse(a))}}catch(a){if(console.warn("[Landing] Failed to parse response:",a,"Status:",n.status),n.status===423)r={message:"Table is currently occupied. Please wait.",table:{status:"OCCUPIED"}};else throw new Error("Failed to parse server response")}if(!n.ok&&n.status!==423)throw console.error("[Landing] Table lookup failed:",{status:n.status,statusText:n.statusText,payload:r,url:N,nodeApi:k}),n.status===404?new Error("Table not found. The QR code may be invalid or the table may have been deleted. Please contact staff."):n.status===400&&r?.isMerged?(alert(r.message||"This table has been merged with another table. Please scan the primary table's QR code."),new Error(r.message||"Table is merged")):n.status===0||!n.status?new Error("Cannot connect to server. This might be a network issue or the server is temporarily unavailable. Please check your internet connection and try again."):n.status===500||n.status>=502?new Error("Server error: The server encountered an issue. Please try again in a moment. If the problem persists, contact support."):n.status===503?new Error("Service unavailable: The server is temporarily unavailable. Please try again in a few moments."):new Error(r?.message||`Failed to fetch table information (Status: ${n.status}). Please try scanning the QR code again.`);n.status===423&&console.log("[Landing] Table locked (423), waitlist info:",r.waitlist);const e=r.table||r;if(!e)throw new Error("Invalid table response");if(!e.id&&!e._id)throw console.error("[Landing] Table response missing ID:",e),new Error("Invalid table response: missing table ID");if(!e.number&&!e.tableNumber)throw console.error("[Landing] Table response missing number:",e),new Error("Invalid table response: missing table number");const f=e.qrSlug||e.qrToken;if(f&&f!==t)throw console.error("[Landing] Table slug mismatch!",{scannedSlug:t,returnedQrSlug:f,tableNumber:e.number||e.tableNumber,tableId:e.id||e._id}),new Error(`Table QR code mismatch: Scanned slug "${t}" but got table with slug "${f}" (Table ${e.number||e.tableNumber}). Please scan the correct QR code.`);console.log("[Landing] Table lookup successful:",{scannedSlug:t,tableNumber:e.number||e.tableNumber,tableId:e.id||e._id,qrSlug:f,cartId:e.cartId||e.cafeId});const A=c&&c!==t,W=e.status||(n.status===423?"OCCUPIED":"AVAILABLE"),G=A||W==="AVAILABLE";A&&(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_serviceType"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),console.log("[Landing] New table scan - cleared DINE_IN data, takeaway data already handled"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),localStorage.removeItem("terra_lastTableId_DINE_IN"),localStorage.removeItem("terra_lastTableSlug_DINE_IN"),console.log("[Landing] New table detected, cleared all cart, order, and customer data")),!e.cartId&&!e.cafeId&&console.warn("[Landing] Table response missing cartId/cafeId:",e),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_only"),localStorage.setItem("terra_serviceType","DINE_IN");const _={id:e.id||e._id,_id:e._id||e.id,number:e.number||e.tableNumber,tableNumber:e.tableNumber||e.number,name:e.name||null,qrSlug:t,cartId:e.cartId||e.cafeId||null,cafeId:e.cartId||e.cafeId||null,status:e.status||"AVAILABLE",capacity:e.capacity||null,originalCapacity:e.originalCapacity||null,sessionToken:e.sessionToken||null,currentOrder:e.currentOrder||null},F=_.number;console.log("[Landing] Storing table data:",{scannedSlug:t,storedTableNumber:F,tableId:_.id,qrSlug:_.qrSlug,cartId:_.cartId,status:_.status}),localStorage.setItem("terra_selectedTable",JSON.stringify(_)),localStorage.setItem("terra_scanToken",t);const U=localStorage.getItem("terra_selectedTable");if(U)try{const a=JSON.parse(U);a.qrSlug!==t&&(console.error("[Landing] CRITICAL: Stored table slug doesn't match scanned slug!",{scannedSlug:t,storedSlug:a.qrSlug,tableNumber:a.number}),localStorage.setItem("terra_selectedTable",JSON.stringify(_)),localStorage.setItem("terra_scanToken",t))}catch(a){console.error("[Landing] Failed to verify stored table data:",a)}const y=e.status||(n.status===423?"OCCUPIED":"AVAILABLE");if(y==="AVAILABLE"&&!A&&(m(),console.log("[Landing] Table is AVAILABLE - cleared DINE_IN order data (preserved takeaway data)")),n.status===200&&y==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),m(),console.log("[Landing] Table is AVAILABLE - cleared DINE_IN order data (preserved takeaway data)");const a=r.sessionToken||e.sessionToken;a&&localStorage.setItem("terra_sessionToken",a);return}if(y==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),m(),console.log("[Landing] Table is AVAILABLE - cleared all order data for new customer");const a=r.sessionToken||e.sessionToken;a&&localStorage.setItem("terra_sessionToken",a);return}if(n.status!==423){const a=r.sessionToken||e.sessionToken;E(a,p)}else if(localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"))localStorage.getItem("terra_sessionToken")&&console.log("[Landing] Preserving sessionToken for user with active order");else{const u=r.sessionToken||e.sessionToken;u&&E(u,p)}if(y!=="AVAILABLE"&&(r.waitlist?.token&&v?localStorage.setItem("terra_waitToken",r.waitlist.token):(n.status!==423||!v)&&localStorage.removeItem("terra_waitToken"),r.waitlist?.status==="SEATED"&&r.waitlist?.sessionToken&&(m(),console.log("[Landing] Waitlist user SEATED - cleared all order data for new customer"),E(r.waitlist.sessionToken,p),localStorage.removeItem("terra_waitToken")),r.waitlist?.status==="NOTIFIED"&&(m(),console.log("[Landing] Waitlist user NOTIFIED - cleared all order data for new customer"))),n.status===423){const a=e?.status||"OCCUPIED";if(a==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),m(),console.log("[Landing] Table is AVAILABLE (423 response) - cleared all order data for new customer");const u=r.sessionToken||e?.sessionToken;u&&localStorage.setItem("terra_sessionToken",u);return}if(console.log("[Landing] Table locked (423), waitlist info:",r.waitlist?{token:r.waitlist.token,status:r.waitlist.status,position:r.waitlist.position}:"No waitlist info"),a!=="AVAILABLE")if(r.waitlist?.token){localStorage.setItem("terra_waitToken",r.waitlist.token);const u=r.waitlist?.position||1;alert(r?.message||`Table is currently occupied. You are #${u} in the waitlist.`)}else alert(r?.message||"This table is currently occupied. You will be asked to join the waitlist on the next page."),localStorage.removeItem("terra_waitToken");return}}catch(s){if(console.error("Table assignment failed",s),s.message==="Table is currently assigned to another guest"){const c=localStorage.getItem("terra_sessionToken");if(localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),c){setTimeout(d,1e3);return}localStorage.removeItem("terra_scanToken"),alert("This table is currently occupied. Please ask the staff for assistance.")}else s.message&&s.message.includes("merged")?(localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken")):(localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_selectedTable"),(!s.message||!s.message.includes("merged"))&&(s.message&&s.message.includes("Table not found")?alert("Table not found. The QR code may be invalid or the table may have been removed. Please scan the table QR code again or contact staff for assistance."):alert("We couldn't detect your table. Please rescan the table QR or contact staff.")))}finally{o.delete("table");const s=o.toString(),c=`${window.location.pathname}${s?`?${s}`:""}${window.location.hash}`;window.history.replaceState({},"",c),R(!1)}};d()},[]);const w=I.useRef(null),[D,B]=I.useState(!0),h=o=>{const t=document.querySelectorAll("button");for(let l of t)if(l.innerText.trim().toLowerCase()===o.toLowerCase())return l.click(),B(!1),w.current&&(w.current.onend=null,w.current.stop(),w.current=null),!0;return!1},V=()=>{const o=new(window.SpeechRecognition||window.webkitSpeechRecognition);o.lang="en-US",o.interimResults=!1,o.maxAlternatives=1,o.onstart=()=>{console.log("Listening...")},o.onresult=t=>{const l=t.results[0][0].transcript.trim().toLowerCase();console.log("User said:",l);let g=!1;if(l.includes("english")||l.includes("इंग्लिश")?g=h("English"):l.includes("hindi")||l.includes("हिंदी")?g=h("हिन्दी"):l.includes("marathi")||l.includes("मराठी")?g=h("मराठी"):(l.includes("gujarati")||l.includes("ગુજરાતી"))&&(g=h("ગુજરાતી")),g)return;const d=new SpeechSynthesisUtterance("Your voice was not clear, please repeat again.");d.voice=window.speechSynthesis.getVoices()[0],d.onend=()=>{D&&w.current&&w.current.start()},window.speechSynthesis.speak(d)},o.onend=()=>{D&&!window.speechSynthesis.speaking&&o.start()},w.current=o,o.start()},$=()=>{window.speechSynthesis.cancel();const o=["Welcome to Terra Cart!","Please select your language.","Option 1: English","Option 2: हिंदी","Option 3: मराठी","Option 4: ગુજરાતી","Now please say your choice."],t=window.speechSynthesis.getVoices();let l=t.find(d=>d.name.includes("Google हिन्दी"))||t.find(d=>d.name.includes("Google US English"))||t[0];const g=d=>{if(d>=o.length){V();return}const s=new SpeechSynthesisUtterance(o[d]);s.voice=l,s.lang=l?.lang||"en-US",s.rate=1,s.pitch=1,s.onend=()=>{setTimeout(()=>g(d+1),50)},window.speechSynthesis.speak(s)};g(0)};return i.jsxs("div",{className:b?"bg-white":"bg-gray-100",children:[i.jsx(Y,{showNavigationTabs:!1,isFixed:!1}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 bg-white"}),i.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center min-h-[calc(100vh-5rem)] px-4 py-4 sm:py-6 md:py-8",children:[i.jsx("div",{className:"mb-8 sm:mb-12 md:mb-16",children:i.jsx("div",{className:`
                rounded-lg py-1 px-1 text-center
                ${b?"border-2 border-orange-800":""}
              `,children:i.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold leading-snug",style:{color:"#1B1212"},children:i.jsx("span",{className:"block",children:"Welcome !"})})})}),O?i.jsxs("div",{className:"flex flex-col items-center justify-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),i.jsx("p",{className:"text-lg font-semibold text-gray-700",children:"Loading..."})]}):i.jsxs(x.div,{initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},transition:{duration:.6},className:"w-full max-w-md",children:[i.jsx("p",{className:`
                  text-center font-semibold mb-6 sm:mb-8 md:mb-10
                  ${b?"text-xl sm:text-2xl md:text-3xl font-bold bg-white px-3 sm:px-4 py-2 rounded-lg":"text-base sm:text-lg md:text-xl"}
                `,style:{color:"#1B1212"},children:"Please select your preferred language"}),i.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.map(o=>i.jsx(x.button,{whileTap:{scale:.95},whileHover:{scale:1.02},onClick:()=>j(o.code),className:`
                      py-4 sm:py-5 md:py-6 px-6 sm:px-8 rounded-lg font-semibold
                      text-lg sm:text-xl md:text-2xl transition-all duration-200
                      text-white shadow-lg hover:shadow-xl active:scale-95 border-2
                      ${b?"border-gray-800 bg-gray-800":"border-transparent hover:border-white/30"}
                    `,style:{backgroundColor:b?void 0:"#FC8019"},children:o.label},o.code))})]})]})]}),i.jsx(x.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:$,className:"fixed rounded-full shadow-lg bg-orange-600 text-white hover:bg-orange-700 focus:outline-none blind-eye-btn",style:{position:"fixed",bottom:"20px",right:"20px",width:"56px",height:"56px",display:"grid",placeItems:"center",border:"none",cursor:"pointer",boxShadow:"0 6px 18px rgba(0,0,0,0.25)",transition:"transform .2s ease, box-shadow .2s ease, background .2s ease",zIndex:10001,pointerEvents:"auto"},"aria-label":"Blind Support - Read Page Aloud",children:i.jsx("img",{src:J,alt:"Blind Support",width:"24",height:"24",style:{objectFit:"contain",filter:"brightness(0) invert(1)"}})})]})}export{te as L,J as b};
