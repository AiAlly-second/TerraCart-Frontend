import{u as z,r as p,j as d}from"./vendor-react-ObuVvEbY.js";import{g as X,a as M,s as Z,H as ee,L as te}from"./page-Billing.jsx-e1iYcKyK.js";import{g as ae}from"./page-CartPage.jsx-BJ5jqOeq.js";import{m as D}from"./vendor-motion-PmperX3c.js";const oe="/assets/blind-eye-sign-DEm7V_Vu.png",re={welcomeTitle:"Welcome!",loading:"Loading...",selectPreferredLanguage:"Please select your preferred language",blindSupportAria:"Blind Support - Read Page Aloud",invalidTableQr:"Invalid table QR code. Please scan the table QR code again.",mergedTableMessage:"This table has been merged with another table. Please scan the primary table QR code.",tableOccupiedWaitlist:"Table is currently occupied. You are #{position} in the waitlist.",tableOccupiedJoinWaitlist:"This table is currently occupied. You will be asked to join the waitlist on the next page.",tableOccupiedAskStaff:"This table is currently occupied. Please ask the staff for assistance.",tableNotFoundScanAgain:"Table not found. The QR code may be invalid or the table may have been removed. Please scan again or contact staff.",detectTableFailed:"We could not detect your table. Please rescan the table QR or contact staff.",voiceNotSupported:"Voice input is not supported on this browser. Please select language by tapping a button.",voiceCannotDetect:"I could not detect the language. Please say English, Hindi, Marathi, or Gujarati.",languageSelected:"Language selected.",micPermissionDenied:"Microphone permission denied. Please allow microphone access and try again.",voiceNoSpeech:"I did not hear anything. Please say your language again.",voiceRecognitionError:"Voice recognition error. Please try again.",unableStartVoice:"Unable to start voice input. Please try again.",voiceReadWelcome:"Welcome to Terra Cart.",voiceReadSelectLanguage:"Please select your language.",voiceOptionEnglish:"Option one English.",voiceOptionHindi:"Option two Hindi.",voiceOptionMarathi:"Option three Marathi.",voiceOptionGujarati:"Option four Gujarati.",voiceNowSayChoice:"Now please say your choice."},ne={welcomeTitle:"स्वागत है!",loading:"लोड हो रहा है...",selectPreferredLanguage:"कृपया अपनी पसंदीदा भाषा चुनें",blindSupportAria:"नेत्रहीन सहायता - पेज पढ़ें",invalidTableQr:"अमान्य टेबल QR कोड। कृपया टेबल का QR फिर से स्कैन करें।",mergedTableMessage:"यह टेबल किसी दूसरी टेबल के साथ मर्ज है। कृपया मुख्य टेबल का QR स्कैन करें।",tableOccupiedWaitlist:"टेबल अभी व्यस्त है। आप प्रतीक्षा सूची में #{position} पर हैं।",tableOccupiedJoinWaitlist:"यह टेबल अभी व्यस्त है। अगले पेज पर आपसे प्रतीक्षा सूची में जुड़ने के लिए कहा जाएगा।",tableOccupiedAskStaff:"यह टेबल अभी व्यस्त है। कृपया स्टाफ से सहायता लें।",tableNotFoundScanAgain:"टेबल नहीं मिली। QR कोड अमान्य हो सकता है। कृपया फिर से स्कैन करें या स्टाफ से संपर्क करें।",detectTableFailed:"हम आपकी टेबल पहचान नहीं सके। कृपया टेबल QR फिर से स्कैन करें या स्टाफ से संपर्क करें।",voiceNotSupported:"इस ब्राउज़र में वॉइस इनपुट उपलब्ध नहीं है। कृपया बटन दबाकर भाषा चुनें।",voiceCannotDetect:"मैं भाषा पहचान नहीं पाया। कृपया English, Hindi, Marathi या Gujarati कहें।",languageSelected:"भाषा चयनित।",micPermissionDenied:"माइक्रोफोन अनुमति अस्वीकृत। कृपया माइक्रोफोन अनुमति दें और फिर प्रयास करें।",voiceNoSpeech:"मुझे कुछ सुनाई नहीं दिया। कृपया अपनी भाषा फिर से बोलें।",voiceRecognitionError:"वॉइस पहचान में त्रुटि। कृपया फिर से प्रयास करें।",unableStartVoice:"वॉइस इनपुट शुरू नहीं हो सका। कृपया फिर प्रयास करें।",voiceReadWelcome:"टेरा कार्ट में आपका स्वागत है।",voiceReadSelectLanguage:"कृपया अपनी भाषा चुनें।",voiceOptionEnglish:"विकल्प एक, अंग्रेज़ी।",voiceOptionHindi:"विकल्प दो, हिंदी।",voiceOptionMarathi:"विकल्प तीन, मराठी।",voiceOptionGujarati:"विकल्प चार, गुजराती।",voiceNowSayChoice:"अब कृपया अपना विकल्प बोलें।"},se={welcomeTitle:"स्वागत आहे!",loading:"लोड होत आहे...",selectPreferredLanguage:"कृपया आपली पसंतीची भाषा निवडा",blindSupportAria:"दृष्टिहीन सहाय्य - पेज मोठ्याने वाचा",invalidTableQr:"अवैध टेबल QR कोड. कृपया टेबलचा QR पुन्हा स्कॅन करा.",mergedTableMessage:"हे टेबल दुसऱ्या टेबलसोबत मर्ज झाले आहे. कृपया मुख्य टेबलचा QR स्कॅन करा.",tableOccupiedWaitlist:"टेबल सध्या व्यस्त आहे. तुम्ही प्रतीक्षा यादीत #{position} क्रमांकावर आहात.",tableOccupiedJoinWaitlist:"हे टेबल सध्या व्यस्त आहे. पुढील पानावर तुम्हाला प्रतीक्षा यादीत सामील होण्यास सांगितले जाईल.",tableOccupiedAskStaff:"हे टेबल सध्या व्यस्त आहे. कृपया स्टाफकडून मदत घ्या.",tableNotFoundScanAgain:"टेबल सापडले नाही. QR कोड अवैध असू शकतो. कृपया पुन्हा स्कॅन करा किंवा स्टाफशी संपर्क करा.",detectTableFailed:"आम्हाला तुमचे टेबल ओळखता आले नाही. कृपया टेबल QR पुन्हा स्कॅन करा किंवा स्टाफशी संपर्क करा.",voiceNotSupported:"या ब्राउझरमध्ये व्हॉइस इनपुट उपलब्ध नाही. कृपया बटण दाबून भाषा निवडा.",voiceCannotDetect:"मला भाषा ओळखता आली नाही. कृपया English, Hindi, Marathi किंवा Gujarati म्हणा.",languageSelected:"भाषा निवडली.",micPermissionDenied:"मायक्रोफोन परवानगी नाकारली. कृपया परवानगी द्या आणि पुन्हा प्रयत्न करा.",voiceNoSpeech:"मला काही ऐकू आले नाही. कृपया तुमची भाषा पुन्हा बोला.",voiceRecognitionError:"व्हॉइस ओळख त्रुटी. कृपया पुन्हा प्रयत्न करा.",unableStartVoice:"व्हॉइस इनपुट सुरू करता आले नाही. कृपया पुन्हा प्रयत्न करा.",voiceReadWelcome:"टेरा कार्टमध्ये तुमचे स्वागत आहे.",voiceReadSelectLanguage:"कृपया तुमची भाषा निवडा.",voiceOptionEnglish:"पर्याय एक, इंग्रजी.",voiceOptionHindi:"पर्याय दोन, हिंदी.",voiceOptionMarathi:"पर्याय तीन, मराठी.",voiceOptionGujarati:"पर्याय चार, गुजराती.",voiceNowSayChoice:"आता कृपया तुमची निवड बोला."},le={welcomeTitle:"સ્વાગત છે!",loading:"લોડ થઈ રહ્યું છે...",selectPreferredLanguage:"કૃપા કરીને તમારી પસંદગીની ભાષા પસંદ કરો",blindSupportAria:"દૃષ્ટિ સહાય - પેજ વાંચો",invalidTableQr:"અમાન્ય ટેબલ QR કોડ. કૃપા કરીને ટેબલનો QR ફરી સ્કેન કરો.",mergedTableMessage:"આ ટેબલ બીજી ટેબલ સાથે મર્જ છે. કૃપા કરીને મુખ્ય ટેબલનો QR સ્કેન કરો.",tableOccupiedWaitlist:"ટેબલ હાલમાં વ્યસ્ત છે. તમે વેઇટલિસ્ટમાં #{position} પર છો.",tableOccupiedJoinWaitlist:"આ ટેબલ હાલમાં વ્યસ્ત છે. આગળના પેજ પર તમને વેઇટલિસ્ટમાં જોડાવા માટે કહેવામાં આવશે.",tableOccupiedAskStaff:"આ ટેબલ હાલમાં વ્યસ્ત છે. કૃપા કરીને સ્ટાફની મદદ લો.",tableNotFoundScanAgain:"ટેબલ મળી નથી. QR કોડ અમાન્ય હોઈ શકે છે. કૃપા કરીને ફરી સ્કેન કરો અથવા સ્ટાફનો સંપર્ક કરો.",detectTableFailed:"અમે તમારી ટેબલ શોધી શક્યા નથી. કૃપા કરીને ટેબલ QR ફરી સ્કેન કરો અથવા સ્ટાફનો સંપર્ક કરો.",voiceNotSupported:"આ બ્રાઉઝરમાં વોઇસ ઇનપુટ સપોર્ટેડ નથી. કૃપા કરીને બટન દબાવી ભાષા પસંદ કરો.",voiceCannotDetect:"હું ભાષા ઓળખી શક્યો નથી. કૃપા કરીને English, Hindi, Marathi અથવા Gujarati કહો.",languageSelected:"ભાષા પસંદ થઈ.",micPermissionDenied:"માઇક્રોફોન પરમિશન નકારી દેવામાં આવી. કૃપા કરીને પરમિશન આપો અને ફરી પ્રયાસ કરો.",voiceNoSpeech:"મને કંઈ સાંભળાયું નથી. કૃપા કરીને તમારી ભાષા ફરી કહો.",voiceRecognitionError:"વોઇસ રેકગ્નિશન ભૂલ. કૃપા કરીને ફરી પ્રયાસ કરો.",unableStartVoice:"વોઇસ ઇનપુટ શરૂ કરી શકાયું નથી. કૃપા કરીને ફરી પ્રયાસ કરો.",voiceReadWelcome:"ટેરા કાર્ટમાં આપનું સ્વાગત છે.",voiceReadSelectLanguage:"કૃપા કરીને તમારી ભાષા પસંદ કરો.",voiceOptionEnglish:"વિકલ્પ એક, અંગ્રેજી.",voiceOptionHindi:"વિકલ્પ બે, હિન્દી.",voiceOptionMarathi:"વિકલ્પ ત્રણ, મરાઠી.",voiceOptionGujarati:"વિકલ્પ ચાર, ગુજરાતી.",voiceNowSayChoice:"હવે કૃપા કરીને તમારી પસંદગી બોલો."},$={en:re,hi:ne,mr:se,gu:le},L="https://api.terracart.in".replace(/\/$/,"");L.includes("localhost")&&console.error("[Landing] ⚠️ WARNING: VITE_NODE_API_URL is not set correctly in production!","Current value:","https://api.terracart.in");function u(){console.log("[Landing] Clearing old DINE_IN order data due to session change (preserving takeaway data)"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")}function C(I,E){I&&I!==E&&u(),I&&localStorage.setItem("terra_sessionToken",I)}function Se(){const I=z(),[E,x]=p.useState(X()),[f,ie]=p.useState(localStorage.getItem("accessibilityMode")==="true"),l=r=>$[E]?.[r]||$.en?.[r]||r,B=(r,e={})=>{let a=l(r);return Object.entries(e).forEach(([g,m])=>{a=a.replace(new RegExp(`\\{${g}\\}`,"g"),String(m))}),a},W=r=>{const e=M(r);if(x(e),localStorage.getItem("terra_takeaway_only")==="true"){localStorage.removeItem("terra_selectedCartId"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),localStorage.setItem("terra_serviceType","TAKEAWAY");const g=`TAKEAWAY-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;localStorage.setItem("terra_takeaway_sessionToken",g),localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_orderType"),I("/menu",{state:{serviceType:"TAKEAWAY"}});return}I("/secondpage")};p.useEffect(()=>{const r=new URLSearchParams(window.location.search),e=r.get("table"),a=r.get("takeaway");if(e||a){localStorage.getItem("language")||(M("en"),x("en")),console.log("[Landing] QR scan detected, auto-setting default language");return}console.log("[Landing] Normal link - showing language selection")},[I]),p.useEffect(()=>Z(e=>{x(e)}),[]);const[Y,j]=p.useState(!0);p.useEffect(()=>{window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()}},[]),p.useEffect(()=>{const r=new URLSearchParams(window.location.search),e=r.get("takeaway"),a=r.get("cart");a&&localStorage.setItem("terra_takeaway_cartId",a),e?localStorage.setItem("terra_takeaway_only","true"):(localStorage.removeItem("terra_takeaway_only"),a||localStorage.removeItem("terra_takeaway_cartId"))},[]),p.useEffect(()=>{const r=new URLSearchParams(window.location.search);let e=r.get("table");if(!e){const n=sessionStorage.getItem("terra_table_param");if(n){console.log("[Landing] Using persisted table parameter from sessionStorage:",n),e=n;const c=`${window.location.pathname}?table=${n}`;window.history.replaceState({},"",c)}}if(!e||e.trim().length<5){e&&e.trim().length<5&&console.warn("[Landing] Invalid slug detected (too short):",e),u(),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),localStorage.removeItem("terra_orderType"),console.log("[Landing] No table parameter - cleared all dine-in order data"),j(!1);return}const a=localStorage.getItem("terra_scanToken"),g=localStorage.getItem("terra_selectedTable");if(a&&a!==e)console.warn("[Landing] URL table slug doesn't match stored slug - clearing old table data:",{urlSlug:e,storedSlug:a}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),u();else if(g)try{const n=JSON.parse(g),c=n.qrSlug||a;c&&c!==e&&(console.warn("[Landing] Stored table qrSlug doesn't match URL slug - clearing:",{urlSlug:e,storedTableSlug:c,tableNumber:n.number}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),u())}catch(n){console.warn("[Landing] Failed to validate stored table data:",n),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken")}const m=async()=>{try{localStorage.getItem("terra_paymentCompleted")==="true"&&(console.log("[Landing] Payment was completed - clearing all previous session data for fresh start"),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),u(),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),localStorage.removeItem("terra_takeaway_sessionToken"),localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_paymentCompleted"),console.log("[Landing] All session data cleared after payment completion"));const c=localStorage.getItem("terra_scanToken"),b=localStorage.getItem("terra_sessionToken"),T=localStorage.getItem("terra_waitToken"),F=c&&c!==e;F?(console.log("[Landing] New table QR scan detected - clearing old table data:",{previousSlug:c,newSlug:e}),localStorage.removeItem("terra_selectedTable"),localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_serviceType"),u(),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId")):c||(console.log("[Landing] First table QR scan - ensuring clean state"),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_takeaway_cartId")),F?(localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),localStorage.removeItem("terra_takeaway_sessionToken"),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_takeaway_only"),console.log("[Landing] Different table QR scan detected, cleared takeaway data, cartId, and flags")):c?console.log("[Landing] Same table QR or first scan - preserving takeaway order data"):(localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_only"),localStorage.removeItem("terra_orderId_TAKEAWAY"),console.log("[Landing] First table QR scan - cleared takeaway cartId, flags, and order IDs for clean state"));const A=new URLSearchParams;b&&A.set("sessionToken",b),T&&A.set("waitToken",T);const R=e.trim();if(R.length<5){console.error("[Landing] Invalid slug (too short):",R),alert(l("invalidTableQr"));return}const O=`${L}/api/tables/lookup/${encodeURIComponent(R)}${A.toString()?`?${A.toString()}`:""}`;console.log("[Landing] Table lookup URL:",O),console.log("[Landing] Table lookup with waitToken:",T||"No"),console.log("[Landing] Backend API URL:",L),console.log("[Landing] Slug from URL:",e),console.log("[Landing] Environment:",{mode:"production",dev:!1,prod:!0,viteNodeApiUrl:"https://api.terracart.in"});const i=await ae(O,{headers:{"Content-Type":"application/json"}},{maxRetries:3,retryDelay:1e3,timeout:2e4,shouldRetry:(o,S)=>o.message?.includes("timeout")||o.message?.includes("Network error")||o.message?.includes("Failed to fetch")||o.message?.includes("CORS")?(console.log(`[Landing] Retrying table lookup (attempt ${S+1}/3)...`),!0):o.status>=400&&o.status<500?!1:o.status>=500?!0:S<2}).catch(o=>{throw console.error("[Landing] Fetch error after retries:",o),o.message?.includes("timeout")?new Error("Connection timeout: The server took too long to respond. This might be due to slow network or server issues. Please try again."):o.message?.includes("CORS")||o.message?.includes("Failed to fetch")?new Error("Network error: Cannot connect to server. Please check your internet connection. If the problem persists, the server might be temporarily unavailable."):new Error(`Network error: ${o.message||"Unknown error"}. Please try again or contact support if the problem persists.`)});let s={};const U=i.headers.get("content-type"),H=U&&U.includes("application/json");try{if(H)s=await i.json();else{const o=await i.text();o&&(s=JSON.parse(o))}}catch(o){if(console.warn("[Landing] Failed to parse response:",o,"Status:",i.status),i.status===423)s={message:"Table is currently occupied. Please wait.",table:{status:"OCCUPIED"}};else throw new Error("Failed to parse server response")}if(!i.ok&&i.status!==423)throw console.error("[Landing] Table lookup failed:",{status:i.status,statusText:i.statusText,payload:s,url:O,nodeApi:L}),i.status===404?new Error("Table not found. The QR code may be invalid or the table may have been deleted. Please contact staff."):i.status===400&&s?.isMerged?(alert(s.message||l("mergedTableMessage")),new Error(s.message||"Table is merged")):i.status===0||!i.status?new Error("Cannot connect to server. This might be a network issue or the server is temporarily unavailable. Please check your internet connection and try again."):i.status===500||i.status>=502?new Error("Server error: The server encountered an issue. Please try again in a moment. If the problem persists, contact support."):i.status===503?new Error("Service unavailable: The server is temporarily unavailable. Please try again in a few moments."):new Error(s?.message||`Failed to fetch table information (Status: ${i.status}). Please try scanning the QR code again.`);i.status===423&&console.log("[Landing] Table locked (423), waitlist info:",s.waitlist);const t=s.table||s;if(!t)throw new Error("Invalid table response");if(!t.id&&!t._id)throw console.error("[Landing] Table response missing ID:",t),new Error("Invalid table response: missing table ID");if(!t.number&&!t.tableNumber)throw console.error("[Landing] Table response missing number:",t),new Error("Invalid table response: missing table number");const y=t.qrSlug||t.qrToken;if(y&&y!==e)throw console.error("[Landing] Table slug mismatch!",{scannedSlug:e,returnedQrSlug:y,tableNumber:t.number||t.tableNumber,tableId:t.id||t._id}),new Error(`Table QR code mismatch: Scanned slug "${e}" but got table with slug "${y}" (Table ${t.number||t.tableNumber}). Please scan the correct QR code.`);console.log("[Landing] Table lookup successful:",{scannedSlug:e,tableNumber:t.number||t.tableNumber,tableId:t.id||t._id,qrSlug:y,cartId:t.cartId||t.cafeId});const P=c&&c!==e,q=t.status||(i.status===423?"OCCUPIED":"AVAILABLE"),ce=P||q==="AVAILABLE";P&&(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_serviceType"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),console.log("[Landing] New table scan - cleared DINE_IN data, takeaway data already handled"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),localStorage.removeItem("terra_lastTableId_DINE_IN"),localStorage.removeItem("terra_lastTableSlug_DINE_IN"),console.log("[Landing] New table detected, cleared all cart, order, and customer data")),!t.cartId&&!t.cafeId&&console.warn("[Landing] Table response missing cartId/cafeId:",t),localStorage.removeItem("terra_takeaway_cartId"),localStorage.removeItem("terra_takeaway_only"),localStorage.setItem("terra_serviceType","DINE_IN");const _={id:t.id||t._id,_id:t._id||t.id,number:t.number||t.tableNumber,tableNumber:t.tableNumber||t.number,name:t.name||null,qrSlug:e,cartId:t.cartId||t.cafeId||null,cafeId:t.cartId||t.cafeId||null,status:t.status||"AVAILABLE",capacity:t.capacity||null,originalCapacity:t.originalCapacity||null,sessionToken:t.sessionToken||null,currentOrder:t.currentOrder||null},J=_.number;console.log("[Landing] Storing table data:",{scannedSlug:e,storedTableNumber:J,tableId:_.id,qrSlug:_.qrSlug,cartId:_.cartId,status:_.status}),localStorage.setItem("terra_selectedTable",JSON.stringify(_)),localStorage.setItem("terra_scanToken",e);const V=localStorage.getItem("terra_selectedTable");if(V)try{const o=JSON.parse(V);o.qrSlug!==e&&(console.error("[Landing] CRITICAL: Stored table slug doesn't match scanned slug!",{scannedSlug:e,storedSlug:o.qrSlug,tableNumber:o.number}),localStorage.setItem("terra_selectedTable",JSON.stringify(_)),localStorage.setItem("terra_scanToken",e))}catch(o){console.error("[Landing] Failed to verify stored table data:",o)}const N=t.status||(i.status===423?"OCCUPIED":"AVAILABLE");if(N==="AVAILABLE"&&!P&&(u(),console.log("[Landing] Table is AVAILABLE - cleared DINE_IN order data (preserved takeaway data)")),i.status===200&&N==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),u(),console.log("[Landing] Table is AVAILABLE - cleared DINE_IN order data (preserved takeaway data)");const o=s.sessionToken||t.sessionToken;o&&localStorage.setItem("terra_sessionToken",o);return}if(N==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),u(),console.log("[Landing] Table is AVAILABLE - cleared all order data for new customer");const o=s.sessionToken||t.sessionToken;o&&localStorage.setItem("terra_sessionToken",o);return}if(i.status!==423){const o=s.sessionToken||t.sessionToken;C(o,b)}else if(localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"))localStorage.getItem("terra_sessionToken")&&console.log("[Landing] Preserving sessionToken for user with active order");else{const S=s.sessionToken||t.sessionToken;S&&C(S,b)}if(N!=="AVAILABLE"&&(s.waitlist?.token&&T?localStorage.setItem("terra_waitToken",s.waitlist.token):(i.status!==423||!T)&&localStorage.removeItem("terra_waitToken"),s.waitlist?.status==="SEATED"&&s.waitlist?.sessionToken&&(u(),console.log("[Landing] Waitlist user SEATED - cleared all order data for new customer"),C(s.waitlist.sessionToken,b),localStorage.removeItem("terra_waitToken")),s.waitlist?.status==="NOTIFIED"&&(u(),console.log("[Landing] Waitlist user NOTIFIED - cleared all order data for new customer"))),i.status===423){const o=t?.status||"OCCUPIED";if(o==="AVAILABLE"){localStorage.removeItem("terra_waitToken"),u(),console.log("[Landing] Table is AVAILABLE (423 response) - cleared all order data for new customer");const S=s.sessionToken||t?.sessionToken;S&&localStorage.setItem("terra_sessionToken",S);return}if(console.log("[Landing] Table locked (423), waitlist info:",s.waitlist?{token:s.waitlist.token,status:s.waitlist.status,position:s.waitlist.position}:"No waitlist info"),o!=="AVAILABLE")if(s.waitlist?.token){localStorage.setItem("terra_waitToken",s.waitlist.token);const S=s.waitlist?.position||1;alert(s?.message||B("tableOccupiedWaitlist",{position:S}))}else alert(s?.message||l("tableOccupiedJoinWaitlist")),localStorage.removeItem("terra_waitToken");return}}catch(n){if(console.error("Table assignment failed",n),n.message==="Table is currently assigned to another guest"){const c=localStorage.getItem("terra_sessionToken");if(localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_waitToken"),c){setTimeout(m,1e3);return}localStorage.removeItem("terra_scanToken"),alert(l("tableOccupiedAskStaff"))}else n.message&&n.message.includes("merged")?(localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken")):(localStorage.removeItem("terra_scanToken"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_sessionToken"),localStorage.removeItem("terra_selectedTable"),(!n.message||!n.message.includes("merged"))&&(n.message&&n.message.includes("Table not found")?alert(l("tableNotFoundScanAgain")):alert(l("detectTableFailed"))))}finally{r.delete("table");const n=r.toString(),c=`${window.location.pathname}${n?`?${n}`:""}${window.location.hash}`;window.history.replaceState({},"",c),j(!1)}};m()},[]);const v=p.useRef(null),k=p.useRef(!1),w=()=>{if(k.current=!1,v.current){try{v.current.onresult=null,v.current.onerror=null,v.current.onend=null,v.current.stop()}catch(r){console.warn("[Landing] Failed to stop recognition:",r)}v.current=null}},h=(r,e)=>{if(typeof window>"u"||!("speechSynthesis"in window)||!r){typeof e=="function"&&e();return}try{const a=new SpeechSynthesisUtterance(r);a.lang="en-IN",a.rate=1,a.pitch=1,a.onend=()=>{typeof e=="function"&&e()},window.speechSynthesis.cancel(),window.speechSynthesis.speak(a)}catch(a){console.warn("[Landing] Failed to speak message:",a),typeof e=="function"&&e()}},K=r=>{const e=(r||"").toLowerCase().trim();return[{code:"en",keywords:["english","inglish","अंग्रेजी"]},{code:"hi",keywords:["hindi","हिंदी","हिन्दी"]},{code:"mr",keywords:["marathi","मराठी"]},{code:"gu",keywords:["gujarati","ગુજરાતી","गुजराती"]}].find(m=>m.keywords.some(n=>e.includes(n.toLowerCase())))?.code||null},Q=()=>{const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(!r){const a=l("voiceNotSupported");alert(a),h(a);return}w(),k.current=!0;const e=new r;e.lang="en-IN",e.interimResults=!1,e.maxAlternatives=3,e.continuous=!0,e.onresult=a=>{let g="";for(let c=a.resultIndex;c<a.results.length;c+=1){const b=a.results[c];b?.isFinal&&(g+=` ${b[0].transcript}`)}const m=g.trim();if(!m)return;console.log("[Landing] Voice detected:",m);const n=K(m);if(!n){h(l("voiceCannotDetect"));return}w(),h(l("languageSelected"),()=>{W(n)})},e.onerror=a=>{if(a.error==="not-allowed"){const g=l("micPermissionDenied");alert(g),h(g),w();return}if(a.error==="no-speech"){h(l("voiceNoSpeech"));return}a.error!=="aborted"&&h(l("voiceRecognitionError"))},e.onend=()=>{if(k.current)try{e.start()}catch{w()}},v.current=e;try{e.start()}catch(a){console.error("[Landing] Failed to start recognition:",a),w(),h(l("unableStartVoice"))}},G=()=>{if(w(),typeof window>"u"||!("speechSynthesis"in window)){Q();return}const r=[l("voiceReadWelcome"),l("voiceReadSelectLanguage"),l("voiceOptionEnglish"),l("voiceOptionHindi"),l("voiceOptionMarathi"),l("voiceOptionGujarati"),l("voiceNowSayChoice")];k.current=!0,window.speechSynthesis.cancel();const e=window.speechSynthesis.getVoices(),a=e.find(m=>m.lang?.startsWith("en"))||e[0],g=m=>{if(m>=r.length){Q();return}const n=new SpeechSynthesisUtterance(r[m]);n.voice=a||null,n.lang=a?.lang||"en-IN",n.rate=1,n.pitch=1,n.onend=()=>{setTimeout(()=>g(m+1),80)},window.speechSynthesis.speak(n)};g(0)};return p.useEffect(()=>()=>{w(),typeof window<"u"&&"speechSynthesis"in window&&window.speechSynthesis.cancel()},[]),d.jsxs("div",{className:f?"bg-white":"bg-gray-100",children:[d.jsx(ee,{showNavigationTabs:!1,isFixed:!1}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 bg-white"}),d.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center min-h-[calc(100vh-5rem)] px-4 py-4 sm:py-6 md:py-8",children:[d.jsx("div",{className:"mb-8 sm:mb-12 md:mb-16",children:d.jsx("div",{className:`
                rounded-lg py-1 px-1 text-center
                ${f?"border-2 border-orange-800":""}
              `,children:d.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold leading-snug",style:{color:"#1B1212"},children:d.jsx("span",{className:"block",children:l("welcomeTitle")})})})}),Y?d.jsxs("div",{className:"flex flex-col items-center justify-center",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"}),d.jsx("p",{className:"text-lg font-semibold text-gray-700",children:l("loading")})]}):d.jsxs(D.div,{initial:{opacity:0,scale:.9,y:40},animate:{opacity:1,scale:1,y:0},transition:{duration:.6},className:"w-full max-w-md",children:[d.jsx("p",{className:`
                  text-center font-semibold mb-6 sm:mb-8 md:mb-10
                  ${f?"text-xl sm:text-2xl md:text-3xl font-bold bg-white px-3 sm:px-4 py-2 rounded-lg":"text-base sm:text-lg md:text-xl"}
                `,style:{color:"#1B1212"},children:l("selectPreferredLanguage")}),d.jsx("div",{className:"grid grid-cols-1 gap-4",children:te.map(r=>d.jsx(D.button,{whileTap:{scale:.95},whileHover:{scale:1.02},onClick:()=>W(r.code),className:`
                      py-4 sm:py-5 md:py-6 px-6 sm:px-8 rounded-lg font-semibold
                      text-lg sm:text-xl md:text-2xl transition-all duration-200
                      text-white shadow-lg hover:shadow-xl active:scale-95 border-2
                      ${f?"border-gray-800 bg-gray-800":"border-transparent hover:border-white/30"}
                    `,style:{backgroundColor:f?void 0:"#FC8019"},children:r.label},r.code))})]})]})]}),d.jsx(D.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:G,className:"fixed rounded-full shadow-lg bg-orange-600 text-white hover:bg-orange-700 focus:outline-none blind-eye-btn",style:{position:"fixed",bottom:"20px",right:"20px",width:"56px",height:"56px",display:"grid",placeItems:"center",border:"none",cursor:"pointer",boxShadow:"0 6px 18px rgba(0,0,0,0.25)",transition:"transform .2s ease, box-shadow .2s ease, background .2s ease",zIndex:10001,pointerEvents:"auto"},"aria-label":l("blindSupportAria"),children:d.jsx("img",{src:oe,alt:l("blindSupportAria"),width:"24",height:"24",style:{objectFit:"contain",filter:"brightness(0) invert(1)"}})})]})}export{Se as L,oe as b};
