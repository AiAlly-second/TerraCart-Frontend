import{r as l,j as t,u as kr,c as Nr,f as wr,a as Er,b as xr}from"./vendor-react-D1Ov3a92.js";import{r as jr,H as Or}from"./page-Billing.jsx-W-Wu8IRR.js";import{a as Cr}from"./vendor-CB8mghnX.js";import{P as Dr,b as Pr,p as Ut,m as Mr}from"./page-CartPage.jsx-B3qGnVnf.js";/* empty css                          */import{l as Rr}from"./vendor-socket-DJ_CsPWr.js";import{h as Wr,E as Kr}from"./vendor-pdf-KWoZMcRy.js";import{m as Yr}from"./vendor-motion-DMcOTFRV.js";const $r="http://localhost:5050".replace(/\/$/,""),ut="translation_service_unavailable",mt="translation_service_check_timestamp",Ur=6e4,Lr=()=>{try{const n=sessionStorage.getItem(ut),S=sessionStorage.getItem(mt);if(n==="true"&&S){const A=Date.now(),D=parseInt(S,10);if(A-D<Ur)return!0}}catch{}return!1},Lt=()=>{try{sessionStorage.setItem(ut,"true"),sessionStorage.setItem(mt,Date.now().toString())}catch{}},Fr=()=>{try{sessionStorage.removeItem(ut),sessionStorage.removeItem(mt)}catch{}},qr=async(n,S)=>{if(Lr())return n;try{const A=await Cr.post(`${$r}/api/translate`,{text:n,targetLang:S},{validateStatus:()=>!0,timeout:1500,transformRequest:[D=>D],transformResponse:[D=>D]});if(A.status===200&&A.data?.translatedText){Fr();const D=A.data.translatedText;return D.match(/as\s+"(.*?)"/)?.[1]||D||n}else return Lt(),n}catch(A){return(A.code==="ECONNREFUSED"||A.code==="ERR_NETWORK"||A.code==="ECONNABORTED"||A.message==="Network Error"||A.message?.includes("ERR_CONNECTION_REFUSED")||A.message?.includes("timeout"))&&Lt(),n}},Jt=n=>{const[S,A]=l.useState(n),[D,M]=l.useState(!1);return l.useEffect(()=>{const K=localStorage.getItem("language")||"en";K==="en"?(A(n),M(!1)):(M(!0),qr(n,K).then(I=>{A(I),M(!1)}).catch(I=>{A(n),M(!1)}))},[n]),[S,D]},zr={manualEntry:"Menu",smartServe:"Smart Serve",aiOrdered:"AI Ordered:",orderSummary:"Order Summary:",confirm:"Confirm",speakOrder:"Speak Order",processingVoice:"Processing your voice...",cartEmpty:"Cart is empty",resetOrder:"Reset Order",tapToStop:"Tap to Stop",tapToOrder:"Tap to Order",searchPlaceholder:"Search item...",resetOrderBtn:"Reset Order",recordVoiceAria:"Record voice order",processSteps:{checkingOrder:"Checking your order",confirmingItems:"Confirming items & price",placingOrder:"Placing your order",sendingToKitchen:"Sending to kitchen",preparingDetails:"Preparing order details"},dineIn:"Dine-In",table:"Table",takeaway:"Takeaway",callWaiter:"Call Waiter",requestWater:"Request Water",vegOnly:"Veg Only",popular:"Popular",spicy:"Spicy",token:"Token"},Br={manualEntry:"मेनू",smartServe:"स्मार्ट सर्व",aiOrdered:"एआई द्वारा ऑर्डर:",orderSummary:"ऑर्डर सारांश:",confirm:"पुष्टि करें",speakOrder:"ऑर्डर सुनाएं",processingVoice:"आपकी आवाज़ प्रोसेस हो रही है...",cartEmpty:"कार्ट खाली है",resetOrder:"ऑर्डर रीसेट करें",tapToStop:"रोकने के लिए टैप करें",tapToOrder:"ऑर्डर करने के लिए टैप करें",searchPlaceholder:"आइटम खोजें...",resetOrderBtn:"ऑर्डर रीसेट करें",recordVoiceAria:"आवाज़ से ऑर्डर रिकॉर्ड करें",processSteps:{checkingOrder:"आपका ऑर्डर चेक कर रहे हैं",confirmingItems:"आइटम और कीमत की पुष्टि",placingOrder:"ऑर्डर प्लेस कर रहे हैं",sendingToKitchen:"किचन को भेज रहे हैं",preparingDetails:"ऑर्डर विवरण तैयार"},dineIn:"डाइन-इन",table:"टेबल",takeaway:"टेकअवे",callWaiter:"वेटर को बुलाएं",requestWater:"पानी मांगें",vegOnly:"केवल शाकाहारी",popular:"लोकप्रिय",spicy:"मसालेदार",token:"टोकन"},Vr={manualEntry:"मेनू",smartServe:"स्मार्ट सर्व",aiOrdered:"एआय ने ऑर्डर केले:",orderSummary:"ऑर्डर सारांश:",confirm:"निश्चित करा",speakOrder:"ऑर्डर बोला",processingVoice:"तुमचा आवाज प्रोसेस होत आहे...",cartEmpty:"कार्ट रिकामे आहे",resetOrder:"ऑर्डर रीसेट करा",tapToStop:"थांबवण्यासाठी टॅप करा",tapToOrder:"ऑर्डर करण्यासाठी टॅप करा",searchPlaceholder:"वस्तू शोधा...",resetOrderBtn:"ऑर्डर रीसेट करा",recordVoiceAria:"आवाज रेकॉर्ड करा",processSteps:{checkingOrder:"तुमची ऑर्डर तपासत आहे",confirmingItems:"वस्तू आणि किंमत निश्चित करत आहे",placingOrder:"ऑर्डर देत आहे",sendingToKitchen:"किचनला पाठवत आहे",preparingDetails:"ऑर्डर तपशील तयार"},dineIn:"डाइन-इन",table:"टेबल",takeaway:"टेकअवे",callWaiter:"वेटरला बोलवा",requestWater:"पाणी मागवा",vegOnly:"फक्त शाकाहारी",popular:"लोकप्रिय",spicy:"तिखट",token:"टोकन"},Jr={manualEntry:"મેનુ",smartServe:"સ્માર્ટ સર્વ",aiOrdered:"એઆઈ દ્વારા ઓર્ડર:",orderSummary:"ઓર્ડર સારાંશ:",confirm:"પુષ્ટિ કરો",speakOrder:"ઓર્ડર બોલો",processingVoice:"તમારો અવાજ પ્રોસેસ થઈ રહ્યો છે...",cartEmpty:"કાર્ટ ખાલી છે",resetOrder:"ઓર્ડર રીસેટ કરો",tapToStop:"રોકવા માટે ટૅપ કરો",tapToOrder:"ઓર્ડર કરવા માટે ટૅપ કરો",searchPlaceholder:"વસ્તુ શોધો...",resetOrderBtn:"ઓર્ડર રીસેટ કરો",recordVoiceAria:"અવાજ રેકોર્ડ કરો",processSteps:{checkingOrder:"તમારો ઓર્ડર તપાસી રહ્યા છીએ",confirmingItems:"વસ્તુઓ અને કિંમતની પુષ્ટિ",placingOrder:"ઓર્ડર આપી રહ્યા છીએ",sendingToKitchen:"કિચનમાં મોકલી રહ્યા છીએ",preparingDetails:"ઓર્ડર વિગતો તૈયાર"},dineIn:"ડાઇન-ઇન",table:"ટેબલ",takeaway:"ટેકઅવે",callWaiter:"વેટરને બોલાવો",requestWater:"પાણી મંગાવો",vegOnly:"માત્ર શાકાहारी",popular:"લોકપ્રિય",spicy:"મસાલેદાર",token:"ટોકન"},Qr={en:zr,hi:Br,mr:Vr,gu:Jr},Hr={categories:{all_time_hit:"All Time Hit",mini_thali:"Mini Thali",fries:"Fries",starters:"Starters",veg_starters:"Veg Starters",tandoor_specials:"Tandoor Specials",maharashtrian:"Maharashtrian",punjabi:"Punjabi",paneer_specials:"Paneer Specials",rice:"Rice",roti:"Roti",dal:"Dal",chinese:"Chinese",thali:"Thali",desserts:"Desserts",beverages:"Beverages",street_snacks:"Street Snacks",north_indian_curries:"North Indian Curries",breads_rice:"Breads & Rice",regional_specials:"Regional Specials",desserts_beverages:"Desserts & Beverages",main_course:"Main Course"},items:{veg_sandwich:"Veg Sandwich",dosa:"Dosa",peanut_curry:"Peanut Curry",misal:"Misal",paneer_junglee_sandwich:"Paneer Junglee Sandwich",mumbai_sandwich:"Mumbai Sandwich",terra_wada_pav:"Terra Wada Pav",gluten_free_dosai:"Gluten Free Dosai",kothimbir_wadi:"Kothimbir Wadi",bombay_pav_bhaji:"Bombay Pav Bhaji",pizza_bomb:"Pizza Bomb",mini_batata_wada:"Mini Batata Wada",appe_chutney:"Appe & Chutney",namaste_misal_pav_dahi:"Namaste Misal Pav & Dahi",chola_kulcha:"Chola Kulcha",rajma_chawal:"Rajma Chawal",dal_makhni_jeera_rice:"Dal Makhni Jeera Rice",veg_korma_paratha:"Veg Korma & Malbori Paratha",dal_khichadi_dahi:"Dal Fry Rice / Dal Khichadi Dahi",schezwan_rice_manchurian:"Schezwan Rice & Manchurian",mumbai_vada_pav:"Mumbai Vada Pav",punjabi_samosa_chaat:"Punjabi Samosa Chaat",paneer_kathi_roll:"Paneer Kathi Roll",paneer_butter_masala:"Paneer Butter Masala",amritsari_chole:"Amritsari Chole",dal_tadka:"Dal Tadka",garlic_butter_naan:"Garlic Butter Naan",tandoori_roti:"Tandoori Roti",veg_dum_biryani:"Veg Dum Biryani",hyderabadi_chicken_65:"Hyderabadi Chicken 65",goan_fish_curry:"Goan Fish Curry",kerala_parotta_combo:"Kerala Parotta Combo",classic_gulab_jamun:"Classic Gulab Jamun",kulfi_falooda:"Kulfi Falooda",masala_chaas:"Masala Chaas"}},Gr={categories:{all_time_hit:"हमेशा पसंदीदा",mini_thali:"मिनी थाली",fries:"फ्राइज़",starters:"स्टार्टर्स",veg_starters:"शाकाहारी स्टार्टर",tandoor_specials:"तंदूरी स्पेशल",maharashtrian:"महाराष्ट्रीयन",punjabi:"पंजाबी",paneer_specials:"पनीर स्पेशल",rice:"चावल",roti:"रोटी",dal:"दाल",chinese:"चाइनीज़",thali:"थाली",desserts:"मिठाई",beverages:"पेय",street_snacks:"स्ट्रीट स्नैक्स",north_indian_curries:"उत्तर भारतीय करी",breads_rice:"रोटियाँ और चावल",regional_specials:"क्षेत्रीय विशेष",desserts_beverages:"डेसर्ट और पेय",main_course:"मुख्य भोजन"},items:{veg_sandwich:"वेज सैंडविच",dosa:"डोसा",peanut_curry:"पीनट करी",misal:"मिसल",paneer_junglee_sandwich:"पनीर जंगली सैंडविच",mumbai_sandwich:"मुंबई सैंडविच",terra_wada_pav:"टेरा वडा पाव",gluten_free_dosai:"ग्लूटेन फ्री डोसा",kothimbir_wadi:"कोथिंबीर वड़ी",bombay_pav_bhaji:"बॉम्बे पाव भाजी",pizza_bomb:"पिज़्ज़ा बॉम्ब",mini_batata_wada:"मिनी बटाटा वडा",appe_chutney:"अप्पे और चटनी",namaste_misal_pav_dahi:"नमस्ते मिसल पाव और दही",chola_kulcha:"छोला कुलचा",rajma_chawal:"राजमा चावल",dal_makhni_jeera_rice:"दाल मखनी जीरा चावल",veg_korma_paratha:"वेज कोरमा और पराठा",dal_khichadi_dahi:"दाल खिचड़ी दही",schezwan_rice_manchurian:"सिचुआन चावल और मंचूरियन",mumbai_vada_pav:"मुंबई वडा पाव",punjabi_samosa_chaat:"पंजाबी समोसा चाट",paneer_kathi_roll:"पनीर काठी रोल",paneer_butter_masala:"पनीर बटर मसाला",amritsari_chole:"अमृतसरी छोले",dal_tadka:"दाल तड़का",garlic_butter_naan:"गार्लिक बटर नान",tandoori_roti:"तंदूरी रोटी",veg_dum_biryani:"वेज दम बिरयानी",hyderabadi_chicken_65:"हैद्राबादी चिकन 65",goan_fish_curry:"गोअन फिश करी",kerala_parotta_combo:"केरल परोटा कॉम्बो",classic_gulab_jamun:"क्लासिक गुलाब जामुन",kulfi_falooda:"कुल्फी फालूदा",masala_chaas:"मसाला छाछ"}},Xr={categories:{all_time_hit:"सर्वकालीन हिट",mini_thali:"मिनी थाळी",fries:"फ्राईज",starters:"स्टार्टर्स",veg_starters:"व्हेज स्टार्टर",tandoor_specials:"तंदूर स्पेशल",maharashtrian:"महाराष्ट्रीयन",punjabi:"पंजाबी",paneer_specials:"पनीर स्पेशल",rice:"भात",roti:"पोळी",dal:"डाळ",chinese:"चायनीज",thali:"थाळी",desserts:"गोड पदार्थ",beverages:"पेय",street_snacks:"स्ट्रीट स्नॅक्स",north_indian_curries:"उत्तर भारतीय करी",breads_rice:"पोळी आणि भात",regional_specials:"प्रादेशिक स्पेशल",desserts_beverages:"डेझर्ट आणि पेय",main_course:"मुख्य जेवण"},items:{veg_sandwich:"व्हेज सँडविच",dosa:"डोसा",peanut_curry:"शेंगदाणा आमटी",misal:"मिसळ",paneer_junglee_sandwich:"पनीर जंगलि सँडविच",mumbai_sandwich:"मुंबई सँडविच",terra_wada_pav:"टेरा वडा पाव",gluten_free_dosai:"ग्लूटेन फ्री डोसा",kothimbir_wadi:"कोथिंबीर वडी",bombay_pav_bhaji:"बॉम्बे पाव भाजी",pizza_bomb:"पिझ्झा बॉम्ब",mini_batata_wada:"मिनी बटाटा वडा",appe_chutney:"अप्पे आणि चटणी",namaste_misal_pav_dahi:"नमस्ते मिसळ पाव आणि दही",chola_kulcha:"छोला कुलचा",rajma_chawal:"राजमा भात",dal_makhni_jeera_rice:"डाळ मखनी जिरा भात",veg_korma_paratha:"व्हेज कोरमा आणि पराठा",dal_khichadi_dahi:"डाळ खिचडी दही",schezwan_rice_manchurian:"सिचुआन भात आणि मंचुरियन",mumbai_vada_pav:"मुंबई वडा पाव",punjabi_samosa_chaat:"पंजाबी समोसा चाट",paneer_kathi_roll:"पनीर काठी रोल",paneer_butter_masala:"पनीर बटर मसाला",amritsari_chole:"अमृतसरी छोले",dal_tadka:"दाल तडका",garlic_butter_naan:"गार्लिक बटर नान",tandoori_roti:"तंदूरी रोटी",veg_dum_biryani:"व्हेज दम बिर्याणी",hyderabadi_chicken_65:"हैद्राबादी चिकन 65",goan_fish_curry:"गोअन फिश करी",kerala_parotta_combo:"केरळ परोटा कॉम्बो",classic_gulab_jamun:"क्लासिक गुलाब जामुन",kulfi_falooda:"कुल्फी फालूदा",masala_chaas:"मसाला ताक"}},Zr={categories:{all_time_hit:"Succès intemporel",mini_thali:"Mini Thali",fries:"Frites",starters:"Entrées",veg_starters:"Entrées végétariennes",tandoor_specials:"Spécialités Tandoor",maharashtrian:"Maharashtrien",punjabi:"Punjabi",paneer_specials:"Spécial Paneer",rice:"Riz",roti:"Pain",dal:"Lentilles",chinese:"Chinois",thali:"Thali",desserts:"Desserts",beverages:"Boissons"},items:{veg_sandwich:"Sandwich Végétarien",paneer_junglee_sandwich:"Sandwich Paneer Junglee",mumbai_sandwich:"Sandwich Mumbai",terra_wada_pav:"Terra Wada Pav",gluten_free_dosai:"Dosai sans gluten",kothimbir_wadi:"Kothimbir Wadi",bombay_pav_bhaji:"Pav Bhaji de Bombay",pizza_bomb:"Pizza Bomb",mini_batata_wada:"Mini Batata Wada",appe_chutney:"Appe & Chutney",namaste_misal_pav_dahi:"Namaste Misal Pav & Yaourt",chola_kulcha:"Chola Kulcha",rajma_chawal:"Rajma Chawal",dal_makhni_jeera_rice:"Dal Makhni Riz au Cumin",veg_korma_paratha:"Korma Végétarien & Paratha",dal_khichadi_dahi:"Dal Khichadi & Yaourt",schezwan_rice_manchurian:"Riz Schezwan & Manchurian"}},ea={categories:{all_time_hit:"ઓલ ટાઇમ હિટ",mini_thali:"મિની થાળી",fries:"ફ્રાઈસ",starters:"સ્ટાર્ટર્સ",veg_starters:"વેજ સ્ટાર્ટર્સ",tandoor_specials:"તંદૂર સ્પેશિયલ",maharashtrian:"મહારાષ્ટ્રીયન",punjabi:"પંજાબી",paneer_specials:"પનીર સ્પેશિયલ",rice:"ભાત",roti:"રોટલી",dal:"દાળ",chinese:"ચાઈનીઝ",thali:"થાળી",desserts:"મીઠાઈ",beverages:"પીણાં",street_snacks:"સ્ટ્રીટ સ્નેક્સ",north_indian_curries:"ઉત્તર ભારતીય કરી",breads_rice:"રોટલી અને ભાત",regional_specials:"પ્રાદેશિક સ્પેશિયલ",desserts_beverages:"ડેઝર્ટ અને પીણાં",main_course:"મુખ્ય ભોજન"},items:{veg_sandwich:"વેજ સેન્ડવીચ",dosa:"ઢોસા",peanut_curry:"સીંગની કઢી",misal:"મિસળ",paneer_junglee_sandwich:"પનીર જંગલી સેન્ડવીચ",mumbai_sandwich:"મુંબઈ સેન્ડવીચ",terra_wada_pav:"ટેરા વડા પાવ",gluten_free_dosai:"ગ્લુટેન ફ્રી ઢોસા",kothimbir_wadi:"કોથમીર વડી",bombay_pav_bhaji:"બોમ્બે પાવ ભાજી",pizza_bomb:"પીઝા બોમ્બ",mini_batata_wada:"મિની બટાટા વડા",appe_chutney:"અપ્પે અને ચટણી",namaste_misal_pav_dahi:"નમસ્તે મિસળ પાવ અને દહીં",chola_kulcha:"છોલે કુલચા",rajma_chawal:"રાજમા ચાવલ",dal_makhni_jeera_rice:"દાલ મખની જીરા રાઇસ",veg_korma_paratha:"વેજ કોરમા અને પરાઠા",dal_khichadi_dahi:"દાલ ખીચડી દહીં",schezwan_rice_manchurian:"શેઝવાન રાઇસ અને મંચુરિયન",mumbai_vada_pav:"મુંબઈ વડા પાવ",punjabi_samosa_chaat:"પંજાબી સમોસા ચાટ",paneer_kathi_roll:"પનીર કાઠી રોલ",paneer_butter_masala:"પનીર બટર મસાલા",amritsari_chole:"અમૃતસરી છોલે",dal_tadka:"દાલ તડકા",garlic_butter_naan:"ગાર્લિક બટર નાન",tandoori_roti:"તંદૂરી રોટી",veg_dum_biryani:"વેજ દમ બિરયાની",hyderabadi_chicken_65:"હૈદરાબાદી ચિકન 65",goan_fish_curry:"ગોલ્ડન ફિશ કરી",kerala_parotta_combo:"કેરળ પરોટા કોમ્બો",classic_gulab_jamun:"ક્લાસિક ગુલાબ જાંબુ",kulfi_falooda:"કુલ્ફી ફાલુદા",masala_chaas:"મસાલા છાશ"}},ze={en:Hr,hi:Gr,mr:Xr,fr:Zr,gu:ea},ta={DINE_IN:[{key:"placed",label:"Order Placed"},{key:"preparing",label:"Preparing"},{key:"done",label:"Done"}],TAKEAWAY:[{key:"placed",label:"Order Placed"},{key:"preparing",label:"Preparing"},{key:"done",label:"Done"}]},ra={Pending:0,Confirmed:0,Preparing:1,Ready:1,Served:1,Finalized:1,Paid:2,Cancelled:-1,Returned:-1},aa={Pending:0,Confirmed:0,Accept:1,Accepted:1,"Being Prepared":1,BeingPrepared:1,Completed:1,Paid:2,Exit:2,Cancelled:-1,Returned:-1};function oa(n){return ta[n==="TAKEAWAY"?"TAKEAWAY":"DINE_IN"]}function sa(n){if(n==null||n==="")return"Pending";const S=String(n).trim();return S==="Accept"?"Accepted":S==="BeingPrepared"?"Being Prepared":S}function na(n,S){const A=(n??"").toString().trim();if(S==="TAKEAWAY"){const M=sa(A),K=aa[M];return K!==void 0&&K>=0?K:0}const D=ra[A];return D!==void 0&&D>=0?D:0}function la({status:n="Pending",className:S="",updatedAt:A,serviceType:D="DINE_IN",tableLabel:M,reason:K}){const I=oa(D),Y=n??"Pending",F=na(Y,D),O=A?new Date(A).toLocaleTimeString():null,H=["Cancelled","Returned"].includes(Y),le=typeof K=="string"?K.trim():"";return H?t.jsx("div",{className:`order-status-timeline ${S}`,children:t.jsxs("div",{className:"order-status-timeline-step order-status-step-completed",children:[t.jsx("div",{className:"order-status-dot order-status-dot-completed"}),t.jsxs("div",{className:"order-status-step-content",children:[t.jsx("span",{className:"order-status-step-label",children:Y}),O&&t.jsxs("span",{className:"order-status-step-meta",children:["Updated ",O]}),le&&t.jsxs("span",{className:"order-status-step-meta",children:["Reason: ",le]})]})]})}):t.jsxs("div",{className:`order-status-timeline ${S}`,children:[O&&t.jsxs("div",{className:"order-status-updated-meta",children:["Updated ",O]}),I.map((L,ie)=>{const se=ie<F,G=ie===F,ne=ie>F,ge=ie===I.length-1,fe=ie===0&&M?M:L.label;return t.jsx("div",{className:"order-status-timeline-step-wrapper",children:t.jsxs("div",{className:"order-status-timeline-step",children:[t.jsxs("div",{className:"order-status-step-left",children:[t.jsx("div",{className:`order-status-dot ${se?"order-status-dot-completed":""} ${G?"order-status-dot-active":""} ${ne?"order-status-dot-pending":""}`,children:se&&t.jsx("svg",{className:"order-status-check",viewBox:"0 0 12 12",fill:"none",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",children:t.jsx("path",{d:"M2 6l3 3 5-6"})})}),!ge&&t.jsx("div",{className:"order-status-line"})]}),t.jsxs("div",{className:"order-status-step-content",children:[t.jsx("span",{className:`order-status-step-label ${G?"order-status-step-label-active":""} ${ne?"order-status-step-label-pending":""}`,children:fe}),G&&O&&t.jsxs("span",{className:"order-status-step-meta",children:["Updated ",O]})]})]})},L.key)})]})}const R="https://api.terracart.in".replace(/\/$/,""),ia=n=>n?n.startsWith("http://")||n.startsWith("https://")?n:n.startsWith("/")?`${R}${n}`:`${R}/uploads/${n}`:"/defaultImg.jpg",z="terra_serviceType",ye="terra_selectedTable",ca=["Pending","Confirmed","Preparing","Ready","Served","Completed","Paid","Returned","Cancelled"],da=["Pending","Confirmed","Preparing","Ready","Served","Finalized","Completed"],ua=["Paid"],Ft=["Paid","Cancelled","Returned"],ma=n=>{if(n==null)return 0;const S=Number(n);return Number.isNaN(S)?0:S/100},Pe=n=>{const S=Number(n);return Number.isNaN(S)?"0.00":S.toFixed(2)},Qt=n=>String(n||"").replace(/^\(\s*\+\s*\)\s*/u,"").trim()||"Add-on",qt=n=>{if(!n)return null;const S=n.acceptedBy||null,A=n.assignedStaff||null,D=S?.employeeName||A?.name||null;return D?{name:D,role:A?.role||S?.employeeRole||null,disability:S?.disability?.type||A?.disability||null}:null},zt=n=>{if(!n)return"INV-NA";const S=new Date(n.createdAt||Date.now()).toISOString().slice(0,10).replace(/-/g,""),A=(n.cartId||n._id||"").toString().slice(-6).toUpperCase();return`INV-${S}-${A}`},dt=n=>{if(!n)return[];const S=new Map;return(Array.isArray(n.kotLines)?n.kotLines:[]).forEach(M=>{(M?.items||[]).forEach(K=>{if(!K)return;const I=K.name||"Item",Y=Number(K.quantity)||0,F=ma(K.price||0),O=!!K.returned;S.has(I)||S.set(I,{name:I,unitPrice:F,activeQuantity:0,returnedQuantity:0,totalQuantity:0,amount:0,returned:!1});const H=S.get(I);H.totalQuantity+=Y,O?(H.returnedQuantity+=Y,H.returned=!0):(H.activeQuantity+=Y,H.amount+=F*Y),H.unitPrice||(H.unitPrice=F)})}),(n.selectedAddons||[]).forEach(M=>{const K=Qt(M.name),I=`addon:${M.addonId||M._id||M.id||`${K}-${M.price||0}`}`,Y=1,F=Number(M.price)||0;S.has(I)||S.set(I,{name:K,unitPrice:F,activeQuantity:0,returnedQuantity:0,totalQuantity:0,amount:0,returned:!1});const O=S.get(I);O.totalQuantity+=Y,O.activeQuantity+=Y,O.amount+=F*Y}),Array.from(S.values()).map(M=>({...M,quantity:M.activeQuantity}))},Bt=(n,S)=>{if(!n)return{subtotal:0,gst:0,totalAmount:0,totalItems:0};const A=Array.isArray(S)?S:dt(n)||[],D=A.reduce((Y,F)=>{if(!F)return Y;const O=Number(F.amount)||0;return Y+O},0),M=Number(D.toFixed(2));return{subtotal:M,gst:0,totalAmount:M,totalItems:A.reduce((Y,F)=>F?Y+(Number(F.quantity)||0):Y,0)}},Vt=n=>{if(!n)return null;const S=n.paidAt||n.updatedAt||n.createdAt;if(!S)return null;const A=new Date(S);return Number.isNaN(A.getTime())?null:A},ga=n=>{const S={};return n.forEach(A=>{(A.items||[]).forEach(D=>{S[D.name]=D})}),S},Ht=({item:n,onAdd:S,onRemove:A,count:D,lang:M})=>{if(!n)return null;const K=M||localStorage.getItem("language")||"en";let I=null;if(ze[K]?.items){const le=n.name?.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");I=ze[K].items[le]}const[Y]=Jt(n.name||""),F=I||Y,O=n.isAvailable!==!1,H=n?.isFeatured===!0;return t.jsxs(Yr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:`item-card group ${O?"":"unavailable"}`,children:[t.jsxs("div",{className:"item-image-container",children:[t.jsx("img",{src:ia(n?.image),alt:n?.name||"Menu item",className:"item-image"}),H&&t.jsx("span",{className:"special-corner-badge","aria-label":"Special item",children:"Special"})]}),t.jsxs("div",{className:"item-info-section",children:[t.jsx("h4",{className:"item-name",children:F||n?.name||"Unnamed Item"}),t.jsxs("p",{className:"item-price",children:["₹",n?.price||0]}),!O&&t.jsx("span",{className:"item-status-badge unavailable",children:"Not available"})]}),t.jsx("div",{className:"item-footer",children:t.jsxs("div",{className:"item-controls",children:[t.jsx("button",{"aria-label":`Remove one ${n?.name||"item"}`,className:"quantity-button",onClick:()=>n?.name&&A(n.name),disabled:!D,children:"-"}),t.jsx("span",{className:"item-count",children:D||0}),t.jsx("button",{"aria-label":`Add one ${n?.name||"item"}`,className:`quantity-button ${O?"":"disabled"}`,onClick:()=>n&&S(n),disabled:!O,title:O?void 0:"Currently unavailable",children:"+"})]})})]})},pa=({category:n,items:S,cart:A,onAdd:D,onRemove:M,lang:K,defaultOpen:I=!1})=>{if(!n)return null;const Y=K||localStorage.getItem("language")||"en";let F=null;if(ze[Y]?.categories){const se=n?.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");F=ze[Y].categories[se]}const[O]=Jt(n||""),H=F||O,[le,L]=l.useState(I),ie=Array.isArray(S)?S:[];return t.jsxs("div",{className:"category-wrapper",children:[t.jsxs("button",{onClick:()=>L(se=>!se),className:"category-button",children:[H||n," ",t.jsx("span",{children:le?"▲":"▼"})]}),le&&t.jsx("div",{className:"category-items",children:ie.map((se,G)=>t.jsx(Ht,{item:se,onAdd:D,onRemove:M,count:A[se?.name]||0,lang:Y},se?._id||`${n}-${G}`))})]})};function fa(){const n=kr(),S=Nr(),[A,D]=wr(),[M,K]=l.useState(localStorage.getItem("language")||"en");l.useEffect(()=>{const e=()=>{K(localStorage.getItem("language")||"en")};return window.addEventListener("storage",e),window.addEventListener("language-change",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("language-change",e)}},[]);const I=(e,r)=>{if(!e)return r;const s=e.split(".");let o=Qr[M];for(const c of s)o=o?.[c];return o||r},Y=[{label:I("processSteps.checkingOrder","Checking your order"),state:"pending"},{label:I("processSteps.confirmingItems","Confirming items & price"),state:"pending"},{label:I("processSteps.placingOrder","Placing your order"),state:"pending"},{label:I("processSteps.sendingToKitchen","Sending to kitchen"),state:"pending"},{label:I("processSteps.preparingDetails","Preparing order details"),state:"pending"}],[F,O]=l.useState(!1),[H,le]=l.useState(Y),L=(e,r)=>le(s=>s.map((o,c)=>c===e?{...o,state:r}:o)),[ie,se]=l.useState(localStorage.getItem("accessibilityMode")==="true"),[G,ne]=l.useState(()=>{const e=localStorage.getItem("terra_cart");return e?JSON.parse(e):{}}),ge=l.useRef(G);l.useEffect(()=>{localStorage.setItem("terra_cart",JSON.stringify(G)),ge.current=G},[G]);const[fe,_e]=l.useState(!1),[_a,Sa]=l.useState(!1),[gt,Me]=l.useState(""),[Gt,Be]=l.useState(!1),[Ve,pt]=l.useState(!1),[ft,Je]=l.useState(!1),[_t,Qe]=l.useState(!1),[St,It]=l.useState(!1),[ht,Se]=l.useState(!1),[Ia,bt]=l.useState(null),[Xt,ha]=l.useState(!1),[Re,Zt]=l.useState(""),[Ie,yt]=l.useState([]),[he,vt]=l.useState({}),[ve,He]=l.useState(!0),[be,At]=l.useState(null),de=l.useMemo(()=>!Array.isArray(Ie)||Ie.length===0?[]:Ie.flatMap(e=>e?(Array.isArray(e.items)?e.items:[]).map(r=>({...r,categoryName:e?.name||"Menu"})):[]),[Ie]),{cartTotal:er,cartItemCount:Tt}=l.useMemo(()=>{let e=0,r=0;return Object.entries(G).forEach(([s,o])=>{r+=o;const c=de.find(g=>g.name===s);c&&(e+=(c.price||0)*o)}),{cartTotal:e,cartItemCount:r}},[G,de]),kt=l.useMemo(()=>{const e=Re.trim().toLowerCase();return e?!Array.isArray(de)||de.length===0?[]:de.filter(r=>r?.name?r.name.toLowerCase().includes(e)||(r.description||"").toLowerCase().includes(e)||(r.tags||[]).some(s=>s&&s.toLowerCase().includes(e)):!1):[]},[de,Re]),ue=l.useRef(null),Ge=l.useRef(null),xe=l.useRef(null),[T,V]=l.useState(()=>{const e=localStorage.getItem(z)||"DINE_IN";let r=null;return e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r||null}),[x,B]=l.useState(()=>((localStorage.getItem(z)||"DINE_IN")==="TAKEAWAY"?localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"):localStorage.getItem("terra_orderStatus_DINE_IN")||localStorage.getItem("terra_orderStatus"))||null),[me,J]=l.useState(()=>((localStorage.getItem(z)||"DINE_IN")==="TAKEAWAY"?localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt"):localStorage.getItem("terra_orderStatusUpdatedAt_DINE_IN")||localStorage.getItem("terra_orderStatusUpdatedAt"))||null),[E,je]=l.useState(()=>localStorage.getItem("terra_takeaway_only")==="true"?"TAKEAWAY":localStorage.getItem(z)||"DINE_IN"),[$,Xe]=l.useState(()=>{try{const e=localStorage.getItem(ye);return e?JSON.parse(e):null}catch(e){return console.warn("Invalid table selection cache",e),null}}),[We,Z]=l.useState(()=>localStorage.getItem("terra_sessionToken"));l.useEffect(()=>{(async()=>{if((localStorage.getItem(z)||"DINE_IN")==="TAKEAWAY")return;const s=localStorage.getItem("terra_orderId"),o=localStorage.getItem("terra_sessionToken");if(!(!s||!o))try{const c=await fetch(`${R}/api/orders/${s}`);if(!c.ok){c.status===404?(console.log("[Menu] Active order not found (404), clearing order data"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),V(null),B(null),J(null)):console.warn("[Menu] Error verifying order (non-404), keeping existing status:",c.status);return}let g;try{g=await c.json()}catch(u){console.error("[Menu] Failed to parse order response as JSON:",u);return}if(!g)return;g.sessionToken&&g.sessionToken!==o&&(console.log("[Menu] Clearing stale dine-in order data for old session"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),V(null),B(null),J(null))}catch(c){console.warn("[Menu] Error verifying active order session (network error), keeping existing status:",c)}})()},[]),l.useEffect(()=>{const e=localStorage.getItem("terra_sessionToken"),r=We,s=localStorage.getItem(z)||"DINE_IN";e&&r&&e!==r&&(s!=="TAKEAWAY"&&(console.log("[Menu] SessionToken changed - clearing old dine-in order data"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),V(null),B(null),J(null)),Z(e))},[We]),l.useEffect(()=>{const e=localStorage.getItem(z)||"DINE_IN";let r=null;e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r&&r!==T?V(r):!r&&T&&V(null)},[E,T]),l.useEffect(()=>{},[E,n]);const[ba]=l.useState(()=>localStorage.getItem("terra_takeaway_customerName")||""),[ya]=l.useState(()=>localStorage.getItem("terra_takeaway_customerMobile")||""),[va]=l.useState(()=>localStorage.getItem("terra_takeaway_customerEmail")||""),[Oe,Nt]=l.useState(()=>{try{const e=localStorage.getItem("terra_previousOrder");return e?JSON.parse(e):null}catch(e){return console.warn("Invalid previous order cache",e),localStorage.removeItem("terra_previousOrder"),null}}),[W,wt]=l.useState(()=>{try{const e=localStorage.getItem("terra_previousOrderDetail");return e?JSON.parse(e):null}catch(e){return console.warn("Invalid previous order detail cache",e),localStorage.removeItem("terra_previousOrderDetail"),null}}),[Ae,X]=l.useState(null),[tr,Ze]=l.useState(!1),[b,et]=l.useState(null),[Et,Ke]=l.useState(!1),[tt,Te]=l.useState(!1),[Ye,rt]=l.useState(!1),[rr,ke]=l.useState(!1),[Ne,xt]=l.useState(null),[we,at]=l.useState(""),[ot,jt]=l.useState(!1),ce=l.useCallback(e=>{e?(Nt(e),localStorage.setItem("terra_previousOrder",JSON.stringify(e))):(Nt(null),localStorage.removeItem("terra_previousOrder"))},[]),re=l.useCallback(e=>{e?(wt(e),localStorage.setItem("terra_previousOrderDetail",JSON.stringify(e))):(wt(null),localStorage.removeItem("terra_previousOrderDetail"))},[]),$e=l.useCallback((e={})=>{const r=e.orderId||T;if(!r)return;const s=e.status||x||"Confirmed",o=e.updatedAt||me||new Date().toISOString(),c=e.tableInfo||$||(()=>{try{const C=localStorage.getItem(ye);return C?JSON.parse(C):null}catch{return null}})(),g=e.tableNumber??c?.number??c?.tableNumber??null,u=e.tableSlug??c?.qrSlug??localStorage.getItem("terra_scanToken")??null;ce({orderId:r,status:s,updatedAt:o,tableNumber:g,tableSlug:u})},[T,x,me,$,ce]),Ce=l.useMemo(()=>b?zt(b):null,[b]),Ue=l.useMemo(()=>dt(b),[b]),st=l.useMemo(()=>b?Bt(b,Ue):{subtotal:0,gst:0,totalAmount:0,totalItems:0},[b,Ue]),ar=l.useMemo(()=>b?b.serviceType==="TAKEAWAY"?"Takeaway":"Dine-In":"",[b]),or=b?.table?.number??b?.tableNumber??null,Ot=b?.table?.name??null,De=l.useMemo(()=>Vt(b),[b]),Ct=l.useMemo(()=>dt(W),[W]),Dt=l.useMemo(()=>W?Bt(W,Ct):{subtotal:0,gst:0,totalAmount:0,totalItems:0},[W,Ct]),nt=l.useMemo(()=>Vt(W),[W]),Pt=l.useMemo(()=>W?zt(W):null,[W]),Ee=l.useMemo(()=>qt(Ae),[Ae]),Le=l.useMemo(()=>qt(W),[W]),Fe=l.useMemo(()=>{const e=Ae?.takeawayToken??W?.takeawayToken;return e!=null&&e!==""?e:null},[Ae,W]),sr=I("manualEntry","Menu");I("smartServe","Smart Serve");const nr=I("aiOrdered","AI Ordered:");I("orderSummary","Order Summary:"),I("confirm","Confirm"),I("speakOrder","Speak Order");const lr=I("processingVoice","Processing your voice..."),lt=I("cartEmpty","Cart is empty");I("resetOrderBtn","Reset Order");const ir=I("tapToOrder","Tap to Order"),cr=I("tapToStop","Tap to Stop"),dr=I("searchPlaceholder","Search item..."),ur=I("recordVoiceAria","Record voice order");l.useEffect(()=>{x?localStorage.setItem("terra_orderStatus",x):localStorage.removeItem("terra_orderStatus"),me?localStorage.setItem("terra_orderStatusUpdatedAt",me):localStorage.removeItem("terra_orderStatusUpdatedAt")},[x,me]),l.useEffect(()=>{x&&T&&Oe&&ce(null),x&&T&&W&&re(null)},[x,T,Oe,W,ce,re]),l.useEffect(()=>{if(!Oe&&!W)return;const e=localStorage.getItem("terra_scanToken"),r=Oe?.tableSlug;if(r&&e&&r!==e){ce(null),re(null);return}!r&&W?.table?.qrSlug&&e&&W.table.qrSlug!==e&&(ce(null),re(null))},[Oe,W,ce,re]),l.useEffect(()=>{const e=localStorage.getItem(z),r=localStorage.getItem("terra_takeaway_only")==="true";if((localStorage.getItem("terra_orderId_TAKEAWAY")||r)&&e!=="TAKEAWAY"){console.log("[Menu] Detected takeaway order or takeaway-only mode on refresh, setting serviceType to TAKEAWAY"),je("TAKEAWAY"),localStorage.setItem(z,"TAKEAWAY");return}S.state?.serviceType?(je(S.state.serviceType),localStorage.setItem(z,S.state.serviceType)):e?je(e):r&&(console.log("[Menu] Detected takeaway-only QR flow, setting serviceType to TAKEAWAY"),je("TAKEAWAY"),localStorage.setItem(z,"TAKEAWAY")),S.state?.table&&(Xe(S.state.table),localStorage.setItem(ye,JSON.stringify(S.state.table)))},[S.state,je]),l.useEffect(()=>{let e=!1;const r=async()=>{if((localStorage.getItem(z)||S.state?.serviceType||"DINE_IN")!=="DINE_IN")return!0;const g=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),u=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN"),C=g&&(!u||!["Paid","Cancelled","Returned","Completed"].includes(u));if(g)try{const w=await fetch(`${R}/api/orders/${g}`);if(w.ok){const h=await w.json();if(h.status&&!["Paid","Cancelled","Returned","Completed"].includes(h.status))return console.log("[Menu] User has verified active order - allowing access, skipping waitlist check"),!0}}catch(w){if(console.warn("[Menu] Failed to verify order on backend:",w),C)return console.log("[Menu] Order verification failed but order exists in storage - allowing access"),!0}const k=localStorage.getItem("terra_sessionToken"),N=localStorage.getItem("terra_selectedTable");if(k&&N)try{const w=JSON.parse(N);if(w.sessionToken===k)return console.log("[Menu] User has matching sessionToken - allowing access, skipping waitlist check"),!0;const h=w.qrSlug||localStorage.getItem("terra_scanToken");if(h)try{const a=await fetch(`${R}/api/tables/lookup/${h}?sessionToken=${k}`);if(a.ok){const m=await a.json();if(m?.table?.sessionToken===k||m?.table?.activeOrder)return console.log("[Menu] Backend confirms user owns table session - allowing access"),!0}}catch(a){if(console.warn("[Menu] Failed to verify table session on backend:",a),w.sessionToken===k)return!0}}catch(w){console.warn("[Menu] Failed to check sessionToken:",w)}const i=localStorage.getItem("terra_waitToken");if(C&&i)return console.log("[Menu] User has active order but also has waitlist token - clearing waitlist token"),localStorage.removeItem("terra_waitToken"),!0;if(!i)return!0;try{const w=await fetch(`${R}/api/waitlist/status?token=${i}`);if(w.ok){const h=await w.json();if(h.status==="WAITING")return console.log("[Menu] User is in WAITING status - blocking menu access"),alert("You are currently in the waitlist. Please wait for your turn. You will be notified when the table is ready."),n("/secondpage"),!1;if(h.status==="NOTIFIED"||h.status==="SEATED")return!0}}catch(w){console.error("[Menu] Failed to check waitlist status:",w)}return!0},s=async()=>{try{if((localStorage.getItem(z)||S.state?.serviceType||"DINE_IN")==="TAKEAWAY")return;const g=localStorage.getItem("terra_selectedTable");let u=localStorage.getItem("terra_sessionToken");const C=localStorage.getItem("terra_scanToken");if(!g||!C)return;const k=JSON.parse(g),N=k.id||k._id;if(!N)return;let i=!0;try{const p=k.qrSlug||C;if(p){const f=await fetch(`${R}/api/tables/lookup/${p}${u?`?sessionToken=${u}`:""}`).catch(_=>{throw console.warn("[Menu] Network error during table lookup:",_),_});if(f.status===423){let _={};try{_=await f.json()}catch(d){console.warn("[Menu] Failed to parse 423 response (expected for occupied tables):",d)}console.log("[Menu] Table lookup returned 423 (Locked - expected for occupied tables) - handling gracefully");const P=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN");if(P)try{const d=await fetch(`${R}/api/orders/${P}`);if(d.ok){const U=await d.json();if((U.table?.toString()||U.tableId?.toString())===N?.toString()){U.sessionToken&&(u=U.sessionToken,localStorage.setItem("terra_sessionToken",u),Z(u),console.log("[Menu] Table is locked but user has active order - using order's sessionToken:",u)),console.log("[Menu] Table is already occupied by user's active order - skipping markTableOccupied"),i=!1;return}}}catch(d){console.warn("[Menu] Failed to verify order when table is locked:",d)}if(_?.table){const d={...k,..._.table,qrSlug:k.qrSlug||_.table.qrSlug};if(localStorage.setItem("terra_selectedTable",JSON.stringify(d)),_.table.sessionToken){const U=_.table.sessionToken;if(U===u)console.log("[Menu] Table is locked but sessionToken matches - we own this table"),localStorage.setItem("terra_sessionToken",u),Z(u),i=!0;else{const Q=localStorage.getItem("terra_sessionToken");if(Q&&Q===U)console.log("[Menu] Table is locked but stored sessionToken matches table's token - we own this table"),u=Q,localStorage.setItem("terra_sessionToken",u),Z(u),i=!0;else{console.warn("[Menu] Table is locked and sessionToken doesn't match - table belongs to another user"),i=!1;return}}}else if(u)console.log("[Menu] Table is locked and no sessionToken in response, but we have one - proceeding (backend will validate)"),i=!0;else{console.warn("[Menu] Table is locked and no sessionToken available - table belongs to another user"),i=!1;return}}else if(u)console.log("[Menu] Table is locked and no table data in response, but we have sessionToken - proceeding (backend will validate)"),i=!0;else{console.warn("[Menu] Table is locked and user has no active order for this table - skipping markTableOccupied"),i=!1;return}}if(f.ok){const _=await f.json();if(_?.table){const P=_.table,d=P.sessionToken,U={...k,...P,qrSlug:k.qrSlug||P.qrSlug};if(localStorage.setItem("terra_selectedTable",JSON.stringify(U)),d&&d!==u){const Q=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN");if(Q)try{const ee=await fetch(`${R}/api/orders/${Q}`);if(ee.ok){const q=await ee.json();(q.table?.toString()||q.tableId?.toString())===N?.toString()?q.sessionToken?(u=q.sessionToken,localStorage.setItem("terra_sessionToken",u),Z(u),console.log("[Menu] Using order's sessionToken:",u)):(u=d,localStorage.setItem("terra_sessionToken",u),Z(u),console.log("[Menu] Using backend table's sessionToken:",u)):(console.warn("[Menu] User has order but not for this table - skipping markTableOccupied"),i=!1)}}catch(ee){console.warn("[Menu] Failed to verify order:",ee),u=d,localStorage.setItem("terra_sessionToken",u),Z(u)}else console.warn("[Menu] Table has different sessionToken and user has no active order - skipping markTableOccupied"),i=!1}else d&&d===u?console.log("[Menu] SessionToken matches - proceeding with markTableOccupied"):d||console.log("[Menu] Table has no sessionToken - proceeding with markTableOccupied")}}}}catch(p){p?.status!==423&&console.warn("[Menu] Failed to refresh table status before markTableOccupied:",p)}if(!i)return;const w=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),h=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN");if(w&&h&&!["Paid","Cancelled","Returned","Completed"].includes(h)&&w)try{const p=await fetch(`${R}/api/orders/${w}`);if(p.ok){const f=await p.json();if(f.status&&!["Paid","Cancelled","Returned","Completed"].includes(f.status)&&(f.table?.toString()===N?.toString()||f.tableId?.toString()===N?.toString())){console.log("[Menu] User has active order for this table - skipping markTableOccupied"),f.sessionToken&&(localStorage.setItem("terra_sessionToken",f.sessionToken),Z(f.sessionToken));return}}}catch(p){console.warn("[Menu] Failed to verify order before markTableOccupied:",p)}let m;try{m=await Ut(`${R}/api/tables/${N}/occupy`,{sessionToken:u||void 0},{headers:{"Content-Type":"application/json"}},{maxRetries:2,retryDelay:1e3,timeout:15e3,shouldRetry:(p,f)=>p.message?.includes("timeout")||p.message?.includes("Network error")||p.message?.includes("Failed to fetch")||p.message?.includes("CORS")?!0:p.status>=400&&p.status<500?!1:p.status>=500?!0:f<1})}catch(p){console.warn("[Menu] Failed to mark table as occupied after retries:",p),m={ok:!1,status:0,json:async()=>({}),text:async()=>p.message||"Network error"}}if(m.ok){const p=await m.json().catch(()=>null);if(p?.table){const f=p.table.sessionToken||u,_={...k,status:p.table.status||"OCCUPIED",sessionToken:f};localStorage.setItem("terra_selectedTable",JSON.stringify(_)),f&&f!==u&&(localStorage.setItem("terra_sessionToken",f),Z(f),console.log("[Menu] Updated sessionToken after marking table occupied:",f))}else k.status="OCCUPIED",localStorage.setItem("terra_selectedTable",JSON.stringify(k))}else{const p=await m.text().catch(()=>"Unknown error");if(console.warn("Failed to mark table as occupied:",p),m.status===423)try{const f=k.qrSlug||localStorage.getItem("terra_scanToken");if(f){const _=await fetch(`${R}/api/tables/lookup/${f}?sessionToken=${u||""}`);if(_.ok){const P=await _.json().catch(()=>({}));if(P?.table?.sessionToken){const d=P.table.sessionToken;localStorage.setItem("terra_sessionToken",d),Z(d),console.log("[Menu] Table already occupied by us, updated sessionToken:",d)}}}}catch(f){console.warn("Failed to refresh table status:",f)}}}catch(c){console.warn("Error marking table as occupied:",c)}};return(async()=>{try{if(He(!0),At(null),!await r()){He(!1);return}await s();let g="";const u=localStorage.getItem("terra_selectedCartId");if(u)g=u,console.log("[Menu] Using selected cart ID for menu:",g);else{const h=localStorage.getItem("terra_takeaway_cartId");if(h)g=h,console.log("[Menu] Using takeaway QR cart ID for menu:",g);else try{let a=localStorage.getItem("terra_selectedTable");a||(a=localStorage.getItem(ye)||"{}");const m=JSON.parse(a);g=m.cartId||m.cafeId||"",console.log("[Menu] Table data for cartId lookup:",{hasTableData:!!a,tableDataKeys:m?Object.keys(m):[],cartId:m.cartId,cafeId:m.cafeId,foundCartId:g}),g?console.log("[Menu] Using table cart ID for menu:",g):console.warn("[Menu] No cartId or cafeId found in table data:",m)}catch(a){console.error("[Menu] Error parsing table data:",a),console.log("[Menu] No cart ID found, loading default menu")}}const C=g?`${R}/api/menu/public?cartId=${g}`:`${R}/api/menu/public`;console.log("[Menu] Loading menu from:",C,{hasCartId:!!g,cartId:g,serviceType:E});const k=await fetch(C);if(!k.ok)throw new Error(`Menu fetch failed with status ${k.status}`);let N;try{N=await k.json()}catch(h){console.error("[Menu] Failed to parse menu response as JSON:",h);const a=await k.text().catch(()=>"Unknown error");throw new Error(`Invalid menu response format: ${a.substring(0,100)}`)}if(e)return;const i=(Array.isArray(N)?N:[]).map(h=>h?{...h,name:h.name||"Menu",items:(Array.isArray(h.items)?h.items:[]).map(a=>a?{...a,isAvailable:a.isAvailable!==!1,categoryName:h.name||"Menu"}:null).filter(Boolean)}:null).filter(Boolean),w=ga(i);yt(i),vt(w),bt(h=>h||Array.isArray(i)&&i.length>0&&i[0]?.name||null)}catch(c){if(console.error("Menu fetch error",c),e)return;yt([]),vt({}),bt(null),At("Trying to connect to live menu... please check your network or ask staff.")}finally{e||He(!1)}})(),()=>{e=!0}},[]);const Mt=e=>{const r=typeof e=="string"?e:e?.name;if(!r)return;const s=he[r]||e;if(s&&s.isAvailable===!1){alert(`${s.name} is currently unavailable.`);return}ne(o=>({...o,[r]:(o[r]||0)+1}))},Rt=e=>{ne(r=>{const s=(r[e]||0)-1;if(s<=0){const{[e]:o,...c}=r;return c}return{...r,[e]:s}})},ae=e=>new Promise(r=>setTimeout(r,e)),oe={validate:1e3,order:1e3,beforeSend:1e3,kitchen:1e3,summary:1e3,error:1e3},Wt=async()=>{if(Object.keys(ge.current||{}).length===0)return O(!1),alert(lt);if(E==="DINE_IN"&&!T&&!$){O(!1),alert("We couldn't detect your table. Please scan the table QR again or contact staff before placing an order.");return}await mr()},mr=async()=>{let e=T;if(e)try{const r=await fetch(`${R}/api/orders/${e}`);if(r.ok){const s=await r.json();["Paid","Cancelled","Returned"].includes(s.status)&&(console.log("[Menu] Existing order is in blocked status, creating new order instead:",s.status),e=null,V(null),E==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")))}else console.log("[Menu] Could not fetch existing order, creating new order"),e=null,V(null),E==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"))}catch(r){console.warn("[Menu] Error checking existing order, creating new order:",r),e=null,V(null),E==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"))}le(Y.map((r,s)=>{let o=r.label;switch(s){case 0:o=I("processSteps.checkingOrder","Checking your order");break;case 1:o=I("processSteps.confirmingItems","Confirming items & price");break;case 2:o=I("processSteps.placingOrder","Placing your order");break;case 3:o=I("processSteps.sendingToKitchen","Sending to kitchen");break;case 4:o=I("processSteps.preparingDetails","Preparing order details");break}return{...r,label:o,state:"pending"}})),O(!0);try{L(0,"active"),await ae(oe.validate),L(0,"done"),L(1,"active"),await ae(oe.order),L(1,"done"),L(2,"active"),await ae(oe.beforeSend);let r=$;const s=E!=="DINE_IN"&&localStorage.getItem("terra_orderType")||null,o=E!=="DINE_IN"?localStorage.getItem("terra_customerLocation"):null;let c=null;if(o)try{c=JSON.parse(o)}catch(y){console.warn("[Menu] Failed to parse customerLocation from localStorage:",y),c=null}const g=E==="TAKEAWAY"||s==="PICKUP"||s==="DELIVERY",u=g&&(localStorage.getItem("terra_takeaway_customerName")||localStorage.getItem("terra_customerName"))||"",C=g&&(localStorage.getItem("terra_takeaway_customerMobile")||localStorage.getItem("terra_customerMobile"))||"",k=g&&(localStorage.getItem("terra_takeaway_customerEmail")||localStorage.getItem("terra_customerEmail"))||"";let N=null;if(E==="TAKEAWAY"){const y=localStorage.getItem("terra_takeaway_cartId");if(y)N=y;else try{const j=JSON.parse(localStorage.getItem(ye)||"{}");let te=j.cartId||j.cafeId||null;te&&(typeof te=="object"&&te._id?N=te._id:typeof te=="string"?N=te:N=String(te)),console.log("[Menu] Using cartId from table data for takeaway:",N)}catch(j){console.warn("[Menu] Could not get cartId from table data for takeaway order:",j)}}let i=null;E==="TAKEAWAY"?(i=localStorage.getItem("terra_takeaway_sessionToken"),i?console.log("[Menu] Using existing takeaway sessionToken (unified for both flows):",i):(i=`TAKEAWAY-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_takeaway_sessionToken",i),console.log("[Menu] Generated new takeaway sessionToken (unified for both flows):",i))):(i=localStorage.getItem("terra_sessionToken"),i||(i=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_sessionToken",i),Z(i),console.log("[Menu] Generated new DINE_IN sessionToken:",i)));const w=localStorage.getItem("terra_specialInstructions")||null,h=localStorage.getItem("terra_selectedCartId")||N,a=h||(()=>{try{const y=JSON.parse(localStorage.getItem(ye)||"{}"),j=y.cartId||y.cafeId;if(typeof j=="string")return j;if(j&&typeof j=="object"&&j._id)return j._id;if(j!=null)return String(j)}catch{}return""})(),m=localStorage.getItem("terra_cart_addons")||"{}";let p=[];try{const y=JSON.parse(m);Array.isArray(y)?p=y:a&&Array.isArray(y[a])&&(p=y[a])}catch{p=[]}const f=JSON.parse(localStorage.getItem("terra_global_addons")||"[]"),_=Array.isArray(f)?f:[],P=p.map(y=>{const j=_.find(te=>te.id===y);return j?{addonId:y,name:Qt(j.name),price:j.price}:null}).filter(Boolean),d=Pr(ge.current,{serviceType:s?s==="PICKUP"?"PICKUP":"DELIVERY":E,orderType:s==="PICKUP"||s==="DELIVERY"?s:void 0,tableId:r?.id||r?._id||$?.id||$?._id,tableNumber:r?.number??r?.tableNumber??$?.number??$?.tableNumber,menuCatalog:he,sessionToken:i,customerName:g&&u?.trim()?u.trim():void 0,customerMobile:g&&C?.trim()?C.trim():void 0,customerEmail:g&&k?.trim()?k.trim():void 0,cartId:E==="TAKEAWAY"||s?h||N:void 0,customerLocation:c,specialInstructions:w,selectedAddons:P});if(!d.items||!Array.isArray(d.items)||d.items.length===0){console.error("[Menu] Invalid order payload - no items:",d),alert("❌ Your cart is empty. Please add items before placing an order."),L(2,"error"),await ae(oe.error),O(!1);return}const U=d.items.filter(y=>!y.name||typeof y.quantity!="number"||y.quantity<=0||typeof y.price!="number"||y.price<0);if(U.length>0){console.error("[Menu] Invalid order payload - invalid items:",U),alert("❌ Some items in your cart are invalid. Please refresh the page and try again."),L(2,"error"),await ae(oe.error),O(!1);return}if(d.serviceType==="DINE_IN"&&!d.sessionToken&&(i?d.sessionToken=i:(d.sessionToken=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_sessionToken",d.sessionToken),Z(d.sessionToken))),d.serviceType==="PICKUP"||d.serviceType==="DELIVERY"||d.orderType==="PICKUP"||d.orderType==="DELIVERY"){if(!d.customerName||!d.customerName.trim()){alert("❌ Customer name is required for "+(d.orderType||d.serviceType)+" orders. Please provide your name."),L(2,"error"),await ae(oe.error),O(!1);return}if(!d.customerMobile||!d.customerMobile.trim()){alert("❌ Customer mobile number is required for "+(d.orderType||d.serviceType)+" orders. Please provide your mobile number."),L(2,"error"),await ae(oe.error),O(!1);return}}if(d.serviceType==="DELIVERY"||d.orderType==="DELIVERY"){if(!d.customerLocation||!d.customerLocation.latitude||!d.customerLocation.longitude){alert("❌ Delivery location is required. Please go back and provide your delivery address."),L(2,"error"),await ae(oe.error),O(!1);return}if(!d.cartId){alert("❌ Store selection is required for delivery. Please go back and select a store."),L(2,"error"),await ae(oe.error),O(!1);return}try{const y=await fetch(`${R}/api/carts/${d.cartId}?latitude=${d.customerLocation.latitude}&longitude=${d.customerLocation.longitude}&orderType=DELIVERY`);if(y.ok){const j=await y.json();if(j.success&&j.data){const te=j.data;if(!te.canDeliver){let qe=`❌ Delivery not available!

`;te.distance!==null?qe+=`You are ${te.distance.toFixed(2)} km away, but maximum delivery radius is ${te.deliveryRadius||5} km.

`:qe+=`Delivery is not enabled for this store or the store location is not configured.

`,qe+="Please select a different store or choose Pickup instead.",alert(qe),L(2,"error"),await ae(oe.error),O(!1);return}}}}catch(y){console.error("[Menu] Error checking delivery availability:",y)}}const ee=e?`${R}/api/orders/${e}/kot`:`${R}/api/orders`;let q;try{q=await Ut(ee,d,{headers:{"Content-Type":"application/json"}},{maxRetries:2,retryDelay:1500,timeout:3e4,shouldRetry:(y,j)=>y.message?.includes("timeout")||y.message?.includes("Network error")||y.message?.includes("Failed to fetch")||y.message?.includes("CORS")?(console.log(`[Menu] Retrying order creation (attempt ${j+1}/2)...`),!0):y.status>=400&&y.status<500?!1:y.status>=500?!0:j<1})}catch(y){console.error("[Menu] Order creation failed after retries:",y);const j=y.message||"Failed to create order. Please check your connection and try again.";q={ok:!1,status:0,statusText:"Network Error",json:async()=>({message:j}),text:async()=>j,headers:new Headers}}let v;try{if((q.headers?.get?.("content-type")||"").includes("application/json"))v=await q.json();else{const j=await q.text().catch(()=>"");if(j)try{v=JSON.parse(j)}catch{v={message:j||"Unknown error"}}else v={message:"No response from server"}}}catch(y){console.error("[Menu] Failed to parse response:",y);try{v={message:await q.text().catch(()=>"Unknown error")||"Failed to parse server response"}}catch{v={message:"Failed to parse server response"}}}const $t=q.ok&&v?._id;if(console.log("[Menu] Order creation response:",{ok:q.ok,status:q.status,hasOrderId:!!v?._id,orderId:v?._id,orderCreated:$t}),$t)console.log("[Menu] Order created successfully:",v._id);else{if(L(2,"error"),q.status===403){const y=v?.message||"Access denied. Please try refreshing the page.";y.includes("assigned to another guest")||y.includes("table")?alert(`⚠️ ${y}

Please scan the table QR code again or contact staff for assistance.`):alert(`❌ ${y}`)}else if(q.status===400){const y=v?.message||v?.error||"Invalid request. Please check your order and try again.";console.error("[Menu] Order save failed (400 Bad Request):",{status:q.status,statusText:q.statusText,error:v,payload:d,itemsCount:d.items?.length,serviceType:d.serviceType,hasSessionToken:!!d.sessionToken,hasTableId:!!d.tableId,hasTableNumber:!!d.tableNumber});let j=y;v?.message?.includes("No items supplied")?j="Your cart is empty. Please add items before placing an order.":v?.message?.includes("Session token is required")?j="Session token is missing. Please scan the table QR code again.":v?.message?.includes("Table selection is required")?j="Table information is missing. Please scan the table QR code again.":v?.message?.includes("Invalid order items")&&(j="Some items in your cart are invalid. Please refresh the page and try again."),alert(`❌ ${j}`)}else{const y=v?.message||v?.error||"Failed to save order.";console.error("[Menu] Order save failed:",{status:q.status,statusText:q.statusText,error:v,payload:d}),alert(`❌ ${y}`)}await ae(oe.error),O(!1),Se(!1);return}console.log("[Menu] Proceeding with order success flow for order:",v._id),L(2,"done"),L(3,"active"),await ae(oe.kitchen),L(3,"done"),E==="TAKEAWAY"?(localStorage.setItem("terra_orderId_TAKEAWAY",v._id),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),v.sessionToken?(localStorage.setItem("terra_takeaway_sessionToken",v.sessionToken),console.log("[Menu] Stored takeaway sessionToken from order response:",v.sessionToken)):i&&(localStorage.setItem("terra_takeaway_sessionToken",i),console.log("[Menu] Stored generated takeaway sessionToken:",i))):(localStorage.setItem("terra_orderId",v._id),localStorage.setItem("terra_orderId_DINE_IN",v._id),localStorage.removeItem("terra_orderId_TAKEAWAY")),V(v._id),B(v.status||"Confirmed"),J(new Date().toISOString()),X(v),E==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",v.status||"Confirmed"),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",new Date().toISOString())):(localStorage.setItem("terra_orderStatus_DINE_IN",v.status||"Confirmed"),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",new Date().toISOString())),v&&(v.takeawayToken||v.serviceType==="TAKEAWAY")&&re(v),ne({}),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_cart_TAKEAWAY"),Se(!1),console.log("[Menu] Order created and stored:",{orderId:v._id,serviceType:E,storedInLocalStorage:{generic:E==="DINE_IN"?localStorage.getItem("terra_orderId"):null,dineIn:E==="DINE_IN"?localStorage.getItem("terra_orderId_DINE_IN"):null,takeaway:E==="TAKEAWAY"?localStorage.getItem("terra_orderId_TAKEAWAY"):null}}),L(4,"active"),L(4,"done"),O(!1)}catch(r){L(2,"error"),alert("❌ Server Error"),console.error(r),await ae(oe.error),O(!1),Se(!1)}},gr=async()=>{if(fe){try{ue.current&&(ue.current.stop(),ue.current=null)}catch(e){console.warn("Error stopping recognition:",e)}_e(!1);return}if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Your browser doesn't support voice input. Please use the menu buttons to order.");return}try{const e=window.SpeechRecognition||window.webkitSpeechRecognition,r=new e;ue.current=r,r.continuous=!1,r.interimResults=!1,r.maxAlternatives=3,r.lang=Yt(),r.onstart=()=>{_e(!0),Me(""),console.log("🎤 Voice recognition started")},r.onresult=async s=>{const o=s.results[0][0].transcript;console.log("📝 Transcribed:",o),Me(o),_e(!1),Be(!0);try{await Tr(o,{speakFeedback:!1})}catch{}finally{Be(!1)}},r.onerror=s=>{console.error("Voice recognition error:",s.error),_e(!1),Be(!1),ue.current=null,s.error==="no-speech"?alert("No speech detected. Please try again."):s.error==="not-allowed"?alert("Microphone permission denied. Please allow microphone access."):alert("Voice recognition error. Please try again or use menu buttons.")},r.onend=()=>{_e(!1),ue.current=null},_e(!0),r.start()}catch(e){console.error("Error starting voice recognition:",e),alert("Failed to start voice input. Please try again or use menu buttons."),_e(!1)}};l.useEffect(()=>()=>{if(ue.current){try{ue.current.stop()}catch{}ue.current=null}if(Ge.current){try{Ge.current.stop()}catch{}Ge.current=null}typeof window<"u"&&"speechSynthesis"in window&&window.speechSynthesis.cancel()},[]);const pr=()=>{ne({}),localStorage.removeItem("terra_cart")},fr=async()=>{if(!(!x||Ve)){Se(!0),pt(!0);try{if((localStorage.getItem(z)||"DINE_IN")==="TAKEAWAY"){const a=T||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"),m=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken");if(!a){alert("No active order found. Please create a new order.");return}try{const p=await fetch(`${R}/api/orders/${a}`);if(p.ok){const f=await p.json();if(f.status&&["Paid","Cancelled","Returned","Completed"].includes(f.status)){alert("This order has been completed. Please create a new order.");return}V(a),localStorage.setItem("terra_orderId_TAKEAWAY",a),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),B(f.status||x||"Confirmed"),localStorage.setItem("terra_orderStatus_TAKEAWAY",f.status||x||"Confirmed"),f.updatedAt&&(J(f.updatedAt),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",f.updatedAt)),ne({}),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_cart_TAKEAWAY"),alert("You can continue adding items to your takeaway order.");return}else{alert("Order not found. Please create a new order.");return}}catch{alert("Unable to verify order. Please try again or contact staff.");return}}const r=localStorage.getItem("terra_selectedTable"),s=We||localStorage.getItem("terra_sessionToken");if(!r||!s){alert("We couldn't detect your table. Please scan the table QR again or contact staff.");return}let o=null;if(T)try{const a=await fetch(`${R}/api/orders/${T}`);a.ok&&(o=await a.json())}catch{}const c=JSON.parse(r),g=c.qrSlug||localStorage.getItem("terra_scanToken"),u=localStorage.getItem("terra_sessionToken")||s,C=new URLSearchParams;u&&C.set("sessionToken",u);const k=`${R}/api/tables/lookup/${g}${C.toString()?`?${C.toString()}`:""}`;let N=await fetch(k),i=await N.json().catch(()=>({}));if(N.status===423){const a=i?.table?.sessionToken;if(a&&a===u)console.log("[Menu] Table is occupied by current session, proceeding");else{const m=i?.message||"Table is currently assigned to another guest.";if(u){console.warn("Stale session detected, retrying table lookup without session token."),localStorage.removeItem("terra_sessionToken"),Z(null);const f=new URLSearchParams().toString(),_=`${R}/api/tables/lookup/${g}${f?`?${f}`:""}`,P=await fetch(_),d=await P.json().catch(()=>({}));if(!P.ok)throw new Error(d?.message||m||"Unable to refresh table session. Please ask staff for help.");N=P,i=d}else throw new Error(m)}}else if(!N.ok)throw new Error(i?.message||"Failed to refresh table session. Please ask staff for help.");if(i.sessionToken){const a=We||localStorage.getItem("terra_sessionToken"),m=i.sessionToken;m!==a&&(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),V(null),B(null),J(null),ce(null),re(null),["DINE_IN","TAKEAWAY"].forEach(p=>{localStorage.removeItem(`terra_cart_${p}`),localStorage.removeItem(`terra_orderId_${p}`),localStorage.removeItem(`terra_orderStatus_${p}`),localStorage.removeItem(`terra_orderStatusUpdatedAt_${p}`)})),localStorage.setItem("terra_sessionToken",m),Z(m)}i.table&&(localStorage.setItem("terra_selectedTable",JSON.stringify(i.table)),Xe(i.table)),(i.table?.status||"AVAILABLE")==="AVAILABLE"?localStorage.removeItem("terra_waitToken"):i.waitlist?.token?localStorage.setItem("terra_waitToken",i.waitlist.token):localStorage.removeItem("terra_waitToken");const h=i.table||c;if(i.order){const a=localStorage.getItem(z)||"DINE_IN";if(i.order.serviceType&&i.order.serviceType!==a){console.log(`[Menu] Ignoring order from table lookup - serviceType mismatch: order is ${i.order.serviceType}, current is ${a}`);return}V(i.order._id),a==="TAKEAWAY"?(localStorage.setItem("terra_orderId_TAKEAWAY",i.order._id),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN")):(localStorage.setItem("terra_orderId",i.order._id),localStorage.setItem("terra_orderId_DINE_IN",i.order._id),localStorage.removeItem("terra_orderId_TAKEAWAY")),B(i.order.status||x||"Confirmed"),i.order.updatedAt&&(J(i.order.updatedAt),localStorage.setItem("terra_orderStatusUpdatedAt",i.order.updatedAt)),ce(null)}else T?console.log("No order returned from table lookup, keeping existing order status"):($e({status:x||"Completed",updatedAt:me||new Date().toISOString(),tableNumber:h?.number??h?.tableNumber??null,tableSlug:h?.qrSlug??g??null,tableInfo:h}),B(null),J(null),V(null),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"));o&&re(o),alert("You can continue adding items to your order.")}catch(e){console.error("handleOrderAgain error",e),alert(e.message||"Unable to resume ordering. Please contact staff.")}finally{pt(!1),Se(!1)}}},_r=()=>{if(!(E==="TAKEAWAY"?T||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):T||localStorage.getItem("terra_orderId"))){alert("No active order found.");return}xt("Cancel"),at(""),ke(!0)},Sr=()=>{if(!T){alert("No active order found.");return}xt("Return"),at(""),ke(!0)},Ir=async()=>{if(!we.trim()){alert("Please enter a reason.");return}jt(!0);try{if(Ne==="Cancel"){Je(!0);const e=E==="TAKEAWAY"?T||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):T||localStorage.getItem("terra_orderId");let r=null;if(E==="TAKEAWAY"){if(r=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken"),!r)try{const u=await fetch(`${R}/api/orders/${e}`);if(u.ok){const C=await u.json();C?.sessionToken&&(r=C.sessionToken,localStorage.setItem("terra_takeaway_sessionToken",r))}}catch(u){console.warn("[Menu] Failed to fetch order to get sessionToken:",u)}}else r=localStorage.getItem("terra_sessionToken");const s=await fetch(`${R}/api/orders/${e}/customer-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"Cancelled",sessionToken:r||void 0,reason:we})}),o=await s.json().catch(()=>({}));if(!s.ok)throw new Error(o?.message||"Failed to cancel order");const c=o?._id?o:null,g=c?.updatedAt||new Date().toISOString();$e({orderId:c?._id,status:"Cancelled",updatedAt:g,tableNumber:c?.tableNumber??$?.number??$?.tableNumber??null,tableSlug:c?.table?.qrSlug??$?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:c?.table||$}),c&&re(c),B("Cancelled"),J(g),X(c||{status:"Cancelled",cancellationReason:we,updatedAt:g,serviceType:E}),V(null),E==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.setItem("terra_orderStatus_TAKEAWAY","Cancelled"),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",g),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.setItem("terra_orderStatus","Cancelled"),localStorage.setItem("terra_orderStatusUpdatedAt",g),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),console.log("[Menu] Cleared takeaway customer data after order cancellation")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.setItem("terra_orderStatus","Cancelled"),localStorage.setItem("terra_orderStatusUpdatedAt",g),localStorage.setItem("terra_orderStatus_DINE_IN","Cancelled"),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",g),localStorage.removeItem("terra_cart")),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),E==="TAKEAWAY"&&(localStorage.removeItem("terra_waitToken"),console.log("[Menu] Cleared waitlist state for cancelled takeaway order")),ne({}),Se(!1),alert("Your order has been cancelled."),Je(!1)}else if(Ne==="Return"){Qe(!0);const e=localStorage.getItem("terra_sessionToken"),r=await fetch(`${R}/api/orders/${T}/customer-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"Returned",sessionToken:E==="DINE_IN"&&e||void 0,reason:we})}),s=await r.json().catch(()=>({}));if(!r.ok)throw new Error(s?.message||"Failed to return order");const o=s?._id?s:null,c=o?.updatedAt||new Date().toISOString();$e({orderId:o?._id,status:"Returned",updatedAt:c,tableNumber:o?.tableNumber??$?.number??$?.tableNumber??null,tableSlug:o?.table?.qrSlug??$?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:o?.table||$}),o&&re(o),B("Returned"),J(c),X(o||{status:"Returned",cancellationReason:we,updatedAt:c,serviceType:E}),V(null),E==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.setItem("terra_orderStatus_TAKEAWAY","Returned"),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",c),localStorage.setItem("terra_orderStatus","Returned"),localStorage.setItem("terra_orderStatusUpdatedAt",c)):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.setItem("terra_orderStatus","Returned"),localStorage.setItem("terra_orderStatusUpdatedAt",c),localStorage.setItem("terra_orderStatus_DINE_IN","Returned"),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",c)),localStorage.removeItem("terra_cart"),ne({}),Se(!1),E==="TAKEAWAY"&&(localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail")),alert("Your order has been marked as returned."),Qe(!1)}ke(!1)}catch(e){alert(e.message||`Unable to ${Ne.toLowerCase()} order.`),Ne==="Cancel"&&Je(!1),Ne==="Return"&&Qe(!1)}finally{jt(!1)}},hr=async()=>{if(!T){alert("No active order found.");return}if(await window.confirm("Confirm that payment has been completed for this order?")){It(!0);try{const e=localStorage.getItem("terra_sessionToken"),r=await fetch(`${R}/api/orders/${T}/confirm-payment`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethod:"CASH",sessionToken:E==="DINE_IN"&&e||void 0})}),s=await r.json().catch(()=>({}));if(!r.ok)throw new Error(s?.message||"Failed to confirm payment");const o=s?._id?s:null,c=o?.updatedAt||new Date().toISOString();$e({orderId:o?._id,status:"Paid",updatedAt:c,tableNumber:o?.tableNumber??$?.number??$?.tableNumber??null,tableSlug:o?.table?.qrSlug??$?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:o?.table||$}),o&&re(o),B("Paid"),J(c),localStorage.setItem("terra_orderStatus","Paid"),localStorage.setItem("terra_orderStatusUpdatedAt",c),localStorage.setItem("terra_lastPaidOrderId",T),alert("Payment confirmed successfully!")}catch(e){console.error("handleConfirmPayment error",e),alert(e.message||"Unable to confirm payment. Please contact staff.")}finally{It(!1)}}},it=l.useCallback(async()=>{if(!T){alert("We couldn't locate your order. Please contact staff.");return}try{Ke(!0);const e=await fetch(`${R}/api/orders/${T}`),r=await e.json().catch(()=>({}));if(!e.ok)throw new Error(r?.message||"Failed to load invoice details.");console.log("📄 Invoice order data:",{orderId:r._id,franchiseId:r.franchiseId,cafeId:r.cafeId,franchise:r.franchise,cafe:r.cafe}),et(r),Ze(!0)}catch(e){console.error("Invoice fetch failed",e),alert(e.message||"Unable to load invoice. Please contact staff.")}finally{Ke(!1)}},[T]),Kt=l.useCallback(()=>{Ze(!1),et(null),Te(!1),rt(!1),Ke(!1)},[]);l.useCallback(()=>{if(!(!xe.current||!b||tt)){Te(!0);try{const e=document.createElement("iframe");e.style.position="fixed",e.style.right="0",e.style.bottom="0",e.style.width="0",e.style.height="0",e.style.border="0",e.style.visibility="hidden",e.setAttribute("sandbox","allow-same-origin allow-scripts allow-modals"),document.body.appendChild(e);const r=e.contentWindow?.document;if(!r){Te(!1),document.body.removeChild(e),alert("Print preview failed to open. Please check your browser settings.");return}r.open(),r.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>${Ce||"Invoice"}</title>
          <style>
            * { box-sizing: border-box; }
            body {
              font-family: 'Segoe UI', Arial, sans-serif;
              margin: 0;
              padding: 32px;
              background: #ffffff;
              color: #1f2933;
            }
            h1, h2, h3, h4 { margin: 0; }
            table { border-collapse: collapse; width: 100%; }
            th, td { padding: 8px; border-bottom: 1px solid #e5e7eb; }
            th { text-align: left; color: #475569; font-weight: 600; }
            .invoice-shell {
              max-width: 720px;
              margin: 0 auto;
              padding: 24px;
              border: 1px solid #d2d6dc;
              border-radius: 12px;
            }
            @media print {
              body { padding: 0; }
              .invoice-shell { border: none; }
            }
          </style>
        </head>
        <body>
          <div class="invoice-shell">
            ${xe.current.innerHTML}
          </div>
        </body>
      </html>
    `),r.close(),e.onload=function(){setTimeout(()=>{try{e.contentWindow?.focus(),e.contentWindow?.print()}catch(s){console.error("Print failed:",s),alert("Print failed. Please try using your browser's print function (Ctrl+P).")}finally{setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e),Te(!1)},500)}},250)},setTimeout(()=>{tt&&document.body.contains(e)&&(document.body.removeChild(e),Te(!1),console.warn("Print timeout - iframe failed to load"))},5e3)}catch(e){console.error("Print setup failed:",e),Te(!1),alert("Failed to initialize print. Please try again or use Ctrl+P.")}}},[Ce,b,tt]);const br=l.useCallback(async()=>{if(!(!xe.current||!b||Ye)){rt(!0);try{const r=(await Wr(xe.current,{scale:window.devicePixelRatio||2,useCORS:!0,backgroundColor:"#ffffff",onclone:h=>{h.querySelectorAll("*").forEach(m=>{const p=window.getComputedStyle(m);["color","backgroundColor","borderColor"].forEach(f=>{const _=p[f];_&&_.includes("oklch")&&(m.style[f]="#000000",f==="backgroundColor"&&(m.style[f]="transparent"))})})}})).toDataURL("image/png"),s=new Kr("p","mm","a4"),o=s.internal.pageSize.getWidth(),c=s.internal.pageSize.getHeight(),g=10,u=o-g*2,C=s.getImageProperties(r),k=C.height/C.width,N=u*k;let i=N,w=g;for(s.addImage(r,"PNG",g,w,u,N),i-=c-g*2;i>0;)s.addPage(),w=g-(N-i),s.addImage(r,"PNG",g,w,u,N),i-=c-g*2;s.save(`${Ce||"invoice"}.pdf`)}catch(e){console.error("Invoice download failed",e),alert("Failed to generate invoice PDF. Please try again.")}finally{rt(!1)}}},[Ce,b,Ye]);l.useCallback(async()=>{if(["Preparing","Ready","Served","Finalized","Paid"].includes(x)){await it();return}if(x==="Returned"||x==="Cancelled"){alert(x==="Returned"?"This order has already been returned.":"This order has been cancelled.");return}n("/billing")},[x,it,n]);const yr=l.useCallback(()=>{W&&(Ke(!1),et(W),Ze(!0))},[W]),Yt=()=>{const e=localStorage.getItem("language")||"en";return e==="hi"?"hi-IN":e==="mr"?"mr-IN":e==="gu"?"gu-IN":"en-IN"},pe=(e,r)=>{if(!(!e||typeof window>"u"||!("speechSynthesis"in window)))try{const s=new SpeechSynthesisUtterance(e);s.lang=Yt(),s.rate=.95,s.pitch=1,s.onend=()=>{},window.speechSynthesis.cancel(),window.speechSynthesis.speak(s)}catch{}},ct=e=>(e||"").toLowerCase().replace(/[.,!?]/g," ").replace(/\s+/g," ").trim(),vr=e=>{const r={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,ek:1,do:2,teen:3,char:4,paanch:5,che:6,saat:7,aath:8,nau:9,das:10},s=ct(e);if(r[s]!==void 0)return r[s];const o=parseInt(s,10);return Number.isNaN(o)?0:o},Ar=e=>{const r={addedItems:[],notFound:[]};if(!e)return r;const s={...ge.current||{}},o=Array.isArray(de)&&de.length>0?de:Object.values(he).length>0?Object.values(he):Mr.map(u=>({...u,isAvailable:!0})),c=e.replace(/\b(and|aur|plus|with)\b/gi,",").replace(/[;|]/g,",").split(",").map(u=>u.trim()).filter(Boolean),g=u=>ct(u).replace(/[^a-z0-9\s]/g,"");return c.forEach(u=>{let C=1,k=u.replace(/^(add|order|please add|please|i want|give me|mujhe|mala|mane)\s+/i,"").trim();const N=k.match(/^(\d+)\s*(x|times)?\s+(.+)$/i);if(N)C=parseInt(N[1],10)||1,k=N[3].trim();else{const h=k.match(/^(one|two|three|four|five|six|seven|eight|nine|ten|ek|do|teen|char|paanch|che|saat|aath|nau|das)\s+(.+)$/i);h&&(C=vr(h[1])||1,k=h[2].trim())}if(!k)return;const i=g(k),w=o.find(h=>h?.name&&g(h.name)===i)||o.find(h=>{if(!h?.name)return!1;const a=g(h.name);return a.includes(i)||i.includes(a)});w&&w.isAvailable!==!1?(s[w.name]=(s[w.name]||0)+C,r.addedItems.push({name:w.name,qty:C})):r.notFound.push(k)}),ge.current=s,ne(s),r},Tr=async(e,{speakFeedback:r=!1,allowStop:s=!1}={})=>{const o=ct(e);if(!o)return r&&pe("I could not hear you clearly. Please try again."),{type:"empty"};const c=a=>a.some(m=>o.includes(m)),g=["stop","assistant stop","close assistant","stop listening"],u=["confirm order","place order","order now","checkout","submit order","confirm my order","ऑर्डर कन्फर्म","ऑर्डर करो","ऑर्डर प्लेस","ऑર્ડર कન્ફર્મ","ઓર્ડર મૂકો"],C=["open cart","show cart","go to cart","cart kholo","कार्ट","કાર્ટ"],k=["clear cart","empty cart","reset cart","remove all","cart clear","कार्ट खाली","કાર્ટ ખાલી"];if(s&&c(g))return r&&pe("Blind assistant stopped."),{type:"stop"};if(c(k))return pr(),Me(""),r?pe("Cart has been cleared."):alert("Cart cleared."),{type:"clear"};if(c(C))return r&&pe("Opening cart."),n("/cart"),{type:"cart"};if(c(u))return Object.keys(ge.current||{}).length===0?(r?pe(lt||"Your cart is empty."):alert(lt),{type:"place-empty"}):(r&&pe("Placing your order now."),await Wt(),{type:"place"});const{addedItems:N,notFound:i}=Ar(e),w=N.length,h=N.map(({name:a,qty:m})=>`${m}x ${a}`).join(", ");if(h&&Me(h),w>0)r?pe(`Added ${w} item${w>1?"s":""} to your cart.`):i.length>0&&alert(`✅ Added ${w} item(s) to cart.
⚠️ Not found in menu: ${i.join(", ")}`);else if(i.length>0){const a=`Could not find in menu: ${i.join(", ")}. Try saying item names as shown in the menu.`;r?pe(a):alert(a)}return{type:"items",addedItems:N,notFound:i}};return l.useEffect(()=>{const r=(localStorage.getItem(z)||"DINE_IN")==="TAKEAWAY";let s=null;if(r?s=T||localStorage.getItem("terra_orderId_TAKEAWAY"):s=T||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),!s){const a=r?localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"):localStorage.getItem("terra_orderStatus_DINE_IN")||localStorage.getItem("terra_orderStatus"),m=r?localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt"):localStorage.getItem("terra_orderStatusUpdatedAt_DINE_IN")||localStorage.getItem("terra_orderStatusUpdatedAt");Ft.includes(a||"")?(B(a),J(m||null)):(B(null),J(null)),X(null);return}if(ht)return;let o,c,g=!1,u=null;const C=a=>{if(!o||!a)return;const m=String(a);u!==m&&(o.emit("join:cart",m),u=m)},k=async()=>{try{const a=localStorage.getItem(z)||"DINE_IN";let m=null;if(a==="TAKEAWAY"?m=T||localStorage.getItem("terra_orderId_TAKEAWAY"):m=T||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),!m){X(null);return}const p=localStorage.getItem("terra_sessionToken");let f;try{f=await fetch(`${R}/api/orders/${m}`,{signal:AbortSignal.timeout(5e3)})}catch{g||(console.warn("[Menu] Backend server appears to be offline. Will retry automatically."),g=!0);return}if(g&&(g=!1),!f.ok){f.status===404&&(console.warn("Order not found (404), clearing order data"),a==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")),V(null),B(null),J(null),X(null));return}let _;try{_=await f.json()}catch(Q){console.error("[Menu] Failed to parse order status response as JSON:",Q);return}if(!_)return;const P=localStorage.getItem("terra_serviceType")||"DINE_IN",d=P==="TAKEAWAY";if(_.serviceType&&_.serviceType!==P){console.log(`[Menu] Ignoring order update - serviceType mismatch: order is ${_.serviceType}, current is ${P}`);return}const U=d&&localStorage.getItem("terra_takeaway_sessionToken")||p;if(d){if(U&&_.sessionToken&&_.sessionToken!==U)return}else if(U&&_.sessionToken&&_.sessionToken!==U){localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),V(null),B(null),J(null),X(null),ce(null),re(null);return}if(X(_),_.cartId&&C(_.cartId),d&&re(_),_?.status){if((d?localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"):localStorage.getItem("terra_orderStatus_DINE_IN")||localStorage.getItem("terra_orderStatus"))===_.status&&x===_.status)return;const ee=new Date().toISOString();B(_.status),J(ee),d?(localStorage.setItem("terra_orderStatus_TAKEAWAY",_.status),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",ee),localStorage.setItem("terra_orderStatus",_.status),localStorage.setItem("terra_orderStatusUpdatedAt",ee)):(localStorage.setItem("terra_orderStatus_DINE_IN",_.status),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",ee),localStorage.setItem("terra_orderStatus",_.status),localStorage.setItem("terra_orderStatusUpdatedAt",ee))}}catch{}};k(),c=setInterval(k,2e4);try{o=Rr(R,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,timeout:6e4,connectTimeout:6e4,autoConnect:!0,forceNew:!1});let a=!1;o.on("connect",()=>{a=!1,g=!1;const m=Ae?.cartId,p=localStorage.getItem("terra_takeaway_cartId");let f=null;try{const _=JSON.parse(localStorage.getItem(ye)||"{}"),P=_.cartId||_.cafeId;f=typeof P=="object"&&P?._id?P._id:P}catch{f=null}C(m||p||f)}),o.on("connect_error",m=>{a||(console.warn("[Menu] Socket connection error - backend may be offline. Will retry automatically."),a=!0)}),o.on("disconnect",m=>{})}catch(a){console.warn("[Menu] Failed to create socket connection:",a),o=null}const N=a=>{const m=localStorage.getItem(z)||"DINE_IN";let p=null;if(m==="TAKEAWAY"?p=T||localStorage.getItem("terra_orderId_TAKEAWAY"):p=T||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),String(a?._id||"")===String(p||"")&&a?.status&&a?.serviceType===m){if(localStorage.getItem("terra_orderStatus")===a.status&&x===a.status)return;if(m==="TAKEAWAY"&&a.sessionToken){const P=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken");if(P&&a.sessionToken!==P)return}const _=new Date().toISOString();B(a.status),J(_),X(a),a.cartId&&C(a.cartId),localStorage.setItem("terra_orderStatus",a.status),localStorage.setItem("terra_orderStatusUpdatedAt",_),m==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",a.status),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",_)):(localStorage.setItem("terra_orderStatus_DINE_IN",a.status),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",_))}},i=a=>{if(!a)return;const m=localStorage.getItem(z)||"DINE_IN";let p=null;m==="TAKEAWAY"?p=T||localStorage.getItem("terra_orderId_TAKEAWAY"):p=T||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId");const f=a.orderId||a.order?._id;if(!f||String(f)!==String(p||""))return;const _=a.status||a.order?.status||"Confirmed",P=new Date().toISOString();if(B(_),J(P),localStorage.setItem("terra_orderStatus",_),localStorage.setItem("terra_orderStatusUpdatedAt",P),m==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",_),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",P)):(localStorage.setItem("terra_orderStatus_DINE_IN",_),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",P)),a.order&&typeof a.order=="object"){X(a.order),a.order.cartId&&C(a.order.cartId);return}a.assignedStaff&&X(d=>{const U=d?{...d}:{_id:f};return U.status=_,U.assignedStaff=a.assignedStaff,U.acceptedBy||(U.acceptedBy={employeeId:a.assignedStaff.id||null,employeeName:a.assignedStaff.name||null,employeeRole:a.assignedStaff.role||null,disability:{hasDisability:!!a.assignedStaff.disability,type:a.assignedStaff.disability||null}}),U})},w=a=>{const m=localStorage.getItem(z)||"DINE_IN";let p=null;m==="TAKEAWAY"?p=T||localStorage.getItem("terra_orderId_TAKEAWAY"):p=T||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),a?.id===p&&(B(null),V(null),X(null),m==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")))},h=a=>{const m=$||(()=>{try{const v=localStorage.getItem("terra_selectedTable");return v?JSON.parse(v):null}catch{return null}})();if(!m)return;const p=a.id||a._id,f=m.id||m._id,_=p&&f&&String(p)===String(f),P=a.number&&m.number&&String(a.number)===String(m.number);if(!_&&!P)return;console.log("[Menu] Table status updated via socket:",a.status,"Previous status:",m.status);const d={...m,status:a.status,currentOrder:a.currentOrder||null,sessionToken:a.sessionToken||m.sessionToken};Xe(d),localStorage.setItem("terra_selectedTable",JSON.stringify(d));const U=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),Q=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN"),ee=U&&(!Q||!["Paid","Cancelled","Returned","Completed"].includes(Q)),q=Ft.includes(Q||"");a.status==="AVAILABLE"&&(!ee&&!q?(console.log("[Menu] Table became AVAILABLE via socket - clearing waitlist state and order data (user has no active order)"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),["DINE_IN","TAKEAWAY"].forEach(v=>{localStorage.removeItem(`terra_cart_${v}`),localStorage.removeItem(`terra_orderId_${v}`),localStorage.removeItem(`terra_orderStatus_${v}`),localStorage.removeItem(`terra_orderStatusUpdatedAt_${v}`)}),V(null),B(null),X(null),console.log("[Menu] Cleared all order data for new customer")):console.log(q?"[Menu] Table became AVAILABLE but preserving final customer order status":"[Menu] Table became AVAILABLE but user has active order - preserving order data"))};return o&&(o.on("orderUpdated",N),o.on("ORDER_ACCEPTED",i),o.on("orderDeleted",w),o.on("table:status:updated",h)),()=>{c&&clearInterval(c),o&&(o.off("orderUpdated",N),o.off("ORDER_ACCEPTED",i),o.off("orderDeleted",w),o.off("table:status:updated",h),o.disconnect())}},[T,ht,E]),l.useEffect(()=>{const e=localStorage.getItem(z)||"DINE_IN";if(e==="TAKEAWAY"?T||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):T||localStorage.getItem("terra_orderId")){const s=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"),o=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt");s&&(s!==x&&(console.log("[Menu] Syncing orderStatus from localStorage:",s),B(s)),o&&o!==me&&J(o))}},[T,x,me]),l.useEffect(()=>{const e=localStorage.getItem(z)||"DINE_IN";let r=null;if(e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r&&r!==T&&(console.log("[Menu] Restoring activeOrderId on mount:",r,"serviceType:",e),V(r)),r&&!x){const s=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"),o=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt");s&&(B(s),o&&J(o))}},[]),l.useEffect(()=>{if(!T){X(null);return}let e=!1;return(async()=>{try{const s=await fetch(`${R}/api/orders/${T}`,{signal:AbortSignal.timeout(5e3)});if(!s.ok)return;const o=await s.json();if(e||!o)return;const c=localStorage.getItem(z)||"DINE_IN";if(o.serviceType&&o.serviceType!==c)return;X(o)}catch{}})(),()=>{e=!0}},[T,E]),l.useEffect(()=>{if(A.get("action")==="confirm"&&!ve){if(be||Object.keys(he).length===0){console.error("[Menu] Auto-confirm aborted: Menu data missing or error",{menuCatalogSize:Object.keys(he).length,menuError:be});const r=new URLSearchParams(A);r.delete("action"),D(r),alert(be?"Cannot place order automatically: "+be:"Cannot place order automatically: Menu prices not loaded. Please try again manually.");return}const e=new URLSearchParams(A);e.delete("action"),D(e),O(!0),Wt()}},[A,ve,he,be]),t.jsxs("div",{className:`menu-root ${ie?"accessibility-mode":""}`,children:[t.jsx("div",{className:"background-image",style:{backgroundImage:`url(${jr})`}}),t.jsx("div",{className:"overlay"}),t.jsx(Or,{accessibilityMode:ie,onClickCart:()=>n("/cart"),cartCount:Tt}),t.jsx("div",{className:"content-wrapper",children:t.jsx("div",{className:"main-container",children:t.jsxs("div",{className:"panels-container",children:[t.jsxs("div",{className:"left-panel",children:[t.jsxs("div",{className:"order-header-section",children:[t.jsxs("div",{className:"order-header-info",children:[t.jsx("div",{className:"order-header-badge",children:E==="DINE_IN"?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"order-header-icon",children:"📍"}),t.jsx("span",{children:$?.number?`${I("dineIn","Dine-In")} - ${I("table","Table")} ${$.number}`:I("dineIn","Dine-In")})]}):t.jsx("span",{children:I("takeaway","Takeaway")})}),E==="DINE_IN"&&t.jsxs("div",{className:"guest-count-badge",children:[t.jsx("span",{className:"guest-icon",children:"👥"}),t.jsx("span",{children:$?.seats||$?.capacity||2})]})]}),E==="TAKEAWAY"&&Fe&&t.jsxs("span",{className:"token-badge",children:[I("token","Token"),":"," ",t.jsx("strong",{children:Fe})]})]}),t.jsx("button",{type:"button",onClick:gr,className:`voice-button ${fe?"recording":""}`,"aria-pressed":fe,"aria-label":ur,disabled:ve,children:fe?t.jsx(Er,{}):t.jsx(xr,{})}),t.jsx("p",{className:"instruction-text",children:ve?I("loadingMenu","Loading menu...")||"Loading menu...":Gt?lr:fe?cr:ir}),E==="DINE_IN"&&t.jsxs("div",{className:"action-buttons-row",children:[t.jsx("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,o=localStorage.getItem("terra_orderId")||null,c="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${c}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"assistance",customerNotes:"Call Waiter",...o&&{orderId:o}})})).ok)alert("✅ Waiter called! Someone will be with you shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error calling waiter:",e),alert("❌ Failed to call waiter. Please try again.")}},className:"action-button call-waiter-button",children:I("callWaiter","Call Waiter")}),T?t.jsxs("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,o=localStorage.getItem("terra_orderId")||null,c="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${c}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"bill",customerNotes:"Request Bill",...o&&{orderId:o}})})).ok)alert("✅ Bill requested! Someone will bring it shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error requesting bill:",e),alert("❌ Failed to request bill. Please try again.")}},className:"action-button request-bill-button",children:["🧾 ",I("requestBill","Request Bill")]}):t.jsxs("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,o=localStorage.getItem("terra_orderId")||null,c="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${c}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"water",customerNotes:"Request Water",...o&&{orderId:o}})})).ok)alert("✅ Water requested! Someone will bring it shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error requesting water:",e),alert("❌ Failed to request water. Please try again.")}},className:"action-button request-water-button",children:["💧 ",I("requestWater","Request Water")]})]}),gt&&t.jsxs("p",{className:"ai-ordered-text",children:[nr," ",t.jsx("span",{className:"order-text-italic",children:gt})]}),x&&t.jsxs("div",{className:"order-status-card",children:[t.jsx("h4",{className:"order-summary-title",children:"Order Status"}),E==="TAKEAWAY"&&Fe&&t.jsxs("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsxs("div",{className:"text-sm font-semibold text-blue-700",children:["Your Token:"," ",t.jsx("span",{className:"text-lg font-bold",children:Fe})]}),t.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Please keep this token for reference"})]}),t.jsx("div",{className:"order-status-section",children:t.jsx(la,{status:x,updatedAt:me,reason:Ae?.cancellationReason||W?.cancellationReason,serviceType:E,tableLabel:E==="DINE_IN"&&$?.number?`Dine-In | Table ${$.number}`:null})}),Ee?.name&&t.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg text-center",children:[t.jsxs("p",{className:"text-green-800 font-medium",children:["Your order is being handled by ",Ee.name]}),Ee.role&&t.jsxs("p",{className:"text-sm text-gray-700 mt-1",children:["Role: ",Ee.role]}),Ee.disability&&t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Disability Support: ",Ee.disability]})]}),t.jsxs("div",{className:"button-group status-actions",children:[(()=>{const e=(x||"").toLowerCase();return["paid","completed"].includes(e)&&ua.includes(x)?t.jsx("button",{className:"reset-button return-button",onClick:Sr,disabled:_t,children:_t?"Processing...":"Return Order"}):da.includes(x)?t.jsx("button",{className:"reset-button cancel-button",onClick:_r,disabled:ft,children:ft?"Cancelling...":"Cancel Order"}):x==="Returned"||x==="Cancelled"?t.jsx("button",{className:"billing-button billing-button-disabled",disabled:!0,children:x==="Returned"?"Order Returned":"Order Cancelled"}):null})(),["Pending","Placed","Confirmed","Preparing","Ready","Served","Finalized","Completed","Paid"].includes(x)?t.jsx("button",{className:"billing-button",onClick:it,disabled:Et,children:Et?"Opening...":"View Invoice"}):null,t.jsx("button",{className:"confirm-button",onClick:fr,disabled:Ve||x&&!ca.includes(x),children:Ve?"Please wait...":"Order More"}),(()=>{const e=(x||"").toLowerCase();return["Finalized","Completed"].includes(x)?t.jsx("button",{className:"billing-button",onClick:hr,disabled:St,children:St?"Confirming...":"Confirm Payment"}):x!=="Returned"&&x!=="Cancelled"&&!["paid","completed"].includes(e)?t.jsx("button",{className:"complete-payment-button",onClick:()=>{n("/billing")},children:"Payment"}):["paid","completed"].includes(e)?t.jsx("button",{className:"feedback-button",onClick:()=>{const r=T||localStorage.getItem("terra_orderId")||localStorage.getItem("terra_lastPaidOrderId");n("/feedback",{state:{orderId:r}})},children:"Share Feedback"}):null})()]})]}),W&&t.jsxs("div",{className:"order-status-card previous-order-detail-card",style:{padding:"12px",fontSize:"0.9rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsx("h4",{className:"order-summary-title",style:{margin:0,fontSize:"1rem"},children:"Last Order"}),W.status&&t.jsx("span",{className:"meta-chip status-chip",style:{fontSize:"0.75rem",padding:"4px 8px"},children:W.status})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px",flexWrap:"wrap",fontSize:"0.8rem"},children:[Pt&&t.jsx("span",{className:"meta-chip",style:{fontSize:"0.75rem",padding:"2px 6px"},children:Pt}),nt&&t.jsx("span",{className:"meta-chip",style:{fontSize:"0.75rem",padding:"2px 6px"},children:nt?nt.toLocaleDateString():"N/A"})]}),Le?.name&&t.jsxs("div",{style:{marginBottom:"8px",padding:"8px",borderRadius:"8px",background:"#ecfdf5",border:"1px solid #bbf7d0",fontSize:"0.8rem"},children:[t.jsx("strong",{children:"Handled by:"})," ",Le.name,Le.role&&t.jsxs("span",{children:[" (",Le.role,")"]})]}),t.jsx("div",{style:{marginBottom:"8px",fontSize:"0.85rem"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"600"},children:[t.jsxs("span",{children:["Total: ₹",Pe(Dt?.totalAmount||0)]}),t.jsxs("span",{children:[Dt?.totalItems||0," items"]})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("button",{className:"invoice-action-btn download w-full sm:w-auto",onClick:yr,style:{padding:"6px 12px",fontSize:"0.85rem"},children:"View Invoice"}),W._id&&t.jsx("button",{className:"feedback-button w-full sm:w-auto",onClick:()=>{const e=W._id;n("/feedback",{state:{orderId:e}})},style:{backgroundColor:"#10b981",color:"#ffffff",border:"1px solid #059669",fontWeight:"600",padding:"6px 12px",fontSize:"0.85rem"},children:"Feedback"})]})]})]}),t.jsxs("div",{className:"right-panel",children:[t.jsx("h3",{className:"manual-entry-title",children:sr}),t.jsx("input",{type:"text",placeholder:dr,value:Re,onChange:e=>Zt(e.target.value),className:"search-input"}),be&&!ve&&t.jsx("div",{className:"menu-warning",children:be}),ve?t.jsx("div",{className:"menu-loading-message",children:"Loading menu, please wait..."}):Re.trim()?kt.length>0?t.jsx("div",{className:"search-results",children:kt.map(e=>t.jsx(Ht,{item:e,onAdd:Mt,onRemove:Rt,count:G[e.name]||0,lang:M},e._id||e.name))}):t.jsx("div",{className:"search-no-results",children:"No matching items found. Try another keyword."}):t.jsx("div",{className:"category-container",children:Ie.length===0?t.jsx("div",{className:"search-no-results",children:"Menu is not configured yet. Please contact the administrator."}):t.jsx(t.Fragment,{children:(Array.isArray(Ie)?Ie:[]).map((e,r)=>t.jsx(pa,{defaultOpen:r===0,category:e?.name||"Unnamed Category",items:Array.isArray(e?.items)?e.items:[],cart:G,onAdd:Mt,onRemove:Rt,lang:M},e?._id||e?.name||Math.random()))})})]})]})})}),tr&&t.jsx("div",{className:"invoice-modal-overlay",onClick:Kt,children:t.jsxs("div",{className:"invoice-modal",role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"invoice-modal-header",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Invoice"}),b&&t.jsxs("div",{className:"invoice-meta",children:[t.jsx("span",{children:`Order #${b._id||"—"}`}),De&&t.jsx("span",{children:De.toLocaleString()})]})]}),t.jsxs("div",{className:"invoice-modal-actions",children:[t.jsx("button",{onClick:br,disabled:!b||Ye,className:"invoice-action-btn download",children:Ye?"Preparing…":"Download"}),t.jsx("button",{onClick:Kt,className:"invoice-close-btn","aria-label":"Close invoice modal",children:"✕"})]})]}),t.jsxs("div",{ref:xe,className:"invoice-preview",children:[t.jsxs("div",{className:"invoice-top",children:[t.jsxs("div",{children:[t.jsx("div",{className:"brand-name",children:b?.cafe?.cafeName||b?.cafe?.name||"Terra Cart"}),t.jsx("div",{className:"brand-address",children:b?.cafe?.address||b?.franchise?.address||"123 Main Street, City"}),(b?.franchise?.fssaiNumber||b?.franchise?.fssai||b?.cafe?.fssaiNumber||b?.cafe?.fssai)&&t.jsxs("div",{className:"brand-address",children:["FSSAI No:"," ",b.franchise?.fssaiNumber||b.franchise?.fssai||b.cafe?.fssaiNumber||b.cafe?.fssai]}),(b?.franchise?.gstNumber||b?.cafe?.gstNumber)&&t.jsxs("div",{className:"brand-address",children:["FSSAI No:"," ",b.franchise?.gstNumber||b.cafe?.gstNumber]})]}),t.jsxs("div",{className:"invoice-meta-block",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Invoice No:"}),t.jsx("span",{children:Ce||"—"})]}),b?.serviceType==="TAKEAWAY"&&b?.takeawayToken&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Token:"}),t.jsx("span",{className:"font-bold text-blue-600",children:b.takeawayToken})]}),De&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Date:"}),t.jsx("span",{children:De.toLocaleDateString()})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Time:"}),t.jsx("span",{children:De.toLocaleTimeString()})]})]})]})]}),t.jsxs("div",{className:"invoice-billed",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Service:"}),t.jsx("span",{children:ar})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Table:"}),t.jsxs("span",{children:[b?.serviceType==="TAKEAWAY"?"Takeaway Counter":or||"—",Ot?` · ${Ot}`:""]})]}),b?.serviceType==="TAKEAWAY"&&(b.customerName||b.customerMobile)&&t.jsxs(t.Fragment,{children:[b.customerName&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Customer Name:"}),t.jsx("span",{children:b.customerName})]}),b.customerMobile&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Mobile Number:"}),t.jsx("span",{children:b.customerMobile})]})]}),b?.specialInstructions&&t.jsxs("div",{className:"meta-line",style:{marginTop:"8px",borderTop:"1px dashed #e5e7eb",paddingTop:"4px"},children:[t.jsx("span",{style:{color:"#d97706",fontWeight:"bold"},children:"Note:"}),t.jsx("span",{style:{fontStyle:"italic"},children:b.specialInstructions})]})]}),t.jsxs("table",{className:"invoice-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Item"}),t.jsx("th",{children:"Qty"}),t.jsx("th",{children:"Price (₹)"}),t.jsx("th",{className:"align-right",children:"Amount (₹)"})]})}),t.jsx("tbody",{children:Ue.length>0?Ue.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{children:e.name}),e.returned&&t.jsxs("span",{className:"invoice-returned-note",children:["Returned ",e.returnedQuantity]})]})}),t.jsx("td",{children:e.quantity>0?e.quantity:"—"}),t.jsxs("td",{children:["₹",Pe(e.unitPrice)]}),t.jsx("td",{className:"align-right",children:e.quantity>0?`₹${Pe(e.amount)}`:"Returned"})]},e.name)):t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"empty-row",children:"No items found"})})})]}),t.jsxs("div",{className:"invoice-totals",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Total Items"}),t.jsx("span",{children:st.totalItems})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Subtotal"}),t.jsxs("span",{children:["₹",Pe(st.subtotal)]})]}),t.jsxs("div",{className:"meta-line total",children:[t.jsx("span",{children:"Total"}),t.jsxs("span",{children:["₹",Pe(st.totalAmount)]})]})]}),t.jsx("div",{className:"invoice-footer",children:"Thank you for dining with Terra Cart. We hope to see you again!"})]})]})}),rr&&t.jsx("div",{className:"invoice-modal-overlay",onClick:()=>ke(!1),children:t.jsxs("div",{className:"invoice-modal reason-modal",style:{maxWidth:"24rem",maxHeight:"auto",height:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"invoice-modal-header",children:[t.jsx("div",{children:t.jsx("h3",{children:Ne==="Cancel"?"Cancel Order":"Return Order"})}),t.jsx("button",{onClick:()=>ke(!1),className:"invoice-close-btn",children:"✕"})]}),t.jsxs("div",{style:{paddingTop:"0.25rem"},children:[t.jsx("p",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"0.9rem",color:"#666"},children:"Please provide a reason:"}),t.jsx("textarea",{style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"0.5rem",minHeight:"100px",fontSize:"0.9rem",marginBottom:"1rem",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"},placeholder:"e.g. Changed my mind, Taking too long...",value:we,onChange:e=>at(e.target.value)}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem"},children:[t.jsx("button",{className:"reset-button",style:{width:"auto",flex:"1"},onClick:()=>ke(!1),disabled:ot,children:"Close"}),t.jsx("button",{className:"confirm-button",style:{width:"auto",flex:"1"},onClick:Ir,disabled:ot,children:ot?"Processing...":"Confirm"})]})]})]})}),Object.keys(G).length>0&&!Xt&&t.jsx("div",{className:"menu-cart-footer",children:t.jsxs("div",{className:"menu-cart-footer-inner",children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsxs("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[Tt," Items"]}),t.jsxs("span",{style:{color:"#666",fontSize:"0.9rem"},children:["Total: ₹",er.toFixed(2)]})]}),t.jsx("button",{onClick:()=>n("/cart"),style:{backgroundColor:"#ff6b35",color:"white",padding:"12px 24px",borderRadius:"50px",fontWeight:"bold",fontSize:"1rem",border:"none",cursor:"pointer",boxShadow:"0 4px 6px rgba(255, 107, 53, 0.3)"},children:"View Cart →"})]})}),t.jsx(Dr,{open:F,steps:H,title:"Processing your order"})]})}const Oa=Object.freeze(Object.defineProperty({__proto__:null,default:fa},Symbol.toStringTag,{value:"Module"}));export{Oa as M,la as O};
