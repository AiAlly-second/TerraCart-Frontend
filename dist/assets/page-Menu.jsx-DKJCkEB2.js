import{r as i,j as t,u as _r,c as Ir,f as Sr,a as hr,b as br}from"./vendor-react-D1Ov3a92.js";import{r as yr,H as vr}from"./page-Billing.jsx-W-Wu8IRR.js";import{a as Ar}from"./vendor-CB8mghnX.js";import{P as Tr,a as kr,b as Nr,p as Pt,m as wr}from"./page-CartPage.jsx-CBUVA__J.js";/* empty css                          */import{l as Er}from"./vendor-socket-DJ_CsPWr.js";import{h as xr,E as jr}from"./vendor-pdf-KWoZMcRy.js";import{m as Or}from"./vendor-motion-DMcOTFRV.js";const Cr="http://localhost:5050".replace(/\/$/,""),nt="translation_service_unavailable",lt="translation_service_check_timestamp",Dr=6e4,Pr=()=>{try{const n=sessionStorage.getItem(nt),I=sessionStorage.getItem(lt);if(n==="true"&&I){const v=Date.now(),D=parseInt(I,10);if(v-D<Dr)return!0}}catch{}return!1},Mt=()=>{try{sessionStorage.setItem(nt,"true"),sessionStorage.setItem(lt,Date.now().toString())}catch{}},Mr=()=>{try{sessionStorage.removeItem(nt),sessionStorage.removeItem(lt)}catch{}},Wr=async(n,I)=>{if(Pr())return n;try{const v=await Ar.post(`${Cr}/api/translate`,{text:n,targetLang:I},{validateStatus:()=>!0,timeout:1500,transformRequest:[D=>D],transformResponse:[D=>D]});if(v.status===200&&v.data?.translatedText){Mr();const D=v.data.translatedText;return D.match(/as\s+"(.*?)"/)?.[1]||D||n}else return Mt(),n}catch(v){return(v.code==="ECONNREFUSED"||v.code==="ERR_NETWORK"||v.code==="ECONNABORTED"||v.message==="Network Error"||v.message?.includes("ERR_CONNECTION_REFUSED")||v.message?.includes("timeout"))&&Mt(),n}},$t=n=>{const[I,v]=i.useState(n),[D,P]=i.useState(!1);return i.useEffect(()=>{const M=localStorage.getItem("language")||"en";M==="en"?(v(n),P(!1)):(P(!0),Wr(n,M).then(S=>{v(S),P(!1)}).catch(S=>{v(n),P(!1)}))},[n]),[I,D]},Rr={manualEntry:"Menu",smartServe:"Smart Serve",aiOrdered:"AI Ordered:",orderSummary:"Order Summary:",confirm:"Confirm",speakOrder:"Speak Order",processingVoice:"Processing your voice...",cartEmpty:"Cart is empty",resetOrder:"Reset Order",tapToStop:"Tap to Stop",tapToOrder:"Tap to Order",searchPlaceholder:"Search item...",resetOrderBtn:"Reset Order",recordVoiceAria:"Record voice order",processSteps:{checkingOrder:"Checking your order",confirmingItems:"Confirming items & price",placingOrder:"Placing your order",sendingToKitchen:"Sending to kitchen",preparingDetails:"Preparing order details"},dineIn:"Dine-In",table:"Table",takeaway:"Takeaway",callWaiter:"Call Waiter",requestWater:"Request Water",vegOnly:"Veg Only",popular:"Popular",spicy:"Spicy",token:"Token"},Kr={manualEntry:"मेनू",smartServe:"स्मार्ट सर्व",aiOrdered:"एआई द्वारा ऑर्डर:",orderSummary:"ऑर्डर सारांश:",confirm:"पुष्टि करें",speakOrder:"ऑर्डर सुनाएं",processingVoice:"आपकी आवाज़ प्रोसेस हो रही है...",cartEmpty:"कार्ट खाली है",resetOrder:"ऑर्डर रीसेट करें",tapToStop:"रोकने के लिए टैप करें",tapToOrder:"ऑर्डर करने के लिए टैप करें",searchPlaceholder:"आइटम खोजें...",resetOrderBtn:"ऑर्डर रीसेट करें",recordVoiceAria:"आवाज़ से ऑर्डर रिकॉर्ड करें",processSteps:{checkingOrder:"आपका ऑर्डर चेक कर रहे हैं",confirmingItems:"आइटम और कीमत की पुष्टि",placingOrder:"ऑर्डर प्लेस कर रहे हैं",sendingToKitchen:"किचन को भेज रहे हैं",preparingDetails:"ऑर्डर विवरण तैयार"},dineIn:"डाइन-इन",table:"टेबल",takeaway:"टेकअवे",callWaiter:"वेटर को बुलाएं",requestWater:"पानी मांगें",vegOnly:"केवल शाकाहारी",popular:"लोकप्रिय",spicy:"मसालेदार",token:"टोकन"},Yr={manualEntry:"मेनू",smartServe:"स्मार्ट सर्व",aiOrdered:"एआय ने ऑर्डर केले:",orderSummary:"ऑर्डर सारांश:",confirm:"निश्चित करा",speakOrder:"ऑर्डर बोला",processingVoice:"तुमचा आवाज प्रोसेस होत आहे...",cartEmpty:"कार्ट रिकामे आहे",resetOrder:"ऑर्डर रीसेट करा",tapToStop:"थांबवण्यासाठी टॅप करा",tapToOrder:"ऑर्डर करण्यासाठी टॅप करा",searchPlaceholder:"वस्तू शोधा...",resetOrderBtn:"ऑर्डर रीसेट करा",recordVoiceAria:"आवाज रेकॉर्ड करा",processSteps:{checkingOrder:"तुमची ऑर्डर तपासत आहे",confirmingItems:"वस्तू आणि किंमत निश्चित करत आहे",placingOrder:"ऑर्डर देत आहे",sendingToKitchen:"किचनला पाठवत आहे",preparingDetails:"ऑर्डर तपशील तयार"},dineIn:"डाइन-इन",table:"टेबल",takeaway:"टेकअवे",callWaiter:"वेटरला बोलवा",requestWater:"पाणी मागवा",vegOnly:"फक्त शाकाहारी",popular:"लोकप्रिय",spicy:"तिखट",token:"टोकन"},$r={manualEntry:"મેનુ",smartServe:"સ્માર્ટ સર્વ",aiOrdered:"એઆઈ દ્વારા ઓર્ડર:",orderSummary:"ઓર્ડર સારાંશ:",confirm:"પુષ્ટિ કરો",speakOrder:"ઓર્ડર બોલો",processingVoice:"તમારો અવાજ પ્રોસેસ થઈ રહ્યો છે...",cartEmpty:"કાર્ટ ખાલી છે",resetOrder:"ઓર્ડર રીસેટ કરો",tapToStop:"રોકવા માટે ટૅપ કરો",tapToOrder:"ઓર્ડર કરવા માટે ટૅપ કરો",searchPlaceholder:"વસ્તુ શોધો...",resetOrderBtn:"ઓર્ડર રીસેટ કરો",recordVoiceAria:"અવાજ રેકોર્ડ કરો",processSteps:{checkingOrder:"તમારો ઓર્ડર તપાસી રહ્યા છીએ",confirmingItems:"વસ્તુઓ અને કિંમતની પુષ્ટિ",placingOrder:"ઓર્ડર આપી રહ્યા છીએ",sendingToKitchen:"કિચનમાં મોકલી રહ્યા છીએ",preparingDetails:"ઓર્ડર વિગતો તૈયાર"},dineIn:"ડાઇન-ઇન",table:"ટેબલ",takeaway:"ટેકઅવે",callWaiter:"વેટરને બોલાવો",requestWater:"પાણી મંગાવો",vegOnly:"માત્ર શાકાहारी",popular:"લોકપ્રિય",spicy:"મસાલેદાર",token:"ટોકન"},Ur={en:Rr,hi:Kr,mr:Yr,gu:$r},Lr={categories:{all_time_hit:"All Time Hit",mini_thali:"Mini Thali",fries:"Fries",starters:"Starters",veg_starters:"Veg Starters",tandoor_specials:"Tandoor Specials",maharashtrian:"Maharashtrian",punjabi:"Punjabi",paneer_specials:"Paneer Specials",rice:"Rice",roti:"Roti",dal:"Dal",chinese:"Chinese",thali:"Thali",desserts:"Desserts",beverages:"Beverages",street_snacks:"Street Snacks",north_indian_curries:"North Indian Curries",breads_rice:"Breads & Rice",regional_specials:"Regional Specials",desserts_beverages:"Desserts & Beverages",main_course:"Main Course"},items:{veg_sandwich:"Veg Sandwich",dosa:"Dosa",peanut_curry:"Peanut Curry",misal:"Misal",paneer_junglee_sandwich:"Paneer Junglee Sandwich",mumbai_sandwich:"Mumbai Sandwich",terra_wada_pav:"Terra Wada Pav",gluten_free_dosai:"Gluten Free Dosai",kothimbir_wadi:"Kothimbir Wadi",bombay_pav_bhaji:"Bombay Pav Bhaji",pizza_bomb:"Pizza Bomb",mini_batata_wada:"Mini Batata Wada",appe_chutney:"Appe & Chutney",namaste_misal_pav_dahi:"Namaste Misal Pav & Dahi",chola_kulcha:"Chola Kulcha",rajma_chawal:"Rajma Chawal",dal_makhni_jeera_rice:"Dal Makhni Jeera Rice",veg_korma_paratha:"Veg Korma & Malbori Paratha",dal_khichadi_dahi:"Dal Fry Rice / Dal Khichadi Dahi",schezwan_rice_manchurian:"Schezwan Rice & Manchurian",mumbai_vada_pav:"Mumbai Vada Pav",punjabi_samosa_chaat:"Punjabi Samosa Chaat",paneer_kathi_roll:"Paneer Kathi Roll",paneer_butter_masala:"Paneer Butter Masala",amritsari_chole:"Amritsari Chole",dal_tadka:"Dal Tadka",garlic_butter_naan:"Garlic Butter Naan",tandoori_roti:"Tandoori Roti",veg_dum_biryani:"Veg Dum Biryani",hyderabadi_chicken_65:"Hyderabadi Chicken 65",goan_fish_curry:"Goan Fish Curry",kerala_parotta_combo:"Kerala Parotta Combo",classic_gulab_jamun:"Classic Gulab Jamun",kulfi_falooda:"Kulfi Falooda",masala_chaas:"Masala Chaas"}},Fr={categories:{all_time_hit:"हमेशा पसंदीदा",mini_thali:"मिनी थाली",fries:"फ्राइज़",starters:"स्टार्टर्स",veg_starters:"शाकाहारी स्टार्टर",tandoor_specials:"तंदूरी स्पेशल",maharashtrian:"महाराष्ट्रीयन",punjabi:"पंजाबी",paneer_specials:"पनीर स्पेशल",rice:"चावल",roti:"रोटी",dal:"दाल",chinese:"चाइनीज़",thali:"थाली",desserts:"मिठाई",beverages:"पेय",street_snacks:"स्ट्रीट स्नैक्स",north_indian_curries:"उत्तर भारतीय करी",breads_rice:"रोटियाँ और चावल",regional_specials:"क्षेत्रीय विशेष",desserts_beverages:"डेसर्ट और पेय",main_course:"मुख्य भोजन"},items:{veg_sandwich:"वेज सैंडविच",dosa:"डोसा",peanut_curry:"पीनट करी",misal:"मिसल",paneer_junglee_sandwich:"पनीर जंगली सैंडविच",mumbai_sandwich:"मुंबई सैंडविच",terra_wada_pav:"टेरा वडा पाव",gluten_free_dosai:"ग्लूटेन फ्री डोसा",kothimbir_wadi:"कोथिंबीर वड़ी",bombay_pav_bhaji:"बॉम्बे पाव भाजी",pizza_bomb:"पिज़्ज़ा बॉम्ब",mini_batata_wada:"मिनी बटाटा वडा",appe_chutney:"अप्पे और चटनी",namaste_misal_pav_dahi:"नमस्ते मिसल पाव और दही",chola_kulcha:"छोला कुलचा",rajma_chawal:"राजमा चावल",dal_makhni_jeera_rice:"दाल मखनी जीरा चावल",veg_korma_paratha:"वेज कोरमा और पराठा",dal_khichadi_dahi:"दाल खिचड़ी दही",schezwan_rice_manchurian:"सिचुआन चावल और मंचूरियन",mumbai_vada_pav:"मुंबई वडा पाव",punjabi_samosa_chaat:"पंजाबी समोसा चाट",paneer_kathi_roll:"पनीर काठी रोल",paneer_butter_masala:"पनीर बटर मसाला",amritsari_chole:"अमृतसरी छोले",dal_tadka:"दाल तड़का",garlic_butter_naan:"गार्लिक बटर नान",tandoori_roti:"तंदूरी रोटी",veg_dum_biryani:"वेज दम बिरयानी",hyderabadi_chicken_65:"हैद्राबादी चिकन 65",goan_fish_curry:"गोअन फिश करी",kerala_parotta_combo:"केरल परोटा कॉम्बो",classic_gulab_jamun:"क्लासिक गुलाब जामुन",kulfi_falooda:"कुल्फी फालूदा",masala_chaas:"मसाला छाछ"}},qr={categories:{all_time_hit:"सर्वकालीन हिट",mini_thali:"मिनी थाळी",fries:"फ्राईज",starters:"स्टार्टर्स",veg_starters:"व्हेज स्टार्टर",tandoor_specials:"तंदूर स्पेशल",maharashtrian:"महाराष्ट्रीयन",punjabi:"पंजाबी",paneer_specials:"पनीर स्पेशल",rice:"भात",roti:"पोळी",dal:"डाळ",chinese:"चायनीज",thali:"थाळी",desserts:"गोड पदार्थ",beverages:"पेय",street_snacks:"स्ट्रीट स्नॅक्स",north_indian_curries:"उत्तर भारतीय करी",breads_rice:"पोळी आणि भात",regional_specials:"प्रादेशिक स्पेशल",desserts_beverages:"डेझर्ट आणि पेय",main_course:"मुख्य जेवण"},items:{veg_sandwich:"व्हेज सँडविच",dosa:"डोसा",peanut_curry:"शेंगदाणा आमटी",misal:"मिसळ",paneer_junglee_sandwich:"पनीर जंगलि सँडविच",mumbai_sandwich:"मुंबई सँडविच",terra_wada_pav:"टेरा वडा पाव",gluten_free_dosai:"ग्लूटेन फ्री डोसा",kothimbir_wadi:"कोथिंबीर वडी",bombay_pav_bhaji:"बॉम्बे पाव भाजी",pizza_bomb:"पिझ्झा बॉम्ब",mini_batata_wada:"मिनी बटाटा वडा",appe_chutney:"अप्पे आणि चटणी",namaste_misal_pav_dahi:"नमस्ते मिसळ पाव आणि दही",chola_kulcha:"छोला कुलचा",rajma_chawal:"राजमा भात",dal_makhni_jeera_rice:"डाळ मखनी जिरा भात",veg_korma_paratha:"व्हेज कोरमा आणि पराठा",dal_khichadi_dahi:"डाळ खिचडी दही",schezwan_rice_manchurian:"सिचुआन भात आणि मंचुरियन",mumbai_vada_pav:"मुंबई वडा पाव",punjabi_samosa_chaat:"पंजाबी समोसा चाट",paneer_kathi_roll:"पनीर काठी रोल",paneer_butter_masala:"पनीर बटर मसाला",amritsari_chole:"अमृतसरी छोले",dal_tadka:"दाल तडका",garlic_butter_naan:"गार्लिक बटर नान",tandoori_roti:"तंदूरी रोटी",veg_dum_biryani:"व्हेज दम बिर्याणी",hyderabadi_chicken_65:"हैद्राबादी चिकन 65",goan_fish_curry:"गोअन फिश करी",kerala_parotta_combo:"केरळ परोटा कॉम्बो",classic_gulab_jamun:"क्लासिक गुलाब जामुन",kulfi_falooda:"कुल्फी फालूदा",masala_chaas:"मसाला ताक"}},Br={categories:{all_time_hit:"Succès intemporel",mini_thali:"Mini Thali",fries:"Frites",starters:"Entrées",veg_starters:"Entrées végétariennes",tandoor_specials:"Spécialités Tandoor",maharashtrian:"Maharashtrien",punjabi:"Punjabi",paneer_specials:"Spécial Paneer",rice:"Riz",roti:"Pain",dal:"Lentilles",chinese:"Chinois",thali:"Thali",desserts:"Desserts",beverages:"Boissons"},items:{veg_sandwich:"Sandwich Végétarien",paneer_junglee_sandwich:"Sandwich Paneer Junglee",mumbai_sandwich:"Sandwich Mumbai",terra_wada_pav:"Terra Wada Pav",gluten_free_dosai:"Dosai sans gluten",kothimbir_wadi:"Kothimbir Wadi",bombay_pav_bhaji:"Pav Bhaji de Bombay",pizza_bomb:"Pizza Bomb",mini_batata_wada:"Mini Batata Wada",appe_chutney:"Appe & Chutney",namaste_misal_pav_dahi:"Namaste Misal Pav & Yaourt",chola_kulcha:"Chola Kulcha",rajma_chawal:"Rajma Chawal",dal_makhni_jeera_rice:"Dal Makhni Riz au Cumin",veg_korma_paratha:"Korma Végétarien & Paratha",dal_khichadi_dahi:"Dal Khichadi & Yaourt",schezwan_rice_manchurian:"Riz Schezwan & Manchurian"}},zr={categories:{all_time_hit:"ઓલ ટાઇમ હિટ",mini_thali:"મિની થાળી",fries:"ફ્રાઈસ",starters:"સ્ટાર્ટર્સ",veg_starters:"વેજ સ્ટાર્ટર્સ",tandoor_specials:"તંદૂર સ્પેશિયલ",maharashtrian:"મહારાષ્ટ્રીયન",punjabi:"પંજાબી",paneer_specials:"પનીર સ્પેશિયલ",rice:"ભાત",roti:"રોટલી",dal:"દાળ",chinese:"ચાઈનીઝ",thali:"થાળી",desserts:"મીઠાઈ",beverages:"પીણાં",street_snacks:"સ્ટ્રીટ સ્નેક્સ",north_indian_curries:"ઉત્તર ભારતીય કરી",breads_rice:"રોટલી અને ભાત",regional_specials:"પ્રાદેશિક સ્પેશિયલ",desserts_beverages:"ડેઝર્ટ અને પીણાં",main_course:"મુખ્ય ભોજન"},items:{veg_sandwich:"વેજ સેન્ડવીચ",dosa:"ઢોસા",peanut_curry:"સીંગની કઢી",misal:"મિસળ",paneer_junglee_sandwich:"પનીર જંગલી સેન્ડવીચ",mumbai_sandwich:"મુંબઈ સેન્ડવીચ",terra_wada_pav:"ટેરા વડા પાવ",gluten_free_dosai:"ગ્લુટેન ફ્રી ઢોસા",kothimbir_wadi:"કોથમીર વડી",bombay_pav_bhaji:"બોમ્બે પાવ ભાજી",pizza_bomb:"પીઝા બોમ્બ",mini_batata_wada:"મિની બટાટા વડા",appe_chutney:"અપ્પે અને ચટણી",namaste_misal_pav_dahi:"નમસ્તે મિસળ પાવ અને દહીં",chola_kulcha:"છોલે કુલચા",rajma_chawal:"રાજમા ચાવલ",dal_makhni_jeera_rice:"દાલ મખની જીરા રાઇસ",veg_korma_paratha:"વેજ કોરમા અને પરાઠા",dal_khichadi_dahi:"દાલ ખીચડી દહીં",schezwan_rice_manchurian:"શેઝવાન રાઇસ અને મંચુરિયન",mumbai_vada_pav:"મુંબઈ વડા પાવ",punjabi_samosa_chaat:"પંજાબી સમોસા ચાટ",paneer_kathi_roll:"પનીર કાઠી રોલ",paneer_butter_masala:"પનીર બટર મસાલા",amritsari_chole:"અમૃતસરી છોલે",dal_tadka:"દાલ તડકા",garlic_butter_naan:"ગાર્લિક બટર નાન",tandoori_roti:"તંદૂરી રોટી",veg_dum_biryani:"વેજ દમ બિરયાની",hyderabadi_chicken_65:"હૈદરાબાદી ચિકન 65",goan_fish_curry:"ગોલ્ડન ફિશ કરી",kerala_parotta_combo:"કેરળ પરોટા કોમ્બો",classic_gulab_jamun:"ક્લાસિક ગુલાબ જાંબુ",kulfi_falooda:"કુલ્ફી ફાલુદા",masala_chaas:"મસાલા છાશ"}},Fe={en:Lr,hi:Fr,mr:qr,fr:Br,gu:zr},Vr={DINE_IN:[{key:"placed",label:"Order Placed"},{key:"preparing",label:"Preparing"},{key:"done",label:"Done"}],TAKEAWAY:[{key:"placed",label:"Order Placed"},{key:"preparing",label:"Preparing"},{key:"done",label:"Done"}]},Jr={Pending:0,Confirmed:0,Preparing:1,Ready:1,Served:1,Finalized:1,Paid:2,Cancelled:-1,Returned:-1},Qr={Pending:0,Confirmed:0,Accept:1,Accepted:1,"Being Prepared":1,BeingPrepared:1,Completed:1,Paid:2,Exit:2,Cancelled:-1,Returned:-1};function Hr(n){return Vr[n==="TAKEAWAY"?"TAKEAWAY":"DINE_IN"]}function Gr(n){if(n==null||n==="")return"Pending";const I=String(n).trim();return I==="Accept"?"Accepted":I==="BeingPrepared"?"Being Prepared":I}function Xr(n,I){const v=(n??"").toString().trim();if(I==="TAKEAWAY"){const P=Gr(v),M=Qr[P];return M!==void 0&&M>=0?M:0}const D=Jr[v];return D!==void 0&&D>=0?D:0}function Zr({status:n="Pending",className:I="",updatedAt:v,serviceType:D="DINE_IN",tableLabel:P}){const M=Hr(D),S=n??"Pending",L=Xr(S,D),Y=v?new Date(v).toLocaleTimeString():null;return["Cancelled","Returned"].includes(S)?t.jsx("div",{className:`order-status-timeline ${I}`,children:t.jsxs("div",{className:"order-status-timeline-step order-status-step-completed",children:[t.jsx("div",{className:"order-status-dot order-status-dot-completed"}),t.jsxs("div",{className:"order-status-step-content",children:[t.jsx("span",{className:"order-status-step-label",children:S}),Y&&t.jsxs("span",{className:"order-status-step-meta",children:["Updated ",Y]})]})]})}):t.jsxs("div",{className:`order-status-timeline ${I}`,children:[Y&&t.jsxs("div",{className:"order-status-updated-meta",children:["Updated ",Y]}),M.map((Q,ne)=>{const F=ne<L,me=ne===L,le=ne>L,G=ne===M.length-1,de=ne===0&&P?P:Q.label;return t.jsx("div",{className:"order-status-timeline-step-wrapper",children:t.jsxs("div",{className:"order-status-timeline-step",children:[t.jsxs("div",{className:"order-status-step-left",children:[t.jsx("div",{className:`order-status-dot ${F?"order-status-dot-completed":""} ${me?"order-status-dot-active":""} ${le?"order-status-dot-pending":""}`,children:F&&t.jsx("svg",{className:"order-status-check",viewBox:"0 0 12 12",fill:"none",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",children:t.jsx("path",{d:"M2 6l3 3 5-6"})})}),!G&&t.jsx("div",{className:"order-status-line"})]}),t.jsxs("div",{className:"order-status-step-content",children:[t.jsx("span",{className:`order-status-step-label ${me?"order-status-step-label-active":""} ${le?"order-status-step-label-pending":""}`,children:de}),me&&Y&&t.jsxs("span",{className:"order-status-step-meta",children:["Updated ",Y]})]})]})},Q.key)})]})}const K="https://api.terracart.in".replace(/\/$/,""),ea=n=>n?n.startsWith("http://")||n.startsWith("https://")?n:n.startsWith("/")?`${K}${n}`:`${K}/uploads/${n}`:"/defaultImg.jpg",q="terra_serviceType",he="terra_selectedTable",ta=["Pending","Confirmed","Preparing","Ready","Served","Completed","Paid","Returned","Cancelled"],ra=["Pending","Confirmed","Preparing","Ready","Served","Finalized","Completed"],aa=["Paid"],oa=n=>{if(n==null)return 0;const I=Number(n);return Number.isNaN(I)?0:I/100},Ce=n=>{const I=Number(n);return Number.isNaN(I)?"0.00":I.toFixed(2)},Wt=n=>{if(!n)return null;const I=n.assignmentDisplayType,v=n.assignedStaff?.role||n.acceptedBy?.employeeRole||null;if((I==="TEAM"||I==="INDIVIDUAL"?I:String(v||"").toUpperCase()==="ADMIN"?"TEAM":"INDIVIDUAL")==="TEAM")return{displayType:"TEAM",name:null,role:null,disability:null};const P=n.acceptedBy||null,M=n.assignedStaff||null,S=P?.employeeName||M?.name||null;return S?{displayType:"INDIVIDUAL",name:S,role:M?.role||P?.employeeRole||null,disability:P?.disability?.type||M?.disability||null}:null},Rt=n=>{if(!n)return"INV-NA";const I=new Date(n.createdAt||Date.now()).toISOString().slice(0,10).replace(/-/g,""),v=(n.cartId||n._id||"").toString().slice(-6).toUpperCase();return`INV-${I}-${v}`},st=n=>{if(!n)return[];const I=new Map;return(Array.isArray(n.kotLines)?n.kotLines:[]).forEach(P=>{(P?.items||[]).forEach(M=>{if(!M)return;const S=M.name||"Item",L=Number(M.quantity)||0,Y=oa(M.price||0),$=!!M.returned;I.has(S)||I.set(S,{name:S,unitPrice:Y,activeQuantity:0,returnedQuantity:0,totalQuantity:0,amount:0,returned:!1});const Q=I.get(S);Q.totalQuantity+=L,$?(Q.returnedQuantity+=L,Q.returned=!0):(Q.activeQuantity+=L,Q.amount+=Y*L),Q.unitPrice||(Q.unitPrice=Y)})}),(n.selectedAddons||[]).forEach(P=>{const M=`(+) ${P.name}`,S=1,L=Number(P.price)||0;I.has(M)||I.set(M,{name:M,unitPrice:L,activeQuantity:0,returnedQuantity:0,totalQuantity:0,amount:0,returned:!1});const Y=I.get(M);Y.totalQuantity+=S,Y.activeQuantity+=S,Y.amount+=L*S}),Array.from(I.values()).map(P=>({...P,quantity:P.activeQuantity}))},Kt=(n,I)=>{if(!n)return{subtotal:0,gst:0,totalAmount:0,totalItems:0};const v=Array.isArray(I)?I:st(n)||[],D=v.reduce((L,Y)=>{if(!Y)return L;const $=Number(Y.amount)||0;return L+$},0),P=Number(D.toFixed(2));return{subtotal:P,gst:0,totalAmount:P,totalItems:v.reduce((L,Y)=>Y?L+(Number(Y.quantity)||0):L,0)}},Yt=n=>{if(!n)return null;const I=n.paidAt||n.updatedAt||n.createdAt;if(!I)return null;const v=new Date(I);return Number.isNaN(v.getTime())?null:v},sa=n=>{const I={};return n.forEach(v=>{(v.items||[]).forEach(D=>{I[D.name]=D})}),I},Ut=({item:n,onAdd:I,onRemove:v,count:D,lang:P})=>{if(!n)return null;const M=P||localStorage.getItem("language")||"en";let S=null;if(Fe[M]?.items){const Q=n.name?.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");S=Fe[M].items[Q]}const[L]=$t(n.name||""),Y=S||L,$=n.isAvailable!==!1;return t.jsxs(Or.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:`item-card group ${$?"":"unavailable"}`,children:[t.jsx("div",{className:"item-image-container",children:t.jsx("img",{src:ea(n?.image),alt:n?.name||"Menu item",className:"item-image"})}),t.jsxs("div",{className:"item-info-section",children:[t.jsx("h4",{className:"item-name",children:Y||n?.name||"Unnamed Item"}),t.jsxs("p",{className:"item-price",children:["₹",n?.price||0]}),!$&&t.jsx("span",{className:"item-status-badge unavailable",children:"Not available"})]}),t.jsx("div",{className:"item-footer",children:t.jsxs("div",{className:"item-controls",children:[t.jsx("button",{"aria-label":`Remove one ${n?.name||"item"}`,className:"quantity-button",onClick:()=>n?.name&&v(n.name),disabled:!D,children:"-"}),t.jsx("span",{className:"item-count",children:D||0}),t.jsx("button",{"aria-label":`Add one ${n?.name||"item"}`,className:`quantity-button ${$?"":"disabled"}`,onClick:()=>n&&I(n),disabled:!$,title:$?void 0:"Currently unavailable",children:"+"})]})})]})},na=({category:n,items:I,cart:v,onAdd:D,onRemove:P,lang:M,defaultOpen:S=!1})=>{if(!n)return null;const L=M||localStorage.getItem("language")||"en";let Y=null;if(Fe[L]?.categories){const le=n?.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");Y=Fe[L].categories[le]}const[$]=$t(n||""),Q=Y||$,[ne,F]=i.useState(S),me=Array.isArray(I)?I:[];return t.jsxs("div",{className:"category-wrapper",children:[t.jsxs("button",{onClick:()=>F(le=>!le),className:"category-button",children:[Q||n," ",t.jsx("span",{children:ne?"▲":"▼"})]}),ne&&t.jsx("div",{className:"category-items",children:me.map((le,G)=>t.jsx(Ut,{item:le,onAdd:D,onRemove:P,count:v[le?.name]||0,lang:L},le?._id||`${n}-${G}`))})]})};function la(){const n=_r(),I=Ir(),[v,D]=Sr(),[P,M]=i.useState(localStorage.getItem("language")||"en");i.useEffect(()=>{const e=()=>{M(localStorage.getItem("language")||"en")};return window.addEventListener("storage",e),window.addEventListener("language-change",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("language-change",e)}},[]);const S=(e,r)=>{if(!e)return r;const s=e.split(".");let a=Ur[P];for(const u of s)a=a?.[u];return a||r},L=[{label:S("processSteps.checkingOrder","Checking your order"),state:"pending"},{label:S("processSteps.confirmingItems","Confirming items & price"),state:"pending"},{label:S("processSteps.placingOrder","Placing your order"),state:"pending"},{label:S("processSteps.sendingToKitchen","Sending to kitchen"),state:"pending"},{label:S("processSteps.preparingDetails","Preparing order details"),state:"pending"}],[Y,$]=i.useState(!1),[Q,ne]=i.useState(L),F=(e,r)=>ne(s=>s.map((a,u)=>u===e?{...a,state:r}:a)),[me,le]=i.useState(localStorage.getItem("accessibilityMode")==="true"),[G,de]=i.useState(()=>{const e=localStorage.getItem("terra_cart");return e?JSON.parse(e):{}});i.useEffect(()=>{localStorage.setItem("terra_cart",JSON.stringify(G))},[G]);const[Ne,pe]=i.useState(!1),[it,De]=i.useState(""),[Lt,Pe]=i.useState(!1),[qe,ct]=i.useState(!1),[dt,Be]=i.useState(!1),[ut,ze]=i.useState(!1),[mt,gt]=i.useState(!1),[pt,fe]=i.useState(!1),[ia,ft]=i.useState(null),[Ft,ca]=i.useState(!1),[Me,qt]=i.useState(""),[_e,_t]=i.useState([]),[Ie,It]=i.useState({}),[be,Ve]=i.useState(!0),[Se,St]=i.useState(null),ie=i.useMemo(()=>!Array.isArray(_e)||_e.length===0?[]:_e.flatMap(e=>e?(Array.isArray(e.items)?e.items:[]).map(r=>({...r,categoryName:e?.name||"Menu"})):[]),[_e]),{cartTotal:Bt,cartItemCount:ht}=i.useMemo(()=>{let e=0,r=0;return Object.entries(G).forEach(([s,a])=>{r+=a;const u=ie.find(d=>d.name===s);u&&(e+=(u.price||0)*a)}),{cartTotal:e,cartItemCount:r}},[G,ie]),bt=i.useMemo(()=>{const e=Me.trim().toLowerCase();return e?!Array.isArray(ie)||ie.length===0?[]:ie.filter(r=>r?.name?r.name.toLowerCase().includes(e)||(r.description||"").toLowerCase().includes(e)||(r.tags||[]).some(s=>s&&s.toLowerCase().includes(e)):!1):[]},[ie,Me]),ye=i.useRef(null),we=i.useRef(null),[y,z]=i.useState(()=>{const e=localStorage.getItem(q)||"DINE_IN";let r=null;return e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r||null}),[E,B]=i.useState(()=>(localStorage.getItem(q)||"DINE_IN")==="TAKEAWAY"&&localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus")||null),[ue,V]=i.useState(()=>(localStorage.getItem(q)||"DINE_IN")==="TAKEAWAY"&&localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt")||null),[N,Ee]=i.useState(()=>localStorage.getItem("terra_takeaway_only")==="true"?"TAKEAWAY":localStorage.getItem(q)||"DINE_IN"),[U,Je]=i.useState(()=>{try{const e=localStorage.getItem(he);return e?JSON.parse(e):null}catch(e){return console.warn("Invalid table selection cache",e),null}}),[We,X]=i.useState(()=>localStorage.getItem("terra_sessionToken"));i.useEffect(()=>{(async()=>{if((localStorage.getItem(q)||"DINE_IN")==="TAKEAWAY")return;const s=localStorage.getItem("terra_orderId"),a=localStorage.getItem("terra_sessionToken");if(!(!s||!a))try{const u=await fetch(`${K}/api/orders/${s}`);if(!u.ok){u.status===404?(console.log("[Menu] Active order not found (404), clearing order data"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),z(null),B(null),V(null)):console.warn("[Menu] Error verifying order (non-404), keeping existing status:",u.status);return}let d;try{d=await u.json()}catch(c){console.error("[Menu] Failed to parse order response as JSON:",c);return}if(!d)return;d.sessionToken&&d.sessionToken!==a&&(console.log("[Menu] Clearing stale dine-in order data for old session"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),z(null),B(null),V(null))}catch(u){console.warn("[Menu] Error verifying active order session (network error), keeping existing status:",u)}})()},[]),i.useEffect(()=>{const e=localStorage.getItem("terra_sessionToken"),r=We,s=localStorage.getItem(q)||"DINE_IN";e&&r&&e!==r&&(s!=="TAKEAWAY"&&(console.log("[Menu] SessionToken changed - clearing old dine-in order data"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),z(null),B(null),V(null)),X(e))},[We]),i.useEffect(()=>{const e=localStorage.getItem(q)||"DINE_IN";let r=null;e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r&&r!==y?z(r):!r&&y&&z(null)},[N,y]),i.useEffect(()=>{},[N,n]);const[da]=i.useState(()=>localStorage.getItem("terra_takeaway_customerName")||""),[ua]=i.useState(()=>localStorage.getItem("terra_takeaway_customerMobile")||""),[ma]=i.useState(()=>localStorage.getItem("terra_takeaway_customerEmail")||""),[xe,yt]=i.useState(()=>{try{const e=localStorage.getItem("terra_previousOrder");return e?JSON.parse(e):null}catch(e){return console.warn("Invalid previous order cache",e),localStorage.removeItem("terra_previousOrder"),null}}),[R,vt]=i.useState(()=>{try{const e=localStorage.getItem("terra_previousOrderDetail");return e?JSON.parse(e):null}catch(e){return console.warn("Invalid previous order detail cache",e),localStorage.removeItem("terra_previousOrderDetail"),null}}),[Qe,te]=i.useState(null),[zt,He]=i.useState(!1),[h,Ge]=i.useState(null),[At,Re]=i.useState(!1),[Xe,ve]=i.useState(!1),[Ke,Ze]=i.useState(!1),[Vt,Ae]=i.useState(!1),[Te,Tt]=i.useState(null),[Ye,et]=i.useState(""),[tt,kt]=i.useState(!1),ce=i.useCallback(e=>{e?(yt(e),localStorage.setItem("terra_previousOrder",JSON.stringify(e))):(yt(null),localStorage.removeItem("terra_previousOrder"))},[]),re=i.useCallback(e=>{e?(vt(e),localStorage.setItem("terra_previousOrderDetail",JSON.stringify(e))):(vt(null),localStorage.removeItem("terra_previousOrderDetail"))},[]),$e=i.useCallback((e={})=>{const r=e.orderId||y;if(!r)return;const s=e.status||E||"Confirmed",a=e.updatedAt||ue||new Date().toISOString(),u=e.tableInfo||U||(()=>{try{const T=localStorage.getItem(he);return T?JSON.parse(T):null}catch{return null}})(),d=e.tableNumber??u?.number??u?.tableNumber??null,c=e.tableSlug??u?.qrSlug??localStorage.getItem("terra_scanToken")??null;ce({orderId:r,status:s,updatedAt:a,tableNumber:d,tableSlug:c})},[y,E,ue,U,ce]),je=i.useMemo(()=>h?Rt(h):null,[h]),Ue=i.useMemo(()=>st(h),[h]),rt=i.useMemo(()=>h?Kt(h,Ue):{subtotal:0,gst:0,totalAmount:0,totalItems:0},[h,Ue]),Jt=i.useMemo(()=>h?h.serviceType==="TAKEAWAY"?"Takeaway":"Dine-In":"",[h]),Qt=h?.table?.number??h?.tableNumber??null,Nt=h?.table?.name??null,Oe=i.useMemo(()=>Yt(h),[h]),wt=i.useMemo(()=>st(R),[R]),Et=i.useMemo(()=>R?Kt(R,wt):{subtotal:0,gst:0,totalAmount:0,totalItems:0},[R,wt]),at=i.useMemo(()=>Yt(R),[R]),xt=i.useMemo(()=>R?Rt(R):null,[R]),ge=i.useMemo(()=>Wt(Qe),[Qe]),ke=i.useMemo(()=>Wt(R),[R]),Ht=S("manualEntry","Menu");S("smartServe","Smart Serve");const Gt=S("aiOrdered","AI Ordered:");S("orderSummary","Order Summary:"),S("confirm","Confirm"),S("speakOrder","Speak Order");const Xt=S("processingVoice","Processing your voice..."),Zt=S("cartEmpty","Cart is empty");S("resetOrderBtn","Reset Order");const er=S("tapToOrder","Tap to Order"),tr=S("tapToStop","Tap to Stop"),rr=S("searchPlaceholder","Search item..."),ar=S("recordVoiceAria","Record voice order");i.useEffect(()=>{E?localStorage.setItem("terra_orderStatus",E):localStorage.removeItem("terra_orderStatus"),ue?localStorage.setItem("terra_orderStatusUpdatedAt",ue):localStorage.removeItem("terra_orderStatusUpdatedAt")},[E,ue]),i.useEffect(()=>{E&&y&&xe&&ce(null),E&&y&&R&&re(null)},[E,y,xe,R,ce,re]),i.useEffect(()=>{if(!xe&&!R)return;const e=localStorage.getItem("terra_scanToken"),r=xe?.tableSlug;if(r&&e&&r!==e){ce(null),re(null);return}!r&&R?.table?.qrSlug&&e&&R.table.qrSlug!==e&&(ce(null),re(null))},[xe,R,ce,re]),i.useEffect(()=>{const e=localStorage.getItem(q),r=localStorage.getItem("terra_takeaway_only")==="true";if((localStorage.getItem("terra_orderId_TAKEAWAY")||r)&&e!=="TAKEAWAY"){console.log("[Menu] Detected takeaway order or takeaway-only mode on refresh, setting serviceType to TAKEAWAY"),Ee("TAKEAWAY"),localStorage.setItem(q,"TAKEAWAY");return}I.state?.serviceType?(Ee(I.state.serviceType),localStorage.setItem(q,I.state.serviceType)):e?Ee(e):r&&(console.log("[Menu] Detected takeaway-only QR flow, setting serviceType to TAKEAWAY"),Ee("TAKEAWAY"),localStorage.setItem(q,"TAKEAWAY")),I.state?.table&&(Je(I.state.table),localStorage.setItem(he,JSON.stringify(I.state.table)))},[I.state,Ee]),i.useEffect(()=>{let e=!1;const r=async()=>{if((localStorage.getItem(q)||I.state?.serviceType||"DINE_IN")!=="DINE_IN")return!0;const d=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),c=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN"),T=d&&(!c||!["Paid","Cancelled","Returned","Completed"].includes(c));if(d)try{const W=await fetch(`${K}/api/orders/${d}`);if(W.ok){const k=await W.json();if(k.status&&!["Paid","Cancelled","Returned","Completed"].includes(k.status))return console.log("[Menu] User has verified active order - allowing access, skipping waitlist check"),!0}}catch(W){if(console.warn("[Menu] Failed to verify order on backend:",W),T)return console.log("[Menu] Order verification failed but order exists in storage - allowing access"),!0}const w=localStorage.getItem("terra_sessionToken"),A=localStorage.getItem("terra_selectedTable");if(w&&A)try{const W=JSON.parse(A);if(W.sessionToken===w)return console.log("[Menu] User has matching sessionToken - allowing access, skipping waitlist check"),!0;const k=W.qrSlug||localStorage.getItem("terra_scanToken");if(k)try{const o=await fetch(`${K}/api/tables/lookup/${k}?sessionToken=${w}`);if(o.ok){const m=await o.json();if(m?.table?.sessionToken===w||m?.table?.activeOrder)return console.log("[Menu] Backend confirms user owns table session - allowing access"),!0}}catch(o){if(console.warn("[Menu] Failed to verify table session on backend:",o),W.sessionToken===w)return!0}}catch(W){console.warn("[Menu] Failed to check sessionToken:",W)}const l=localStorage.getItem("terra_waitToken");if(T&&l)return console.log("[Menu] User has active order but also has waitlist token - clearing waitlist token"),localStorage.removeItem("terra_waitToken"),!0;if(!l)return!0;try{const W=await fetch(`${K}/api/waitlist/status?token=${l}`);if(W.ok){const k=await W.json();if(k.status==="WAITING")return console.log("[Menu] User is in WAITING status - blocking menu access"),alert("You are currently in the waitlist. Please wait for your turn. You will be notified when the table is ready."),n("/secondpage"),!1;if(k.status==="NOTIFIED"||k.status==="SEATED")return!0}}catch(W){console.error("[Menu] Failed to check waitlist status:",W)}return!0},s=async()=>{try{if((localStorage.getItem(q)||I.state?.serviceType||"DINE_IN")==="TAKEAWAY")return;const d=localStorage.getItem("terra_selectedTable");let c=localStorage.getItem("terra_sessionToken");const T=localStorage.getItem("terra_scanToken");if(!d||!T)return;const w=JSON.parse(d),A=w.id||w._id;if(!A)return;let l=!0;try{const _=w.qrSlug||T;if(_){const p=await fetch(`${K}/api/tables/lookup/${_}${c?`?sessionToken=${c}`:""}`).catch(f=>{throw console.warn("[Menu] Network error during table lookup:",f),f});if(p.status===423){let f={};try{f=await p.json()}catch(O){console.warn("[Menu] Failed to parse 423 response (expected for occupied tables):",O)}console.log("[Menu] Table lookup returned 423 (Locked - expected for occupied tables) - handling gracefully");const C=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN");if(C)try{const O=await fetch(`${K}/api/orders/${C}`);if(O.ok){const g=await O.json();if((g.table?.toString()||g.tableId?.toString())===A?.toString()){g.sessionToken&&(c=g.sessionToken,localStorage.setItem("terra_sessionToken",c),X(c),console.log("[Menu] Table is locked but user has active order - using order's sessionToken:",c)),console.log("[Menu] Table is already occupied by user's active order - skipping markTableOccupied"),l=!1;return}}}catch(O){console.warn("[Menu] Failed to verify order when table is locked:",O)}if(f?.table){const O={...w,...f.table,qrSlug:w.qrSlug||f.table.qrSlug};if(localStorage.setItem("terra_selectedTable",JSON.stringify(O)),f.table.sessionToken){const g=f.table.sessionToken;if(g===c)console.log("[Menu] Table is locked but sessionToken matches - we own this table"),localStorage.setItem("terra_sessionToken",c),X(c),l=!0;else{const J=localStorage.getItem("terra_sessionToken");if(J&&J===g)console.log("[Menu] Table is locked but stored sessionToken matches table's token - we own this table"),c=J,localStorage.setItem("terra_sessionToken",c),X(c),l=!0;else{console.warn("[Menu] Table is locked and sessionToken doesn't match - table belongs to another user"),l=!1;return}}}else if(c)console.log("[Menu] Table is locked and no sessionToken in response, but we have one - proceeding (backend will validate)"),l=!0;else{console.warn("[Menu] Table is locked and no sessionToken available - table belongs to another user"),l=!1;return}}else if(c)console.log("[Menu] Table is locked and no table data in response, but we have sessionToken - proceeding (backend will validate)"),l=!0;else{console.warn("[Menu] Table is locked and user has no active order for this table - skipping markTableOccupied"),l=!1;return}}if(p.ok){const f=await p.json();if(f?.table){const C=f.table,O=C.sessionToken,g={...w,...C,qrSlug:w.qrSlug||C.qrSlug};if(localStorage.setItem("terra_selectedTable",JSON.stringify(g)),O&&O!==c){const J=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN");if(J)try{const se=await fetch(`${K}/api/orders/${J}`);if(se.ok){const Z=await se.json();(Z.table?.toString()||Z.tableId?.toString())===A?.toString()?Z.sessionToken?(c=Z.sessionToken,localStorage.setItem("terra_sessionToken",c),X(c),console.log("[Menu] Using order's sessionToken:",c)):(c=O,localStorage.setItem("terra_sessionToken",c),X(c),console.log("[Menu] Using backend table's sessionToken:",c)):(console.warn("[Menu] User has order but not for this table - skipping markTableOccupied"),l=!1)}}catch(se){console.warn("[Menu] Failed to verify order:",se),c=O,localStorage.setItem("terra_sessionToken",c),X(c)}else console.warn("[Menu] Table has different sessionToken and user has no active order - skipping markTableOccupied"),l=!1}else O&&O===c?console.log("[Menu] SessionToken matches - proceeding with markTableOccupied"):O||console.log("[Menu] Table has no sessionToken - proceeding with markTableOccupied")}}}}catch(_){_?.status!==423&&console.warn("[Menu] Failed to refresh table status before markTableOccupied:",_)}if(!l)return;const W=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),k=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN");if(W&&k&&!["Paid","Cancelled","Returned","Completed"].includes(k)&&W)try{const _=await fetch(`${K}/api/orders/${W}`);if(_.ok){const p=await _.json();if(p.status&&!["Paid","Cancelled","Returned","Completed"].includes(p.status)&&(p.table?.toString()===A?.toString()||p.tableId?.toString()===A?.toString())){console.log("[Menu] User has active order for this table - skipping markTableOccupied"),p.sessionToken&&(localStorage.setItem("terra_sessionToken",p.sessionToken),X(p.sessionToken));return}}}catch(_){console.warn("[Menu] Failed to verify order before markTableOccupied:",_)}let m;try{m=await Pt(`${K}/api/tables/${A}/occupy`,{sessionToken:c||void 0},{headers:{"Content-Type":"application/json"}},{maxRetries:2,retryDelay:1e3,timeout:15e3,shouldRetry:(_,p)=>_.message?.includes("timeout")||_.message?.includes("Network error")||_.message?.includes("Failed to fetch")||_.message?.includes("CORS")?!0:_.status>=400&&_.status<500?!1:_.status>=500?!0:p<1})}catch(_){console.warn("[Menu] Failed to mark table as occupied after retries:",_),m={ok:!1,status:0,json:async()=>({}),text:async()=>_.message||"Network error"}}if(m.ok){const _=await m.json().catch(()=>null);if(_?.table){const p=_.table.sessionToken||c,f={...w,status:_.table.status||"OCCUPIED",sessionToken:p};localStorage.setItem("terra_selectedTable",JSON.stringify(f)),p&&p!==c&&(localStorage.setItem("terra_sessionToken",p),X(p),console.log("[Menu] Updated sessionToken after marking table occupied:",p))}else w.status="OCCUPIED",localStorage.setItem("terra_selectedTable",JSON.stringify(w))}else{const _=await m.text().catch(()=>"Unknown error");if(console.warn("Failed to mark table as occupied:",_),m.status===423)try{const p=w.qrSlug||localStorage.getItem("terra_scanToken");if(p){const f=await fetch(`${K}/api/tables/lookup/${p}?sessionToken=${c||""}`);if(f.ok){const C=await f.json().catch(()=>({}));if(C?.table?.sessionToken){const O=C.table.sessionToken;localStorage.setItem("terra_sessionToken",O),X(O),console.log("[Menu] Table already occupied by us, updated sessionToken:",O)}}}}catch(p){console.warn("Failed to refresh table status:",p)}}}catch(u){console.warn("Error marking table as occupied:",u)}};return(async()=>{try{if(Ve(!0),St(null),!await r()){Ve(!1);return}await s();let d="";const c=localStorage.getItem("terra_selectedCartId");if(c)d=c,console.log("[Menu] Using selected cart ID for menu:",d);else{const k=localStorage.getItem("terra_takeaway_cartId");if(k)d=k,console.log("[Menu] Using takeaway QR cart ID for menu:",d);else try{let o=localStorage.getItem("terra_selectedTable");o||(o=localStorage.getItem(he)||"{}");const m=JSON.parse(o);d=m.cartId||m.cafeId||"",console.log("[Menu] Table data for cartId lookup:",{hasTableData:!!o,tableDataKeys:m?Object.keys(m):[],cartId:m.cartId,cafeId:m.cafeId,foundCartId:d}),d?console.log("[Menu] Using table cart ID for menu:",d):console.warn("[Menu] No cartId or cafeId found in table data:",m)}catch(o){console.error("[Menu] Error parsing table data:",o),console.log("[Menu] No cart ID found, loading default menu")}}const T=d?`${K}/api/menu/public?cartId=${d}`:`${K}/api/menu/public`;console.log("[Menu] Loading menu from:",T,{hasCartId:!!d,cartId:d,serviceType:N});const w=await fetch(T);if(!w.ok)throw new Error(`Menu fetch failed with status ${w.status}`);let A;try{A=await w.json()}catch(k){console.error("[Menu] Failed to parse menu response as JSON:",k);const o=await w.text().catch(()=>"Unknown error");throw new Error(`Invalid menu response format: ${o.substring(0,100)}`)}if(e)return;const l=(Array.isArray(A)?A:[]).map(k=>k?{...k,name:k.name||"Menu",items:(Array.isArray(k.items)?k.items:[]).map(o=>o?{...o,isAvailable:o.isAvailable!==!1,categoryName:k.name||"Menu"}:null).filter(Boolean)}:null).filter(Boolean),W=sa(l);_t(l),It(W),ft(k=>k||Array.isArray(l)&&l.length>0&&l[0]?.name||null)}catch(u){if(console.error("Menu fetch error",u),e)return;_t([]),It({}),ft(null),St("Trying to connect to live menu... please check your network or ask staff.")}finally{e||Ve(!1)}})(),()=>{e=!0}},[]);const jt=e=>{const r=typeof e=="string"?e:e?.name;if(!r)return;const s=Ie[r]||e;if(s&&s.isAvailable===!1){alert(`${s.name} is currently unavailable.`);return}de(a=>({...a,[r]:(a[r]||0)+1}))},Ot=e=>{de(r=>{const s=(r[e]||0)-1;if(s<=0){const{[e]:a,...u}=r;return u}return{...r,[e]:s}})},ae=e=>new Promise(r=>setTimeout(r,e)),oe={validate:1e3,order:1e3,beforeSend:1e3,kitchen:1e3,summary:1e3,error:1e3},or=async()=>{if(Object.keys(G).length===0)return $(!1),alert(Zt);if(N==="DINE_IN"&&!y&&!U){$(!1),alert("We couldn't detect your table. Please scan the table QR again or contact staff before placing an order.");return}await sr()},sr=async()=>{let e=y;if(e)try{const r=await fetch(`${K}/api/orders/${e}`);if(r.ok){const s=await r.json();["Paid","Cancelled","Returned"].includes(s.status)&&(console.log("[Menu] Existing order is in blocked status, creating new order instead:",s.status),e=null,z(null),N==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")))}else console.log("[Menu] Could not fetch existing order, creating new order"),e=null,z(null),N==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"))}catch(r){console.warn("[Menu] Error checking existing order, creating new order:",r),e=null,z(null),N==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"))}ne(L.map((r,s)=>{let a=r.label;switch(s){case 0:a=S("processSteps.checkingOrder","Checking your order");break;case 1:a=S("processSteps.confirmingItems","Confirming items & price");break;case 2:a=S("processSteps.placingOrder","Placing your order");break;case 3:a=S("processSteps.sendingToKitchen","Sending to kitchen");break;case 4:a=S("processSteps.preparingDetails","Preparing order details");break}return{...r,label:a,state:"pending"}})),$(!0);try{F(0,"active"),await ae(oe.validate),F(0,"done"),F(1,"active"),await ae(oe.order),F(1,"done"),F(2,"active"),await ae(oe.beforeSend);let r=U;const s=N!=="DINE_IN"&&localStorage.getItem("terra_orderType")||null,a=N!=="DINE_IN"?localStorage.getItem("terra_customerLocation"):null;let u=null;if(a)try{u=JSON.parse(a)}catch(b){console.warn("[Menu] Failed to parse customerLocation from localStorage:",b),u=null}const d=N==="TAKEAWAY"||s==="PICKUP"||s==="DELIVERY",c=d&&(localStorage.getItem("terra_takeaway_customerName")||localStorage.getItem("terra_customerName"))||"",T=d&&(localStorage.getItem("terra_takeaway_customerMobile")||localStorage.getItem("terra_customerMobile"))||"",w=d&&(localStorage.getItem("terra_takeaway_customerEmail")||localStorage.getItem("terra_customerEmail"))||"";let A=null;if(N==="TAKEAWAY"){const b=localStorage.getItem("terra_takeaway_cartId");if(b)A=b;else try{const j=JSON.parse(localStorage.getItem(he)||"{}");let ee=j.cartId||j.cafeId||null;ee&&(typeof ee=="object"&&ee._id?A=ee._id:typeof ee=="string"?A=ee:A=String(ee)),console.log("[Menu] Using cartId from table data for takeaway:",A)}catch(j){console.warn("[Menu] Could not get cartId from table data for takeaway order:",j)}}let l=null;N==="TAKEAWAY"?(l=localStorage.getItem("terra_takeaway_sessionToken"),l?console.log("[Menu] Using existing takeaway sessionToken (unified for both flows):",l):(l=`TAKEAWAY-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_takeaway_sessionToken",l),console.log("[Menu] Generated new takeaway sessionToken (unified for both flows):",l))):(l=localStorage.getItem("terra_sessionToken"),l||(l=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_sessionToken",l),X(l),console.log("[Menu] Generated new DINE_IN sessionToken:",l)));const W=localStorage.getItem("terra_specialInstructions")||null,k=s==="PICKUP"||s==="DELIVERY",o=k?localStorage.getItem("terra_selectedCartId"):null,m=(k?o:A)||(()=>{try{const b=JSON.parse(localStorage.getItem(he)||"{}"),j=b.cartId||b.cafeId;if(typeof j=="string")return j;if(j&&typeof j=="object"&&j._id)return j._id;if(j!=null)return String(j)}catch{}return""})(),_=localStorage.getItem("terra_cart_addons")||"{}";let p=[];try{const b=JSON.parse(_);Array.isArray(b)?p=b:m&&Array.isArray(b[m])&&(p=b[m])}catch{p=[]}const f=JSON.parse(localStorage.getItem("terra_global_addons")||"[]"),C=Array.isArray(f)&&f.length>0?f:kr,O=p.map(b=>{const j=C.find(ee=>ee.id===b);return j?{addonId:b,name:j.name,price:j.price}:null}).filter(Boolean),g=Nr(G,{serviceType:s?s==="PICKUP"?"PICKUP":"DELIVERY":N,orderType:s==="PICKUP"||s==="DELIVERY"?s:void 0,tableId:r?.id||r?._id||U?.id||U?._id,tableNumber:r?.number??r?.tableNumber??U?.number??U?.tableNumber,menuCatalog:Ie,sessionToken:l,customerName:d&&c?.trim()?c.trim():void 0,customerMobile:d&&T?.trim()?T.trim():void 0,customerEmail:d&&w?.trim()?w.trim():void 0,cartId:N==="TAKEAWAY"||s?k&&o||A:void 0,customerLocation:u,specialInstructions:W,selectedAddons:O});if(!g.items||!Array.isArray(g.items)||g.items.length===0){console.error("[Menu] Invalid order payload - no items:",g),alert("❌ Your cart is empty. Please add items before placing an order."),F(2,"error"),await ae(oe.error),$(!1);return}const J=g.items.filter(b=>!b.name||typeof b.quantity!="number"||b.quantity<=0||typeof b.price!="number"||b.price<0);if(J.length>0){console.error("[Menu] Invalid order payload - invalid items:",J),alert("❌ Some items in your cart are invalid. Please refresh the page and try again."),F(2,"error"),await ae(oe.error),$(!1);return}if(g.serviceType==="DINE_IN"&&!g.sessionToken&&(l?g.sessionToken=l:(g.sessionToken=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("terra_sessionToken",g.sessionToken),X(g.sessionToken))),g.serviceType==="PICKUP"||g.serviceType==="DELIVERY"||g.orderType==="PICKUP"||g.orderType==="DELIVERY"){if(!g.customerName||!g.customerName.trim()){alert("❌ Customer name is required for "+(g.orderType||g.serviceType)+" orders. Please provide your name."),F(2,"error"),await ae(oe.error),$(!1);return}if(!g.customerMobile||!g.customerMobile.trim()){alert("❌ Customer mobile number is required for "+(g.orderType||g.serviceType)+" orders. Please provide your mobile number."),F(2,"error"),await ae(oe.error),$(!1);return}}if(g.serviceType==="DELIVERY"||g.orderType==="DELIVERY"){if(!g.customerLocation||!g.customerLocation.latitude||!g.customerLocation.longitude){alert("❌ Delivery location is required. Please go back and provide your delivery address."),F(2,"error"),await ae(oe.error),$(!1);return}if(!g.cartId){alert("❌ Store selection is required for delivery. Please go back and select a store."),F(2,"error"),await ae(oe.error),$(!1);return}try{const b=await fetch(`${K}/api/carts/${g.cartId}?latitude=${g.customerLocation.latitude}&longitude=${g.customerLocation.longitude}&orderType=DELIVERY`);if(b.ok){const j=await b.json();if(j.success&&j.data){const ee=j.data;if(!ee.canDeliver){let Le=`❌ Delivery not available!

`;ee.distance!==null?Le+=`You are ${ee.distance.toFixed(2)} km away, but maximum delivery radius is ${ee.deliveryRadius||5} km.

`:Le+=`Delivery is not enabled for this store or the store location is not configured.

`,Le+="Please select a different store or choose Pickup instead.",alert(Le),F(2,"error"),await ae(oe.error),$(!1);return}}}}catch(b){console.error("[Menu] Error checking delivery availability:",b)}}const Z=e?`${K}/api/orders/${e}/kot`:`${K}/api/orders`;let H;try{H=await Pt(Z,g,{headers:{"Content-Type":"application/json"}},{maxRetries:2,retryDelay:1500,timeout:3e4,shouldRetry:(b,j)=>b.message?.includes("timeout")||b.message?.includes("Network error")||b.message?.includes("Failed to fetch")||b.message?.includes("CORS")?(console.log(`[Menu] Retrying order creation (attempt ${j+1}/2)...`),!0):b.status>=400&&b.status<500?!1:b.status>=500?!0:j<1})}catch(b){console.error("[Menu] Order creation failed after retries:",b);const j=b.message||"Failed to create order. Please check your connection and try again.";H={ok:!1,status:0,statusText:"Network Error",json:async()=>({message:j}),text:async()=>j,headers:new Headers}}let x;try{if((H.headers?.get?.("content-type")||"").includes("application/json"))x=await H.json();else{const j=await H.text().catch(()=>"");if(j)try{x=JSON.parse(j)}catch{x={message:j||"Unknown error"}}else x={message:"No response from server"}}}catch(b){console.error("[Menu] Failed to parse response:",b);try{x={message:await H.text().catch(()=>"Unknown error")||"Failed to parse server response"}}catch{x={message:"Failed to parse server response"}}}const Dt=H.ok&&x?._id;if(console.log("[Menu] Order creation response:",{ok:H.ok,status:H.status,hasOrderId:!!x?._id,orderId:x?._id,orderCreated:Dt}),Dt)console.log("[Menu] Order created successfully:",x._id);else{if(F(2,"error"),H.status===403){const b=x?.message||"Access denied. Please try refreshing the page.";b.includes("assigned to another guest")||b.includes("table")?alert(`⚠️ ${b}

Please scan the table QR code again or contact staff for assistance.`):alert(`❌ ${b}`)}else if(H.status===400){const b=x?.message||x?.error||"Invalid request. Please check your order and try again.";console.error("[Menu] Order save failed (400 Bad Request):",{status:H.status,statusText:H.statusText,error:x,payload:g,itemsCount:g.items?.length,serviceType:g.serviceType,hasSessionToken:!!g.sessionToken,hasTableId:!!g.tableId,hasTableNumber:!!g.tableNumber});let j=b;x?.message?.includes("No items supplied")?j="Your cart is empty. Please add items before placing an order.":x?.message?.includes("Session token is required")?j="Session token is missing. Please scan the table QR code again.":x?.message?.includes("Table selection is required")?j="Table information is missing. Please scan the table QR code again.":x?.message?.includes("Invalid order items")&&(j="Some items in your cart are invalid. Please refresh the page and try again."),alert(`❌ ${j}`)}else{const b=x?.message||x?.error||"Failed to save order.";console.error("[Menu] Order save failed:",{status:H.status,statusText:H.statusText,error:x,payload:g}),alert(`❌ ${b}`)}await ae(oe.error),$(!1),fe(!1);return}console.log("[Menu] Proceeding with order success flow for order:",x._id),F(2,"done"),F(3,"active"),await ae(oe.kitchen),F(3,"done"),N==="TAKEAWAY"?(localStorage.setItem("terra_orderId_TAKEAWAY",x._id),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),x.sessionToken?(localStorage.setItem("terra_takeaway_sessionToken",x.sessionToken),console.log("[Menu] Stored takeaway sessionToken from order response:",x.sessionToken)):l&&(localStorage.setItem("terra_takeaway_sessionToken",l),console.log("[Menu] Stored generated takeaway sessionToken:",l))):(localStorage.setItem("terra_orderId",x._id),localStorage.setItem("terra_orderId_DINE_IN",x._id),localStorage.removeItem("terra_orderId_TAKEAWAY")),z(x._id),B(x.status||"Confirmed"),V(new Date().toISOString()),te(x),N==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",x.status||"Confirmed"),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",new Date().toISOString())):(localStorage.setItem("terra_orderStatus_DINE_IN",x.status||"Confirmed"),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",new Date().toISOString())),x&&(x.takeawayToken||x.serviceType==="TAKEAWAY")&&re(x),de({}),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_cart_TAKEAWAY"),fe(!1),console.log("[Menu] Order created and stored:",{orderId:x._id,serviceType:N,storedInLocalStorage:{generic:N==="DINE_IN"?localStorage.getItem("terra_orderId"):null,dineIn:N==="DINE_IN"?localStorage.getItem("terra_orderId_DINE_IN"):null,takeaway:N==="TAKEAWAY"?localStorage.getItem("terra_orderId_TAKEAWAY"):null}}),F(4,"active"),F(4,"done"),$(!1)}catch(r){F(2,"error"),alert("❌ Server Error"),console.error(r),await ae(oe.error),$(!1),fe(!1)}},nr=async()=>{if(Ne){try{ye.current&&(ye.current.stop(),ye.current=null)}catch(e){console.warn("Error stopping recognition:",e)}pe(!1);return}if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Your browser doesn't support voice input. Please use the menu buttons to order.");return}try{const e=window.SpeechRecognition||window.webkitSpeechRecognition,r=new e;ye.current=r,r.continuous=!1,r.interimResults=!1;const s=localStorage.getItem("language")||"en";r.lang=s==="en"?"en-US":s==="hi"?"hi-IN":"en-US",r.onstart=()=>{pe(!0),De(""),console.log("🎤 Voice recognition started")},r.onresult=a=>{const u=a.results[0][0].transcript;if(console.log("📝 Transcribed:",u),De(u),pe(!1),Pe(!0),!Array.isArray(ie)||ie.length===0){console.warn("⚠️ Menu items not loaded yet, cannot add items to cart"),alert("Menu is still loading. Please wait a moment and try again."),Pe(!1);return}const{addedItems:d,notFound:c}=fr(u),T=d.length,w=d.map(({name:A,qty:l})=>`${l}x ${A}`).join(", ");w&&De(w),T>0?(console.log(`✅ Voice order: added ${T} item(s) to cart`),c.length>0&&alert(`✅ Added ${T} item(s) to cart.
⚠️ Not found in menu: ${c.join(", ")}`)):d.length===0&&c.length>0?alert(`Could not find in menu: ${c.join(", ")}. Try saying item names as shown in the menu.`):u.trim()||De(""),Pe(!1)},r.onerror=a=>{console.error("Voice recognition error:",a.error),pe(!1),Pe(!1),ye.current=null,a.error==="no-speech"?alert("No speech detected. Please try again."):a.error==="not-allowed"?alert("Microphone permission denied. Please allow microphone access."):alert("Voice recognition error. Please try again or use menu buttons.")},r.onend=()=>{pe(!1),ye.current=null},pe(!0),r.start()}catch(e){console.error("Error starting voice recognition:",e),alert("Failed to start voice input. Please try again or use menu buttons."),pe(!1)}},lr=async()=>{if(!(!E||qe)){fe(!0),ct(!0);try{if((localStorage.getItem(q)||"DINE_IN")==="TAKEAWAY"){const o=y||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"),m=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken");if(!o){alert("No active order found. Please create a new order.");return}try{const _=await fetch(`${K}/api/orders/${o}`);if(_.ok){const p=await _.json();if(p.status&&["Paid","Cancelled","Returned","Completed"].includes(p.status)){alert("This order has been completed. Please create a new order.");return}z(o),localStorage.setItem("terra_orderId_TAKEAWAY",o),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),B(p.status||E||"Confirmed"),localStorage.setItem("terra_orderStatus_TAKEAWAY",p.status||E||"Confirmed"),p.updatedAt&&(V(p.updatedAt),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",p.updatedAt)),de({}),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_cart_TAKEAWAY"),alert("You can continue adding items to your takeaway order.");return}else{alert("Order not found. Please create a new order.");return}}catch{alert("Unable to verify order. Please try again or contact staff.");return}}const r=localStorage.getItem("terra_selectedTable"),s=We||localStorage.getItem("terra_sessionToken");if(!r||!s){alert("We couldn't detect your table. Please scan the table QR again or contact staff.");return}let a=null;if(y)try{const o=await fetch(`${K}/api/orders/${y}`);o.ok&&(a=await o.json())}catch{}const u=JSON.parse(r),d=u.qrSlug||localStorage.getItem("terra_scanToken"),c=localStorage.getItem("terra_sessionToken")||s,T=new URLSearchParams;c&&T.set("sessionToken",c);const w=`${K}/api/tables/lookup/${d}${T.toString()?`?${T.toString()}`:""}`;let A=await fetch(w),l=await A.json().catch(()=>({}));if(A.status===423){const o=l?.table?.sessionToken;if(o&&o===c)console.log("[Menu] Table is occupied by current session, proceeding");else{const m=l?.message||"Table is currently assigned to another guest.";if(c){console.warn("Stale session detected, retrying table lookup without session token."),localStorage.removeItem("terra_sessionToken"),X(null);const p=new URLSearchParams().toString(),f=`${K}/api/tables/lookup/${d}${p?`?${p}`:""}`,C=await fetch(f),O=await C.json().catch(()=>({}));if(!C.ok)throw new Error(O?.message||m||"Unable to refresh table session. Please ask staff for help.");A=C,l=O}else throw new Error(m)}}else if(!A.ok)throw new Error(l?.message||"Failed to refresh table session. Please ask staff for help.");if(l.sessionToken){const o=We||localStorage.getItem("terra_sessionToken"),m=l.sessionToken;m!==o&&(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),localStorage.removeItem("terra_lastPaidOrderId"),z(null),B(null),V(null),ce(null),re(null),["DINE_IN","TAKEAWAY"].forEach(_=>{localStorage.removeItem(`terra_cart_${_}`),localStorage.removeItem(`terra_orderId_${_}`),localStorage.removeItem(`terra_orderStatus_${_}`),localStorage.removeItem(`terra_orderStatusUpdatedAt_${_}`)})),localStorage.setItem("terra_sessionToken",m),X(m)}l.table&&(localStorage.setItem("terra_selectedTable",JSON.stringify(l.table)),Je(l.table)),(l.table?.status||"AVAILABLE")==="AVAILABLE"?localStorage.removeItem("terra_waitToken"):l.waitlist?.token?localStorage.setItem("terra_waitToken",l.waitlist.token):localStorage.removeItem("terra_waitToken");const k=l.table||u;if(l.order){const o=localStorage.getItem(q)||"DINE_IN";if(l.order.serviceType&&l.order.serviceType!==o){console.log(`[Menu] Ignoring order from table lookup - serviceType mismatch: order is ${l.order.serviceType}, current is ${o}`);return}z(l.order._id),o==="TAKEAWAY"?(localStorage.setItem("terra_orderId_TAKEAWAY",l.order._id),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN")):(localStorage.setItem("terra_orderId",l.order._id),localStorage.setItem("terra_orderId_DINE_IN",l.order._id),localStorage.removeItem("terra_orderId_TAKEAWAY")),B(l.order.status||E||"Confirmed"),l.order.updatedAt&&(V(l.order.updatedAt),localStorage.setItem("terra_orderStatusUpdatedAt",l.order.updatedAt)),ce(null)}else y?console.log("No order returned from table lookup, keeping existing order status"):($e({status:E||"Completed",updatedAt:ue||new Date().toISOString(),tableNumber:k?.number??k?.tableNumber??null,tableSlug:k?.qrSlug??d??null,tableInfo:k}),B(null),V(null),z(null),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"));a&&re(a),alert("You can continue adding items to your order.")}catch(e){console.error("handleOrderAgain error",e),alert(e.message||"Unable to resume ordering. Please contact staff.")}finally{ct(!1),fe(!1)}}},ir=()=>{if(!(N==="TAKEAWAY"?y||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):y||localStorage.getItem("terra_orderId"))){alert("No active order found.");return}Tt("Cancel"),et(""),Ae(!0)},cr=()=>{if(!y){alert("No active order found.");return}Tt("Return"),et(""),Ae(!0)},dr=async()=>{if(!Ye.trim()){alert("Please enter a reason.");return}kt(!0);try{if(Te==="Cancel"){Be(!0);const e=N==="TAKEAWAY"?y||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):y||localStorage.getItem("terra_orderId");let r=null;if(N==="TAKEAWAY"){if(r=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken"),!r)try{const c=await fetch(`${K}/api/orders/${e}`);if(c.ok){const T=await c.json();T?.sessionToken&&(r=T.sessionToken,localStorage.setItem("terra_takeaway_sessionToken",r))}}catch(c){console.warn("[Menu] Failed to fetch order to get sessionToken:",c)}}else r=localStorage.getItem("terra_sessionToken");const s=await fetch(`${K}/api/orders/${e}/customer-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"Cancelled",sessionToken:r||void 0,reason:Ye})}),a=await s.json().catch(()=>({}));if(!s.ok)throw new Error(a?.message||"Failed to cancel order");const u=a?._id?a:null,d=u?.updatedAt||new Date().toISOString();$e({orderId:u?._id,status:"Cancelled",updatedAt:d,tableNumber:u?.tableNumber??U?.number??U?.tableNumber??null,tableSlug:u?.table?.qrSlug??U?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:u?.table||U}),u&&re(u),B(null),V(null),z(null),N==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY"),localStorage.removeItem("terra_cart_TAKEAWAY"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail"),console.log("[Menu] Cleared takeaway customer data after order cancellation")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_cart")),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_cart"),N==="TAKEAWAY"&&(localStorage.removeItem("terra_waitToken"),console.log("[Menu] Cleared waitlist state for cancelled takeaway order")),de({}),fe(!1),alert("Your order has been cancelled."),Be(!1)}else if(Te==="Return"){ze(!0);const e=localStorage.getItem("terra_sessionToken"),r=await fetch(`${K}/api/orders/${y}/customer-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"Returned",sessionToken:N==="DINE_IN"&&e||void 0,reason:Ye})}),s=await r.json().catch(()=>({}));if(!r.ok)throw new Error(s?.message||"Failed to return order");const a=s?._id?s:null,u=a?.updatedAt||new Date().toISOString();$e({orderId:a?._id,status:"Returned",updatedAt:u,tableNumber:a?.tableNumber??U?.number??U?.tableNumber??null,tableSlug:a?.table?.qrSlug??U?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:a?.table||U}),a&&re(a),B("Returned"),V(u),z(null),N==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")),localStorage.removeItem("terra_cart"),de({}),fe(!1),N==="TAKEAWAY"&&(localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_takeaway_customerName"),localStorage.removeItem("terra_takeaway_customerMobile"),localStorage.removeItem("terra_takeaway_customerEmail")),alert("Your order has been marked as returned."),ze(!1)}Ae(!1)}catch(e){alert(e.message||`Unable to ${Te.toLowerCase()} order.`),Te==="Cancel"&&Be(!1),Te==="Return"&&ze(!1)}finally{kt(!1)}},ur=async()=>{if(!y){alert("No active order found.");return}if(await window.confirm("Confirm that payment has been completed for this order?")){gt(!0);try{const e=localStorage.getItem("terra_sessionToken"),r=await fetch(`${K}/api/orders/${y}/confirm-payment`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethod:"CASH",sessionToken:N==="DINE_IN"&&e||void 0})}),s=await r.json().catch(()=>({}));if(!r.ok)throw new Error(s?.message||"Failed to confirm payment");const a=s?._id?s:null,u=a?.updatedAt||new Date().toISOString();$e({orderId:a?._id,status:"Paid",updatedAt:u,tableNumber:a?.tableNumber??U?.number??U?.tableNumber??null,tableSlug:a?.table?.qrSlug??U?.qrSlug??localStorage.getItem("terra_scanToken")??null,tableInfo:a?.table||U}),a&&re(a),B("Paid"),V(u),localStorage.setItem("terra_orderStatus","Paid"),localStorage.setItem("terra_orderStatusUpdatedAt",u),localStorage.setItem("terra_lastPaidOrderId",y),alert("Payment confirmed successfully!")}catch(e){console.error("handleConfirmPayment error",e),alert(e.message||"Unable to confirm payment. Please contact staff.")}finally{gt(!1)}}},ot=i.useCallback(async()=>{if(!y){alert("We couldn't locate your order. Please contact staff.");return}try{Re(!0);const e=await fetch(`${K}/api/orders/${y}`),r=await e.json().catch(()=>({}));if(!e.ok)throw new Error(r?.message||"Failed to load invoice details.");console.log("📄 Invoice order data:",{orderId:r._id,franchiseId:r.franchiseId,cafeId:r.cafeId,franchise:r.franchise,cafe:r.cafe}),Ge(r),He(!0)}catch(e){console.error("Invoice fetch failed",e),alert(e.message||"Unable to load invoice. Please contact staff.")}finally{Re(!1)}},[y]),Ct=i.useCallback(()=>{He(!1),Ge(null),ve(!1),Ze(!1),Re(!1)},[]);i.useCallback(()=>{if(!(!we.current||!h||Xe)){ve(!0);try{const e=document.createElement("iframe");e.style.position="fixed",e.style.right="0",e.style.bottom="0",e.style.width="0",e.style.height="0",e.style.border="0",e.style.visibility="hidden",e.setAttribute("sandbox","allow-same-origin allow-scripts allow-modals"),document.body.appendChild(e);const r=e.contentWindow?.document;if(!r){ve(!1),document.body.removeChild(e),alert("Print preview failed to open. Please check your browser settings.");return}r.open(),r.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>${je||"Invoice"}</title>
          <style>
            * { box-sizing: border-box; }
            body {
              font-family: 'Segoe UI', Arial, sans-serif;
              margin: 0;
              padding: 32px;
              background: #ffffff;
              color: #1f2933;
            }
            h1, h2, h3, h4 { margin: 0; }
            table { border-collapse: collapse; width: 100%; }
            th, td { padding: 8px; border-bottom: 1px solid #e5e7eb; }
            th { text-align: left; color: #475569; font-weight: 600; }
            .invoice-shell {
              max-width: 720px;
              margin: 0 auto;
              padding: 24px;
              border: 1px solid #d2d6dc;
              border-radius: 12px;
            }
            @media print {
              body { padding: 0; }
              .invoice-shell { border: none; }
            }
          </style>
        </head>
        <body>
          <div class="invoice-shell">
            ${we.current.innerHTML}
          </div>
        </body>
      </html>
    `),r.close(),e.onload=function(){setTimeout(()=>{try{e.contentWindow?.focus(),e.contentWindow?.print()}catch(s){console.error("Print failed:",s),alert("Print failed. Please try using your browser's print function (Ctrl+P).")}finally{setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e),ve(!1)},500)}},250)},setTimeout(()=>{Xe&&document.body.contains(e)&&(document.body.removeChild(e),ve(!1),console.warn("Print timeout - iframe failed to load"))},5e3)}catch(e){console.error("Print setup failed:",e),ve(!1),alert("Failed to initialize print. Please try again or use Ctrl+P.")}}},[je,h,Xe]);const mr=i.useCallback(async()=>{if(!(!we.current||!h||Ke)){Ze(!0);try{const r=(await xr(we.current,{scale:window.devicePixelRatio||2,useCORS:!0,backgroundColor:"#ffffff",onclone:k=>{k.querySelectorAll("*").forEach(m=>{const _=window.getComputedStyle(m);["color","backgroundColor","borderColor"].forEach(p=>{const f=_[p];f&&f.includes("oklch")&&(m.style[p]="#000000",p==="backgroundColor"&&(m.style[p]="transparent"))})})}})).toDataURL("image/png"),s=new jr("p","mm","a4"),a=s.internal.pageSize.getWidth(),u=s.internal.pageSize.getHeight(),d=10,c=a-d*2,T=s.getImageProperties(r),w=T.height/T.width,A=c*w;let l=A,W=d;for(s.addImage(r,"PNG",d,W,c,A),l-=u-d*2;l>0;)s.addPage(),W=d-(A-l),s.addImage(r,"PNG",d,W,c,A),l-=u-d*2;s.save(`${je||"invoice"}.pdf`)}catch(e){console.error("Invoice download failed",e),alert("Failed to generate invoice PDF. Please try again.")}finally{Ze(!1)}}},[je,h,Ke]);i.useCallback(async()=>{if(["Preparing","Ready","Served","Finalized","Paid"].includes(E)){await ot();return}if(E==="Returned"||E==="Cancelled"){alert(E==="Returned"?"This order has already been returned.":"This order has been cancelled.");return}n("/billing")},[E,ot,n]);const gr=i.useCallback(()=>{R&&(Re(!1),Ge(R),He(!0))},[R]),pr=e=>{const r={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,ek:1,do:2,teen:3,char:4,paanch:5,che:6,saat:7,aath:8,nau:9,das:10},s=(e||"").toLowerCase().trim();if(r[s]!==void 0)return r[s];const a=parseInt(s,10);return Number.isNaN(a)?0:a},fr=e=>{const r={addedItems:[],notFound:[]};if(!e)return r;const s={...G},a=Array.isArray(ie)&&ie.length>0?ie:Object.values(Ie).length>0?Object.values(Ie):wr.map(d=>({...d,isAvailable:!0}));return e.split(/[,;]/).map(d=>d.trim()).filter(Boolean).forEach(d=>{let c=1,T=d;const w=d.match(/^(\d+)\s+(.+)$/);if(w)c=parseInt(w[1],10)||1,T=w[2].trim();else{const l=d.match(/^(one|two|three|four|five|six|seven|eight|nine|ten|ek|do|teen|char|paanch|che|saat|aath|nau|das)\s+(.+)$/i);l&&(c=pr(l[1])||1,T=l[2].trim())}if(!T)return;const A=a.find(l=>l?.name&&l.name.toLowerCase()===T.toLowerCase())||a.find(l=>l?.name&&(l.name.toLowerCase().includes(T.toLowerCase())||T.toLowerCase().includes(l.name.toLowerCase())));A&&A.isAvailable!==!1?(s[A.name]=(s[A.name]||0)+c,r.addedItems.push({name:A.name,qty:c})):r.notFound.push(T)}),de(s),r};return i.useEffect(()=>{const r=(localStorage.getItem(q)||"DINE_IN")==="TAKEAWAY";let s=null;if(r?s=y||localStorage.getItem("terra_orderId_TAKEAWAY"):s=y||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),!s){B(null),V(null),te(null);return}if(pt)return;let a,u,d=!1,c=null;const T=o=>{if(!a||!o)return;const m=String(o);c!==m&&(a.emit("join:cart",m),c=m)},w=async()=>{try{const o=localStorage.getItem(q)||"DINE_IN";let m=null;if(o==="TAKEAWAY"?m=y||localStorage.getItem("terra_orderId_TAKEAWAY"):m=y||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),!m){te(null);return}const _=localStorage.getItem("terra_sessionToken");let p;try{p=await fetch(`${K}/api/orders/${m}`,{signal:AbortSignal.timeout(5e3)})}catch{d||(console.warn("[Menu] Backend server appears to be offline. Will retry automatically."),d=!0);return}if(d&&(d=!1),!p.ok){p.status===404&&(console.warn("Order not found (404), clearing order data"),o==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")),z(null),B(null),V(null),te(null));return}let f;try{f=await p.json()}catch(J){console.error("[Menu] Failed to parse order status response as JSON:",J);return}if(!f)return;const C=localStorage.getItem("terra_serviceType")||"DINE_IN",O=C==="TAKEAWAY";if(f.serviceType&&f.serviceType!==C){console.log(`[Menu] Ignoring order update - serviceType mismatch: order is ${f.serviceType}, current is ${C}`);return}const g=O&&localStorage.getItem("terra_takeaway_sessionToken")||_;if(O){if(g&&f.sessionToken&&f.sessionToken!==g)return}else if(g&&f.sessionToken&&f.sessionToken!==g){localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN"),localStorage.removeItem("terra_cart_DINE_IN"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),z(null),B(null),V(null),te(null),ce(null),re(null);return}if(te(f),f.cartId&&T(f.cartId),O&&re(f),f?.status){if((O?localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"):localStorage.getItem("terra_orderStatus_DINE_IN")||localStorage.getItem("terra_orderStatus"))===f.status&&E===f.status)return;const se=new Date().toISOString();B(f.status),V(se),O?(localStorage.setItem("terra_orderStatus_TAKEAWAY",f.status),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",se),localStorage.setItem("terra_orderStatus",f.status),localStorage.setItem("terra_orderStatusUpdatedAt",se)):(localStorage.setItem("terra_orderStatus_DINE_IN",f.status),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",se),localStorage.setItem("terra_orderStatus",f.status),localStorage.setItem("terra_orderStatusUpdatedAt",se))}}catch{}};w(),u=setInterval(w,2e4);try{a=Er(K,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,timeout:6e4,connectTimeout:6e4,autoConnect:!0,forceNew:!1});let o=!1;a.on("connect",()=>{o=!1,d=!1;const m=Qe?.cartId,_=localStorage.getItem("terra_takeaway_cartId");let p=null;try{const f=JSON.parse(localStorage.getItem(he)||"{}"),C=f.cartId||f.cafeId;p=typeof C=="object"&&C?._id?C._id:C}catch{p=null}T(m||_||p)}),a.on("connect_error",m=>{o||(console.warn("[Menu] Socket connection error - backend may be offline. Will retry automatically."),o=!0)}),a.on("disconnect",m=>{})}catch(o){console.warn("[Menu] Failed to create socket connection:",o),a=null}const A=o=>{const m=localStorage.getItem(q)||"DINE_IN";let _=null;if(m==="TAKEAWAY"?_=y||localStorage.getItem("terra_orderId_TAKEAWAY"):_=y||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),String(o?._id||"")===String(_||"")&&o?.status&&o?.serviceType===m){if(localStorage.getItem("terra_orderStatus")===o.status&&E===o.status)return;if(m==="TAKEAWAY"&&o.sessionToken){const C=localStorage.getItem("terra_takeaway_sessionToken")||localStorage.getItem("terra_sessionToken");if(C&&o.sessionToken!==C)return}const f=new Date().toISOString();B(o.status),V(f),te(o),o.cartId&&T(o.cartId),localStorage.setItem("terra_orderStatus",o.status),localStorage.setItem("terra_orderStatusUpdatedAt",f),m==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",o.status),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",f)):(localStorage.setItem("terra_orderStatus_DINE_IN",o.status),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",f))}},l=o=>{if(!o)return;const m=localStorage.getItem(q)||"DINE_IN";let _=null;m==="TAKEAWAY"?_=y||localStorage.getItem("terra_orderId_TAKEAWAY"):_=y||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId");const p=o.orderId||o.order?._id;if(!p||String(p)!==String(_||""))return;const f=o.status||o.order?.status||"Confirmed",C=new Date().toISOString();if(B(f),V(C),localStorage.setItem("terra_orderStatus",f),localStorage.setItem("terra_orderStatusUpdatedAt",C),m==="TAKEAWAY"?(localStorage.setItem("terra_orderStatus_TAKEAWAY",f),localStorage.setItem("terra_orderStatusUpdatedAt_TAKEAWAY",C)):(localStorage.setItem("terra_orderStatus_DINE_IN",f),localStorage.setItem("terra_orderStatusUpdatedAt_DINE_IN",C)),o.order&&typeof o.order=="object"){te({...o.order,assignmentDisplayType:o.assignmentDisplayType||o.order.assignmentDisplayType||null}),o.order.cartId&&T(o.order.cartId);return}o.assignedStaff&&te(O=>{const g=O?{...O}:{_id:p};return g.status=f,g.assignedStaff=o.assignedStaff,g.assignmentDisplayType=o.assignmentDisplayType||g.assignmentDisplayType||null,g.acceptedBy||(g.acceptedBy={employeeId:o.assignedStaff.id||null,employeeName:o.assignedStaff.name||null,employeeRole:o.assignedStaff.role||null,disability:{hasDisability:!!o.assignedStaff.disability,type:o.assignedStaff.disability||null}}),g})},W=o=>{const m=localStorage.getItem(q)||"DINE_IN";let _=null;m==="TAKEAWAY"?_=y||localStorage.getItem("terra_orderId_TAKEAWAY"):_=y||localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),o?.id===_&&(B(null),z(null),te(null),m==="TAKEAWAY"?(localStorage.removeItem("terra_orderId_TAKEAWAY"),localStorage.removeItem("terra_orderStatus_TAKEAWAY"),localStorage.removeItem("terra_orderStatusUpdatedAt_TAKEAWAY")):(localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_orderId_DINE_IN"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatus_DINE_IN"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_orderStatusUpdatedAt_DINE_IN")))},k=o=>{const m=U||(()=>{try{const Z=localStorage.getItem("terra_selectedTable");return Z?JSON.parse(Z):null}catch{return null}})();if(!m)return;const _=o.id||o._id,p=m.id||m._id,f=_&&p&&String(_)===String(p),C=o.number&&m.number&&String(o.number)===String(m.number);if(!f&&!C)return;console.log("[Menu] Table status updated via socket:",o.status,"Previous status:",m.status);const O={...m,status:o.status,currentOrder:o.currentOrder||null,sessionToken:o.sessionToken||m.sessionToken};Je(O),localStorage.setItem("terra_selectedTable",JSON.stringify(O));const g=localStorage.getItem("terra_orderId")||localStorage.getItem("terra_orderId_DINE_IN"),J=localStorage.getItem("terra_orderStatus")||localStorage.getItem("terra_orderStatus_DINE_IN"),se=g&&(!J||!["Paid","Cancelled","Returned","Completed"].includes(J));o.status==="AVAILABLE"&&(se?console.log("[Menu] Table became AVAILABLE but user has active order - preserving order data"):(console.log("[Menu] Table became AVAILABLE via socket - clearing waitlist state and order data (user has no active order)"),localStorage.removeItem("terra_waitToken"),localStorage.removeItem("terra_orderId"),localStorage.removeItem("terra_cart"),localStorage.removeItem("terra_orderStatus"),localStorage.removeItem("terra_orderStatusUpdatedAt"),localStorage.removeItem("terra_previousOrder"),localStorage.removeItem("terra_previousOrderDetail"),["DINE_IN","TAKEAWAY"].forEach(Z=>{localStorage.removeItem(`terra_cart_${Z}`),localStorage.removeItem(`terra_orderId_${Z}`),localStorage.removeItem(`terra_orderStatus_${Z}`),localStorage.removeItem(`terra_orderStatusUpdatedAt_${Z}`)}),z(null),B(null),te(null),console.log("[Menu] Cleared all order data for new customer")))};return a&&(a.on("orderUpdated",A),a.on("ORDER_ACCEPTED",l),a.on("orderDeleted",W),a.on("table:status:updated",k)),()=>{u&&clearInterval(u),a&&(a.off("orderUpdated",A),a.off("ORDER_ACCEPTED",l),a.off("orderDeleted",W),a.off("table:status:updated",k),a.disconnect())}},[y,pt,N]),i.useEffect(()=>{const e=localStorage.getItem(q)||"DINE_IN";if(e==="TAKEAWAY"?y||localStorage.getItem("terra_orderId_TAKEAWAY")||localStorage.getItem("terra_orderId"):y||localStorage.getItem("terra_orderId")){const s=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"),a=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt");s&&(s!==E&&(console.log("[Menu] Syncing orderStatus from localStorage:",s),B(s)),a&&a!==ue&&V(a))}},[y,E,ue]),i.useEffect(()=>{const e=localStorage.getItem(q)||"DINE_IN";let r=null;if(e==="TAKEAWAY"?r=localStorage.getItem("terra_orderId_TAKEAWAY"):r=localStorage.getItem("terra_orderId_DINE_IN")||localStorage.getItem("terra_orderId"),r&&r!==y&&(console.log("[Menu] Restoring activeOrderId on mount:",r,"serviceType:",e),z(r)),r&&!E){const s=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatus_TAKEAWAY")||localStorage.getItem("terra_orderStatus"),a=e==="TAKEAWAY"&&localStorage.getItem("terra_orderStatusUpdatedAt_TAKEAWAY")||localStorage.getItem("terra_orderStatusUpdatedAt");s&&(B(s),a&&V(a))}},[]),i.useEffect(()=>{if(!y){te(null);return}let e=!1;return(async()=>{try{const s=await fetch(`${K}/api/orders/${y}`,{signal:AbortSignal.timeout(5e3)});if(!s.ok)return;const a=await s.json();if(e||!a)return;const u=localStorage.getItem(q)||"DINE_IN";if(a.serviceType&&a.serviceType!==u)return;te(a)}catch{}})(),()=>{e=!0}},[y,N]),i.useEffect(()=>{if(v.get("action")==="confirm"&&!be){if(Se||Object.keys(Ie).length===0){console.error("[Menu] Auto-confirm aborted: Menu data missing or error",{menuCatalogSize:Object.keys(Ie).length,menuError:Se});const r=new URLSearchParams(v);r.delete("action"),D(r),alert(Se?"Cannot place order automatically: "+Se:"Cannot place order automatically: Menu prices not loaded. Please try again manually.");return}const e=new URLSearchParams(v);e.delete("action"),D(e),$(!0),or()}},[v,be,Ie,Se]),t.jsxs("div",{className:`menu-root ${me?"accessibility-mode":""}`,children:[t.jsx("div",{className:"background-image",style:{backgroundImage:`url(${yr})`}}),t.jsx("div",{className:"overlay"}),t.jsx(vr,{accessibilityMode:me,onClickCart:()=>n("/cart"),cartCount:ht}),t.jsx("div",{className:"content-wrapper",children:t.jsx("div",{className:"main-container",children:t.jsxs("div",{className:"panels-container",children:[t.jsxs("div",{className:"left-panel",children:[t.jsxs("div",{className:"order-header-section",children:[t.jsxs("div",{className:"order-header-info",children:[t.jsx("div",{className:"order-header-badge",children:N==="DINE_IN"?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"order-header-icon",children:"📍"}),t.jsx("span",{children:U?.number?`${S("dineIn","Dine-In")} - ${S("table","Table")} ${U.number}`:S("dineIn","Dine-In")})]}):t.jsx("span",{children:S("takeaway","Takeaway")})}),N==="DINE_IN"&&t.jsxs("div",{className:"guest-count-badge",children:[t.jsx("span",{className:"guest-icon",children:"👥"}),t.jsx("span",{children:U?.seats||U?.capacity||2})]})]}),N==="TAKEAWAY"&&R?.takeawayToken&&t.jsxs("span",{className:"token-badge",children:[S("token","Token"),":"," ",t.jsx("strong",{children:R.takeawayToken})]})]}),t.jsx("button",{type:"button",onClick:nr,className:`voice-button ${Ne?"recording":""}`,"aria-pressed":Ne,"aria-label":ar,disabled:be,children:Ne?t.jsx(hr,{}):t.jsx(br,{})}),t.jsx("p",{className:"instruction-text",children:be?S("loadingMenu","Loading menu...")||"Loading menu...":Lt?Xt:Ne?tr:er}),N==="DINE_IN"&&t.jsxs("div",{className:"action-buttons-row",children:[t.jsx("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,a=localStorage.getItem("terra_orderId")||null,u="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${u}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"assistance",customerNotes:"Call Waiter",...a&&{orderId:a}})})).ok)alert("✅ Waiter called! Someone will be with you shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error calling waiter:",e),alert("❌ Failed to call waiter. Please try again.")}},className:"action-button call-waiter-button",children:S("callWaiter","Call Waiter")}),y?t.jsxs("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,a=localStorage.getItem("terra_orderId")||null,u="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${u}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"bill",customerNotes:"Request Bill",...a&&{orderId:a}})})).ok)alert("✅ Bill requested! Someone will bring it shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error requesting bill:",e),alert("❌ Failed to request bill. Please try again.")}},className:"action-button request-bill-button",children:["🧾 ",S("requestBill","Request Bill")]}):t.jsxs("button",{onClick:async()=>{try{const e=localStorage.getItem("terra_selectedTable");if(!e){alert("Please select a table first");return}const r=JSON.parse(e),s=r.id||r._id,a=localStorage.getItem("terra_orderId")||null,u="https://api.terracart.in".replace(/\/$/,"");if((await fetch(`${u}/api/customer-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:s,requestType:"water",customerNotes:"Request Water",...a&&{orderId:a}})})).ok)alert("✅ Water requested! Someone will bring it shortly.");else throw new Error("Failed to send request")}catch(e){console.error("Error requesting water:",e),alert("❌ Failed to request water. Please try again.")}},className:"action-button request-water-button",children:["💧 ",S("requestWater","Request Water")]})]}),it&&t.jsxs("p",{className:"ai-ordered-text",children:[Gt," ",t.jsx("span",{className:"order-text-italic",children:it})]}),E&&t.jsxs("div",{className:"order-status-card",children:[t.jsx("h4",{className:"order-summary-title",children:"Order Status"}),N==="TAKEAWAY"&&R?.takeawayToken&&t.jsxs("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsxs("div",{className:"text-sm font-semibold text-blue-700",children:["Your Token:"," ",t.jsx("span",{className:"text-lg font-bold",children:R.takeawayToken})]}),t.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Please keep this token for reference"})]}),t.jsx("div",{className:"order-status-section",children:t.jsx(Zr,{status:E,updatedAt:ue,serviceType:N,tableLabel:N==="DINE_IN"&&U?.number?`Dine-In | Table ${U.number}`:null})}),ge?.displayType==="TEAM"&&t.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg text-center",children:t.jsx("p",{className:"text-green-800 font-medium",children:"Your order has been confirmed and is being prepared by our team."})}),ge?.displayType!=="TEAM"&&ge?.name&&t.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg text-center",children:[t.jsxs("p",{className:"text-green-800 font-medium",children:["Your order is being handled by ",ge.name]}),ge.role&&t.jsxs("p",{className:"text-sm text-gray-700 mt-1",children:["Role: ",ge.role]}),ge.disability&&t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Disability Support: ",ge.disability]})]}),t.jsxs("div",{className:"button-group status-actions",children:[(()=>{const e=(E||"").toLowerCase();return["paid","completed"].includes(e)&&aa.includes(E)?t.jsx("button",{className:"reset-button return-button",onClick:cr,disabled:ut,children:ut?"Processing...":"Return Order"}):ra.includes(E)?t.jsx("button",{className:"reset-button cancel-button",onClick:ir,disabled:dt,children:dt?"Cancelling...":"Cancel Order"}):E==="Returned"||E==="Cancelled"?t.jsx("button",{className:"billing-button billing-button-disabled",disabled:!0,children:E==="Returned"?"Order Returned":"Order Cancelled"}):null})(),["Pending","Placed","Confirmed","Preparing","Ready","Served","Finalized","Completed","Paid"].includes(E)?t.jsx("button",{className:"billing-button",onClick:ot,disabled:At,children:At?"Opening...":"View Invoice"}):null,t.jsx("button",{className:"confirm-button",onClick:lr,disabled:qe||E&&!ta.includes(E),children:qe?"Please wait...":"Order More"}),(()=>{const e=(E||"").toLowerCase();return["Finalized","Completed"].includes(E)?t.jsx("button",{className:"billing-button",onClick:ur,disabled:mt,children:mt?"Confirming...":"Confirm Payment"}):E!=="Returned"&&E!=="Cancelled"&&!["paid","completed"].includes(e)?t.jsx("button",{className:"complete-payment-button",onClick:()=>{n("/billing")},children:"Payment"}):["paid","completed"].includes(e)?t.jsx("button",{className:"feedback-button",onClick:()=>{const r=y||localStorage.getItem("terra_orderId")||localStorage.getItem("terra_lastPaidOrderId");n("/feedback",{state:{orderId:r}})},children:"Share Feedback"}):null})()]})]}),R&&t.jsxs("div",{className:"order-status-card previous-order-detail-card",style:{padding:"12px",fontSize:"0.9rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsx("h4",{className:"order-summary-title",style:{margin:0,fontSize:"1rem"},children:"Last Order"}),R.status&&t.jsx("span",{className:"meta-chip status-chip",style:{fontSize:"0.75rem",padding:"4px 8px"},children:R.status})]}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px",flexWrap:"wrap",fontSize:"0.8rem"},children:[xt&&t.jsx("span",{className:"meta-chip",style:{fontSize:"0.75rem",padding:"2px 6px"},children:xt}),at&&t.jsx("span",{className:"meta-chip",style:{fontSize:"0.75rem",padding:"2px 6px"},children:at?at.toLocaleDateString():"N/A"})]}),ke?.displayType==="TEAM"&&t.jsxs("div",{style:{marginBottom:"8px",padding:"8px",borderRadius:"8px",background:"#ecfdf5",border:"1px solid #bbf7d0",fontSize:"0.8rem"},children:[t.jsx("strong",{children:"Handled by:"})," ","Our team"]}),ke?.displayType!=="TEAM"&&ke?.name&&t.jsxs("div",{style:{marginBottom:"8px",padding:"8px",borderRadius:"8px",background:"#ecfdf5",border:"1px solid #bbf7d0",fontSize:"0.8rem"},children:[t.jsx("strong",{children:"Handled by:"})," ",ke.name,ke.role&&t.jsxs("span",{children:[" (",ke.role,")"]})]}),t.jsx("div",{style:{marginBottom:"8px",fontSize:"0.85rem"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"600"},children:[t.jsxs("span",{children:["Total: ₹",Ce(Et?.totalAmount||0)]}),t.jsxs("span",{children:[Et?.totalItems||0," items"]})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("button",{className:"invoice-action-btn download w-full sm:w-auto",onClick:gr,style:{padding:"6px 12px",fontSize:"0.85rem"},children:"View Invoice"}),R._id&&t.jsx("button",{className:"feedback-button w-full sm:w-auto",onClick:()=>{const e=R._id;n("/feedback",{state:{orderId:e}})},style:{backgroundColor:"#10b981",color:"#ffffff",border:"1px solid #059669",fontWeight:"600",padding:"6px 12px",fontSize:"0.85rem"},children:"Feedback"})]})]})]}),t.jsxs("div",{className:"right-panel",children:[t.jsx("h3",{className:"manual-entry-title",children:Ht}),t.jsx("input",{type:"text",placeholder:rr,value:Me,onChange:e=>qt(e.target.value),className:"search-input"}),Se&&!be&&t.jsx("div",{className:"menu-warning",children:Se}),be?t.jsx("div",{className:"menu-loading-message",children:"Loading menu, please wait..."}):Me.trim()?bt.length>0?t.jsx("div",{className:"search-results",children:bt.map(e=>t.jsx(Ut,{item:e,onAdd:jt,onRemove:Ot,count:G[e.name]||0,lang:P},e._id||e.name))}):t.jsx("div",{className:"search-no-results",children:"No matching items found. Try another keyword."}):t.jsx("div",{className:"category-container",children:_e.length===0?t.jsx("div",{className:"search-no-results",children:"Menu is not configured yet. Please contact the administrator."}):t.jsx(t.Fragment,{children:(Array.isArray(_e)?_e:[]).map((e,r)=>t.jsx(na,{defaultOpen:r===0,category:e?.name||"Unnamed Category",items:Array.isArray(e?.items)?e.items:[],cart:G,onAdd:jt,onRemove:Ot,lang:P},e?._id||e?.name||Math.random()))})})]})]})})}),zt&&t.jsx("div",{className:"invoice-modal-overlay",onClick:Ct,children:t.jsxs("div",{className:"invoice-modal",role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"invoice-modal-header",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Invoice"}),h&&t.jsxs("div",{className:"invoice-meta",children:[t.jsx("span",{children:`Order #${h._id||"—"}`}),Oe&&t.jsx("span",{children:Oe.toLocaleString()})]})]}),t.jsxs("div",{className:"invoice-modal-actions",children:[t.jsx("button",{onClick:mr,disabled:!h||Ke,className:"invoice-action-btn download",children:Ke?"Preparing…":"Download"}),t.jsx("button",{onClick:Ct,className:"invoice-close-btn","aria-label":"Close invoice modal",children:"✕"})]})]}),t.jsxs("div",{ref:we,className:"invoice-preview",children:[t.jsxs("div",{className:"invoice-top",children:[t.jsxs("div",{children:[t.jsx("div",{className:"brand-name",children:h?.cafe?.cafeName||h?.cafe?.name||"Terra Cart"}),t.jsx("div",{className:"brand-address",children:h?.cafe?.address||h?.franchise?.address||"123 Main Street, City"}),(h?.franchise?.fssaiNumber||h?.franchise?.fssai||h?.cafe?.fssaiNumber||h?.cafe?.fssai)&&t.jsxs("div",{className:"brand-address",children:["FSSAI No:"," ",h.franchise?.fssaiNumber||h.franchise?.fssai||h.cafe?.fssaiNumber||h.cafe?.fssai]}),(h?.franchise?.gstNumber||h?.cafe?.gstNumber)&&t.jsxs("div",{className:"brand-address",children:["FSSAI No:"," ",h.franchise?.gstNumber||h.cafe?.gstNumber]})]}),t.jsxs("div",{className:"invoice-meta-block",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Invoice No:"}),t.jsx("span",{children:je||"—"})]}),h?.serviceType==="TAKEAWAY"&&h?.takeawayToken&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Token:"}),t.jsx("span",{className:"font-bold text-blue-600",children:h.takeawayToken})]}),Oe&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Date:"}),t.jsx("span",{children:Oe.toLocaleDateString()})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Time:"}),t.jsx("span",{children:Oe.toLocaleTimeString()})]})]})]})]}),t.jsxs("div",{className:"invoice-billed",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Service:"}),t.jsx("span",{children:Jt})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Table:"}),t.jsxs("span",{children:[h?.serviceType==="TAKEAWAY"?"Takeaway Counter":Qt||"—",Nt?` · ${Nt}`:""]})]}),h?.serviceType==="TAKEAWAY"&&(h.customerName||h.customerMobile)&&t.jsxs(t.Fragment,{children:[h.customerName&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Customer Name:"}),t.jsx("span",{children:h.customerName})]}),h.customerMobile&&t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Mobile Number:"}),t.jsx("span",{children:h.customerMobile})]})]}),h?.specialInstructions&&t.jsxs("div",{className:"meta-line",style:{marginTop:"8px",borderTop:"1px dashed #e5e7eb",paddingTop:"4px"},children:[t.jsx("span",{style:{color:"#d97706",fontWeight:"bold"},children:"Note:"}),t.jsx("span",{style:{fontStyle:"italic"},children:h.specialInstructions})]})]}),t.jsxs("table",{className:"invoice-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Item"}),t.jsx("th",{children:"Qty"}),t.jsx("th",{children:"Price (₹)"}),t.jsx("th",{className:"align-right",children:"Amount (₹)"})]})}),t.jsx("tbody",{children:Ue.length>0?Ue.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{children:e.name}),e.returned&&t.jsxs("span",{className:"invoice-returned-note",children:["Returned ",e.returnedQuantity]})]})}),t.jsx("td",{children:e.quantity>0?e.quantity:"—"}),t.jsxs("td",{children:["₹",Ce(e.unitPrice)]}),t.jsx("td",{className:"align-right",children:e.quantity>0?`₹${Ce(e.amount)}`:"Returned"})]},e.name)):t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"empty-row",children:"No items found"})})})]}),t.jsxs("div",{className:"invoice-totals",children:[t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Total Items"}),t.jsx("span",{children:rt.totalItems})]}),t.jsxs("div",{className:"meta-line",children:[t.jsx("span",{children:"Subtotal"}),t.jsxs("span",{children:["₹",Ce(rt.subtotal)]})]}),t.jsxs("div",{className:"meta-line total",children:[t.jsx("span",{children:"Total"}),t.jsxs("span",{children:["₹",Ce(rt.totalAmount)]})]})]}),t.jsx("div",{className:"invoice-footer",children:"Thank you for dining with Terra Cart. We hope to see you again!"})]})]})}),Vt&&t.jsx("div",{className:"invoice-modal-overlay",onClick:()=>Ae(!1),children:t.jsxs("div",{className:"invoice-modal",style:{maxWidth:"24rem",maxHeight:"auto",height:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"invoice-modal-header",children:[t.jsx("div",{children:t.jsx("h3",{children:Te==="Cancel"?"Cancel Order":"Return Order"})}),t.jsx("button",{onClick:()=>Ae(!1),className:"invoice-close-btn",children:"✕"})]}),t.jsxs("div",{children:[t.jsx("p",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",color:"#666"},children:"Please provide a reason:"}),t.jsx("textarea",{style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"0.5rem",minHeight:"100px",fontSize:"0.9rem",marginBottom:"1rem",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"},placeholder:"e.g. Changed my mind, Taking too long...",value:Ye,onChange:e=>et(e.target.value)}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem"},children:[t.jsx("button",{className:"reset-button",style:{width:"auto",flex:"1"},onClick:()=>Ae(!1),disabled:tt,children:"Close"}),t.jsx("button",{className:"confirm-button",style:{width:"auto",flex:"1"},onClick:dr,disabled:tt,children:tt?"Processing...":"Confirm"})]})]})]})}),Object.keys(G).length>0&&!Ft&&t.jsx("div",{className:"menu-cart-footer",children:t.jsxs("div",{className:"menu-cart-footer-inner",children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsxs("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[ht," Items"]}),t.jsxs("span",{style:{color:"#666",fontSize:"0.9rem"},children:["Total: ₹",Bt.toFixed(2)]})]}),t.jsx("button",{onClick:()=>n("/cart"),style:{backgroundColor:"#ff6b35",color:"white",padding:"12px 24px",borderRadius:"50px",fontWeight:"bold",fontSize:"1rem",border:"none",cursor:"pointer",boxShadow:"0 4px 6px rgba(255, 107, 53, 0.3)"},children:"View Cart →"})]})}),t.jsx(Tr,{open:Y,steps:Q,title:"Processing your order"})]})}const ya=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{ya as M,Zr as O};
